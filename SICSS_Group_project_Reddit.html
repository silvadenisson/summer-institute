<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paul Binder">
<meta name="author" content="Julian Kohne">
<meta name="author" content="Johanna Mehltretter">
<meta name="author" content="[Mark Sparhuber]">
<meta name="author" content="Birgit Zeyer-Gliozzo">

<title>Relationship Advice on Reddit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="SICSS_Group_project_Reddit_files/libs/clipboard/clipboard.min.js"></script>
<script src="SICSS_Group_project_Reddit_files/libs/quarto-html/quarto.js"></script>
<script src="SICSS_Group_project_Reddit_files/libs/quarto-html/popper.min.js"></script>
<script src="SICSS_Group_project_Reddit_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SICSS_Group_project_Reddit_files/libs/quarto-html/anchor.min.js"></script>
<link href="SICSS_Group_project_Reddit_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SICSS_Group_project_Reddit_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SICSS_Group_project_Reddit_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SICSS_Group_project_Reddit_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SICSS_Group_project_Reddit_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a>
  <ul>
  <li><a href="#basic-idea" id="toc-basic-idea" class="nav-link" data-scroll-target="#basic-idea">Basic Idea</a></li>
  <li><a href="#research-questions" id="toc-research-questions" class="nav-link" data-scroll-target="#research-questions">Research Questions</a></li>
  <li><a href="#data-selection" id="toc-data-selection" class="nav-link" data-scroll-target="#data-selection">Data Selection</a></li>
  <li><a href="#collecting-data" id="toc-collecting-data" class="nav-link" data-scroll-target="#collecting-data">Collecting Data</a>
  <ul>
  <li><a href="#things-we-tried" id="toc-things-we-tried" class="nav-link" data-scroll-target="#things-we-tried">Things we tried</a></li>
  <li><a href="#main-problems" id="toc-main-problems" class="nav-link" data-scroll-target="#main-problems">Main Problems</a></li>
  <li><a href="#our-solution" id="toc-our-solution" class="nav-link" data-scroll-target="#our-solution">Our Solution</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">(Pre)processing</a>
  <ul>
  <li><a href="#set-up-loading-packages-and-data" id="toc-set-up-loading-packages-and-data" class="nav-link" data-scroll-target="#set-up-loading-packages-and-data">Set-Up: Loading Packages and Data</a></li>
  <li><a href="#extracting-age-gender-information" id="toc-extracting-age-gender-information" class="nav-link" data-scroll-target="#extracting-age-gender-information">Extracting Age &amp; Gender Information</a>
  <ul>
  <li><a href="#checking-with-visual-sanity-check" id="toc-checking-with-visual-sanity-check" class="nav-link" data-scroll-target="#checking-with-visual-sanity-check">Checking with visual sanity check</a></li>
  <li><a href="#multiple-ages" id="toc-multiple-ages" class="nav-link" data-scroll-target="#multiple-ages">Multiple ages</a></li>
  <li><a href="#taking-first-instances" id="toc-taking-first-instances" class="nav-link" data-scroll-target="#taking-first-instances">Taking first instances</a></li>
  <li><a href="#dealing-with-weird-cases" id="toc-dealing-with-weird-cases" class="nav-link" data-scroll-target="#dealing-with-weird-cases">Dealing with weird cases</a></li>
  <li><a href="#distribution-of-reasonable-age-range" id="toc-distribution-of-reasonable-age-range" class="nav-link" data-scroll-target="#distribution-of-reasonable-age-range">Distribution of reasonable age range</a></li>
  <li><a href="#building-age-groups" id="toc-building-age-groups" class="nav-link" data-scroll-target="#building-age-groups">Building age groups</a></li>
  <li><a href="#non-cis-gendered-authors" id="toc-non-cis-gendered-authors" class="nav-link" data-scroll-target="#non-cis-gendered-authors">Non cis-gendered Authors</a></li>
  </ul></li>
  <li><a href="#automated-gender-and-age-detection" id="toc-automated-gender-and-age-detection" class="nav-link" data-scroll-target="#automated-gender-and-age-detection">Automated Gender and Age detection</a></li>
  <li><a href="#data-wrangling-formatting-and-subsetting" id="toc-data-wrangling-formatting-and-subsetting" class="nav-link" data-scroll-target="#data-wrangling-formatting-and-subsetting">Data Wrangling: Formatting and Subsetting</a></li>
  <li><a href="#preprocessing-text-data" id="toc-preprocessing-text-data" class="nav-link" data-scroll-target="#preprocessing-text-data">Preprocessing Text Data</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul>
  <li><a href="#descriptive-statistics" id="toc-descriptive-statistics" class="nav-link" data-scroll-target="#descriptive-statistics">Descriptive Statistics</a>
  <ul>
  <li><a href="#distribution-of-author-age-groups" id="toc-distribution-of-author-age-groups" class="nav-link" data-scroll-target="#distribution-of-author-age-groups">Distribution of Author Age Groups</a></li>
  <li><a href="#age-as-a-continuous-variable" id="toc-age-as-a-continuous-variable" class="nav-link" data-scroll-target="#age-as-a-continuous-variable">Age as a continuous variable</a></li>
  <li><a href="#age-distribution-by-subreddit-and-gender-for-non-cis-gender-authors" id="toc-age-distribution-by-subreddit-and-gender-for-non-cis-gender-authors" class="nav-link" data-scroll-target="#age-distribution-by-subreddit-and-gender-for-non-cis-gender-authors">Age distribution by subreddit and gender for non-cis gender authors</a></li>
  <li><a href="#distribution-of-author-gender" id="toc-distribution-of-author-gender" class="nav-link" data-scroll-target="#distribution-of-author-gender">Distribution of Author Gender</a></li>
  </ul></li>
  <li><a href="#structural-topic-modelling" id="toc-structural-topic-modelling" class="nav-link" data-scroll-target="#structural-topic-modelling">Structural Topic Modelling</a></li>
  <li><a href="#assigning-meaning-to-topics" id="toc-assigning-meaning-to-topics" class="nav-link" data-scroll-target="#assigning-meaning-to-topics">Assigning Meaning to Topics</a></li>
  <li><a href="#topics" id="toc-topics" class="nav-link" data-scroll-target="#topics">Topics</a></li>
  <li><a href="#resulting-topics-sorted-by-frequency" id="toc-resulting-topics-sorted-by-frequency" class="nav-link" data-scroll-target="#resulting-topics-sorted-by-frequency">Resulting Topics (sorted by frequency)</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul>
  <li><a href="#effects-by-age" id="toc-effects-by-age" class="nav-link" data-scroll-target="#effects-by-age">Effects by Age</a></li>
  <li><a href="#effects-by-gender" id="toc-effects-by-gender" class="nav-link" data-scroll-target="#effects-by-gender">Effects by Gender</a></li>
  <li><a href="#relationships-between-topics" id="toc-relationships-between-topics" class="nav-link" data-scroll-target="#relationships-between-topics">Relationships between topics</a></li>
  <li><a href="#if-we-had-unlimited-time-we-would-continue-by" id="toc-if-we-had-unlimited-time-we-would-continue-by" class="nav-link" data-scroll-target="#if-we-had-unlimited-time-we-would-continue-by">If we had unlimited time, we would continue by…</a></li>
  </ul></li>
  <li><a href="#takeaways" id="toc-takeaways" class="nav-link" data-scroll-target="#takeaways">Takeaways</a></li>
  <li><a href="#thank-you" id="toc-thank-you" class="nav-link" data-scroll-target="#thank-you">Thank You!</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Relationship Advice on Reddit</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Paul Binder </p>
             <p>Julian Kohne </p>
             <p>Johanna Mehltretter </p>
             <p>[Mark Sparhuber] </p>
             <p>Birgit Zeyer-Gliozzo </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="setup" class="level1">
<h1>Setup</h1>
<section id="basic-idea" class="level2">
<h2 class="anchored" data-anchor-id="basic-idea">Basic Idea</h2>
<p>We use data from subreddits where people ask for relationship advice, specifically <a href="https://www.reddit.com/r/relationships/">r/relationships</a> and <a href="https://www.reddit.com/r/relationship_advice/">r/relationships_advice</a> to understand how users discuss relationship problems online. As a first step, we aim to categorize posts using structural topic models according to explore prevalent topics and examine patterns regarding sociodemographic factors, such as age and gender. Additionally, we might scrape comments to these posts and investigate reactions towards topics as well as redditors’ interests in and judgement of different topics based on sentiment analysis.</p>
</section>
<section id="research-questions" class="level2">
<h2 class="anchored" data-anchor-id="research-questions">Research Questions</h2>
<p>We set out to answer the following questions:</p>
<ul>
<li><p>Which topics/relationship issues are discussed in reddit relationship posts?</p></li>
<li><p>Are there differences in the discussed topics according to gender/age/time?</p></li>
<li><p><strong>[BONUS]</strong> How do users react to posts about relationship issues?</p>
<ul>
<li><p>Do the upvotes of posts differ according to topic/gender/age/time?</p></li>
<li><p>How are different issues discussed/perceived/liked?</p></li>
</ul></li>
</ul>
</section>
<section id="data-selection" class="level2">
<h2 class="anchored" data-anchor-id="data-selection">Data Selection</h2>
<p>We decided to use two specific subreddits that are thematically relevant and have a high number of posts and active users.</p>
<ul>
<li><a href="https://www.reddit.com/r/relationships/">r/relationships</a>:
<ul>
<li><p><strong>Description</strong> /r/Relationships is a community built around helping people and the goal of providing a platform for interpersonal relationship advice between redditors. We seek posts from users who have specific and personal relationship quandaries that other redditors can help them try to solve.</p></li>
<li><p><strong>No of subscribers:</strong> 3.4 Million</p></li>
</ul></li>
<li><a href="https://www.reddit.com/r/relationship_advice/">r/relationships_advice</a>:
<ul>
<li><p><strong>Description</strong> Need help with your relationship? Whether it’s romance, friendship, family, co-workers, or basic human interaction: we’re here to help!</p></li>
<li><p><strong>No of subscribers:</strong> 9.6 Million</p></li>
</ul></li>
</ul>
</section>
<section id="collecting-data" class="level2">
<h2 class="anchored" data-anchor-id="collecting-data">Collecting Data</h2>
<p>Our aim was to collect as much data as possible to:</p>
<ol type="a">
<li><p>Enable us to see trends and patterns over time</p></li>
<li><p>Achieve sufficient sample sizes even for marginalized groups (trans peopl, non-binary redditors)</p></li>
<li><p>Enable us to look for temporal patterns between different sociodemographic groups</p></li>
</ol>
<section id="things-we-tried" class="level3">
<h3 class="anchored" data-anchor-id="things-we-tried">Things we tried</h3>
<p>We tried <strong>many</strong> different approached because unfortunately, many did not work (any more):</p>
<ul>
<li><strong>R wrappers</strong>
<ul>
<li><a href="https://github.com/ivan-rivera/RedditExtractor">RedditExractoR</a>️ ⚠️</li>
<li><a href="https://github.com/schochastics/PSAWR">PSAWR</a> 🛑</li>
<li><a href="https://github.com/mkearney/rreddit">rreddit</a> 🛑</li>
</ul></li>
<li><strong>Python wrapper</strong>
<ul>
<li><a href="https://github.com/praw-dev/praw">PRAW</a> ⚠️</li>
</ul></li>
<li><strong>Reddit API</strong>
<ul>
<li><a href="https://www.redditinc.com/policies/data-api-terms">Free API</a> ⚠️</li>
<li><a href="https://www.reddit.com/wiki/api/">Paid API</a> ⚠️</li>
</ul></li>
<li><strong>Webscraping</strong>
<ul>
<li><a href="https://github.com/tidyverse/rvest">rvest</a> 🛑</li>
<li><a href="https://github.com/ropensci/RSelenium">RSelenium</a> 🛑</li>
</ul></li>
</ul>
</section>
<section id="main-problems" class="level3">
<h3 class="anchored" data-anchor-id="main-problems">Main Problems</h3>
<ul>
<li><p>As of June 30th 2023 Reddit closed down it’s public API, likely to prevent providers of LLMs to use their data for free as training data (see <a href="https://www.theverge.com/2023/6/9/23755640/reddit-api-changes-apps-apollo-shut-down-ama-spez-steve-huffman">here</a>). All wrappers that rely on Reddits API directly are thus heavily limited or downright broken.</p></li>
<li><p>In addition, Reddit implemented measures to prevent webscraping, specifcally <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM">shadow DOMS</a>. While it’s still possible to get data by injecting Javascript, it is extremely tedious, takes lots of time and probabaly against Reddit TOS.</p></li>
</ul>
</section>
<section id="our-solution" class="level3">
<h3 class="anchored" data-anchor-id="our-solution">Our Solution</h3>
<ul>
<li><strong>Pre-scraped data</strong>
<ul>
<li>We luckily had some data that was previously scraped by a student assistant before the API was closed</li>
</ul></li>
<li><strong>Historic data dumps</strong>
<ul>
<li>Pushshift used to provide an API for accessing Reddit. With Reddits’ own API shutting down, Pushshift has shut down too. However, there are still dumps of historic data available that were extracted before Reddits’ API shut down. These dumps contain all posts and comments from the most frequently used Subreddits from 2005 - 2013.</li>
</ul></li>
</ul>
<p><strong><em>Course of Action:</em></strong> We will first use the prescraped data to develop our methods and write our code and then run it on the (much bigger) data dump that we will download and preprocess in the meantime.</p>
</section>
</section>
</section>
<section id="preprocessing" class="level1">
<h1>(Pre)processing</h1>
<section id="set-up-loading-packages-and-data" class="level2">
<h2 class="anchored" data-anchor-id="set-up-loading-packages-and-data">Set-Up: Loading Packages and Data</h2>
<p>We start by installing and loading all packages that we need for our project.</p>
<p>Next, we import the raw data that was previously scraped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'data/previous/RedditData_Raw.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extracting-age-gender-information" class="level2">
<h2 class="anchored" data-anchor-id="extracting-age-gender-information">Extracting Age &amp; Gender Information</h2>
<p><img src="./img/Age_Gender_info_example_red.png" class="img-fluid"></p>
<p>In a next step, we extracted age and gender information on the author’s of a post from the titles of the Reddit posts. On the one hand, we did this extraction with regex:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/Age_Gender_info_example_green.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Demographic Information on r/relationships</figcaption>
</figure>
</div>
<p>checking how much info we have per row</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many author info boxes we detect per post</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">sapply</span>(AuthorInfo,length))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    0     1     2     3 
 2181 70742  3189    24 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many posts have more than one author info box detected</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">sapply</span>(AuthorInfo,length) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE  TRUE 
72923  3213 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">sapply</span>(AuthorInfo,length) <span class="sc">&gt;</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    FALSE      TRUE 
0.9577992 0.0422008 </code></pre>
</div>
</div>
<p><strong>PROBLEM:</strong> How do we decide which author info to take if we have multiple based on “I” and “My” indicators?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/Age_Gender_info_example_green.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Author vs.&nbsp;other Information on r/relationships</figcaption>
</figure>
</div>
<section id="checking-with-visual-sanity-check" class="level3">
<h3 class="anchored" data-anchor-id="checking-with-visual-sanity-check">Checking with visual sanity check</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual sanity check</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Test <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(data<span class="sc">$</span>title,AuthorInfo)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Test) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Test[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                      data$title
1                     I (26F) feel suffocated in my relationship with bf (25M) because he never wants alone time
2                                                                I'm 33M and she's 32F, I just don't what to do.
3                                                                Navigating an Open ( 38m) Relationship with 34F
4                   Was it awkward I unintentionally looked at this gas ls coworker and she noticed? [33f] [22m]
5 How do I (26F) stop thinking about my last ex (24M), when I am a week from getting married to my fiance (21M)?
6                                     I (23F) want to break up with my financially irresponsible boyfriend (25M)
  AuthorInfo
1        26f
2       &lt;NA&gt;
3       &lt;NA&gt;
4        22m
5        26f
6        23f</code></pre>
</div>
</div>
<p>### Splitting Age and Gender information</p>
</section>
<section id="multiple-ages" class="level3">
<h3 class="anchored" data-anchor-id="multiple-ages">Multiple ages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># there are some instances were we extracted multiple numbers</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this is because some people are writing the information of multiple</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># people into one set of brackets. This is only the case however</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for less than 0.003 % of posts</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Examples:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[<span class="fu">sapply</span>(author_age,length) <span class="sc">&gt;</span> <span class="dv">1</span>,]<span class="sc">$</span>title[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Seeing her with another guy has crushed me (M30 F28)"                                                         
[2] "What is happening? (26M) (18-24 F)"                                                                           
[3] "(19m, 19f) Im kinda starting to freak out haha. Girl I'm talking too is a bad texter and it's throwing me off"
[4] "Keep forgetting stuff my friends and people tell me (23f (23f)"                                               
[5] "(21m, 24f) Should I cut things off with her?"                                                                 
[6] "(18F, 19M) my bf vents too much"                                                                              </code></pre>
</div>
</div>
</section>
<section id="taking-first-instances" class="level3">
<h3 class="anchored" data-anchor-id="taking-first-instances">Taking first instances</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From visual inspection, it seems safe to assume that the first</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># indication is usually the age of the author, consequently, we</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># always take the first value</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>author_age <span class="ot">&lt;-</span> <span class="fu">sapply</span>(author_age, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rechecking</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#table(sapply(author_age,length))</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#prop.table(table(sapply(author_age,length)))</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># finally, we transform to numeric</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>author_age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(author_age)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># first results</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(author_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="dealing-with-weird-cases" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-weird-cases">Dealing with weird cases</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we have some unreasonably large and small numbers in there</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (and some zeros)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># lets check what went wrong there:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The zeros are almost exclusively from people pasting the example</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># title format as their own title, we should exclude those posts</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># later</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[author_age <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(author_age),]<span class="sc">$</span>title)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Me [00 M/F/N] with my ___ [00 M/F/N] duration, short-description"                                                                                             
[2] "Me [00 M/F] with my ___ [00 M/F] duration, short-description;text"                                                                                            
[3] "Me [00 M/F/N] with my ___ [00 M/F/N] duration, short-description"                                                                                             
[4] "Me [00 M/F/N] with my ___ [00 M/F/N] last night, my neighbor sends me a weird text. I'm not sure if I responded correctly/appropriately because I'm autistic."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The people who indicate an age above 100 are basically 50/50</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># between typos and trolls, but we can throw this away as it's</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># not that much data. It's also little enough data to manually</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[author_age <span class="sc">&gt;=</span> <span class="dv">100</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(author_age),]<span class="sc">$</span>title)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These are usually people talking about their children, trolls</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or people with an unusual infobox e.g. (M2F) for transgender</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># As these cases are not that many, we can exlcude them</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># They also frequently contain typos like 2F instead of 23F or</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># anonymizations like 2XM for a man in his twenties</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>UnderageFrame <span class="ot">&lt;-</span> data[(author_age <span class="sc">&lt;</span> <span class="dv">11</span> <span class="sc">&amp;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                         author_age <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!</span><span class="fu">is.na</span>(author_age)),]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(UnderageFrame<span class="sc">$</span>title)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "My girlfriend (F23) has an incredibly low sex drive with me (M24) (2 year relationship)"   
[2] "Do long-distance relationships work? (20f) + (22m) [5yrs]"                                 
[3] "My gf (21F) (of 6 months) slept with my brother (23M) 2 years ago when we weren’t together"
[4] "(2m, 24f) how do I move on from someone while still seeing them?"                          
[5] "My (M 27) fiancée (F 27) is dragging her feet on moving in with me (7-year relationship)"  
[6] "[PART 2] My (M21) girlfriend’s (F21) family hates us for moving in with my family"         </code></pre>
</div>
</div>
</section>
<section id="distribution-of-reasonable-age-range" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-reasonable-age-range">Distribution of reasonable age range</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting age distribution of author age for ages between 10 and 100</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">as.numeric</span>(author_age[author_age <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> author_age <span class="sc">&lt;</span> <span class="dv">100</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="building-age-groups" class="level3">
<h3 class="anchored" data-anchor-id="building-age-groups">Building age groups</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We create a factor level for age as well for easier breakdown in further analysis, levels are</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>author_age_group <span class="ot">&lt;-</span> author_age</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">&lt;=</span> <span class="dv">20</span>] <span class="ot">&lt;-</span> <span class="st">"&lt;21"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">&gt;=</span> <span class="dv">21</span> <span class="sc">&amp;</span> author_age_group <span class="sc">&lt;=</span> <span class="dv">30</span>] <span class="ot">&lt;-</span> <span class="st">"21-30"</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">&gt;=</span> <span class="dv">31</span> <span class="sc">&amp;</span> author_age_group <span class="sc">&lt;=</span> <span class="dv">40</span>] <span class="ot">&lt;-</span> <span class="st">"31-40"</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">&gt;=</span> <span class="dv">41</span> <span class="sc">&amp;</span> author_age_group <span class="sc">&lt;=</span> <span class="dv">50</span>] <span class="ot">&lt;-</span> <span class="st">"41-50"</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">!=</span> <span class="st">"&lt;21"</span> <span class="sc">&amp;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                        author_age_group <span class="sc">!=</span> <span class="st">"21-30"</span> <span class="sc">&amp;</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                        author_age_group <span class="sc">!=</span> <span class="st">"31-40"</span>  <span class="sc">&amp;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                        author_age_group <span class="sc">!=</span> <span class="st">"41-50"</span>] <span class="ot">&lt;-</span> <span class="st">"&gt;50"</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># checking variable</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#class(author_age_group)</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>author_age_group <span class="ot">&lt;-</span> <span class="fu">factor</span>(author_age_group,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"21-30"</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"31-40"</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"41-50"</span>,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"&gt;50"</span>))</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(author_age,author_age_group, <span class="at">useNA =</span> <span class="st">"ifany"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          author_age_group
author_age   &lt;21 21-30 31-40 41-50   &gt;50  &lt;NA&gt;
      0        4     0     0     0     0     0
      2        5     0     0     0     0     0
      3        1     0     0     0     0     0
      4        1     0     0     0     0     0
      5        2     0     0     0     0     0
      6        2     0     0     0     0     0
      7        1     0     0     0     0     0
      11       1     0     0     0     0     0
      12       1     0     0     0     0     0
      13      28     0     0     0     0     0
      14      71     0     0     0     0     0
      15     149     0     0     0     0     0
      16     313     0     0     0     0     0
      17     417     0     0     0     0     0
      18    2324     0     0     0     0     0
      19    2557     0     0     0     0     0
      20    3126     0     0     0     0     0
      21       0  3142     0     0     0     0
      22       0  3572     0     0     0     0
      23       0  3553     0     0     0     0
      24       0  3400     0     0     0     0
      25       0  3726     0     0     0     0
      26       0  2778     0     0     0     0
      27       0  2497     0     0     0     0
      28       0  2148     0     0     0     0
      29       0  1719     0     0     0     0
      30       0  2027     0     0     0     0
      31       0     0  1057     0     0     0
      32       0     0  1071     0     0     0
      33       0     0   741     0     0     0
      34       0     0   629     0     0     0
      35       0     0   698     0     0     0
      36       0     0   400     0     0     0
      37       0     0   282     0     0     0
      38       0     0   259     0     0     0
      39       0     0   181     0     0     0
      40       0     0   233     0     0     0
      41       0     0     0    98     0     0
      42       0     0     0    96     0     0
      43       0     0     0    76     0     0
      44       0     0     0    59     0     0
      45       0     0     0    65     0     0
      46       0     0     0    37     0     0
      47       0     0     0    34     0     0
      48       0     0     0    33     0     0
      49       0     0     0    18     0     0
      50       0     0     0    34     0     0
      51       0     0     0     0    15     0
      52       0     0     0     0    15     0
      53       0     0     0     0     9     0
      54       0     0     0     0     5     0
      55       0     0     0     0    13     0
      56       0     0     0     0    11     0
      57       0     0     0     0     3     0
      58       0     0     0     0     9     0
      59       0     0     0     0    12     0
      60       0     0     0     0     9     0
      61       0     0     0     0     3     0
      62       0     0     0     0     3     0
      63       0     0     0     0     2     0
      64       0     0     0     0     2     0
      65       0     0     0     0     6     0
      67       0     0     0     0     1     0
      70       0     0     0     0     1     0
      71       0     0     0     0     1     0
      78       0     0     0     0     1     0
      89       0     0     0     0     1     0
      &lt;NA&gt;     0     0     0     0     0 32348</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Missing values</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">is.na</span>(author_age_group))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE  TRUE 
43788 32348 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">is.na</span>(author_age_group)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    FALSE      TRUE 
0.5751287 0.4248713 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># age group</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#table(author_age_group, author_age, useNA = "ifany")</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#prop.table(table(author_age_group))</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># lets bind everything together for easier subsetting</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(data,author_age,author_age_group, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="non-cis-gendered-authors" class="level3">
<h3 class="anchored" data-anchor-id="non-cis-gendered-authors">Non cis-gendered Authors</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># having a look at the unusual cases</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">sapply</span>(AuthorInfo,nchar) <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "m30 f28"  "nb-25"    " 21 f "   "19ftm"    "18-24 f"  "19m, 19f"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># there are a few specific things that pop up often</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"relationship"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2 year relationship" "relationship with"   "7-year relationship"
[4] "2 year relationship" "4mo relationship"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"update"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "update" "update" "update" "update" "update" "update"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"advice"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "advice needed"  "seeking advice" "advice wanted"  "advice"        
[5] "need advice"    "advice"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In these cases, we often have information that doesn't fit the standard formatting.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For the most part, it's save to just extract the instance of m or f as the gender from</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the author info, however, we need to pay special attention to the terms</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># -trans</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -mtf</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># -ftm</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -nb</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># -non-binary</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We should also check how often the following terms appear</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#- gay</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"trans"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "transwoman 33" "36transfem"    "18transm"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"mtf"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mtf18"  "21mtf"  "20mtf"  "21mtf"  "29 mtf" "mtf-23"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"m2f"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"ftm"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "19ftm"  "19ftm"  "ftm 25" "18ftm"  "ftm22"  "19ftm" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"f2m"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"nb"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "nb-25" "21nb"  "nb28"  "nb22"  "29nb"  "22nb" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"non-binary"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "22m non-binary"      "27 non-binary"       "26 non-binary"      
[4] "actually non-binary" "f-non-binary, 45"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"gay"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "27m, gay"        "33m, openly gay"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"lesbian"</span>,AuthorInfo)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "lesbian"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We should first extract the gender only using the (m/f) indicator</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and then add corrections where-ever necessary</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># extracting gender from author variable</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>author_gender <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(AuthorInfo,<span class="st">"(f|m)"</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>author_gender[author_gender <span class="sc">==</span> <span class="st">"character(0)"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(author_gender)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co"># There is an issue: We sometimes get two matching gender indicators from the titles</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This usually happens when people mention something else within their self-description in brackets</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co"># such as their sexual orientation or something unrelated. As convention, we just take the first instance</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co"># checking how many ambiguities are present and where they are</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(author_gender[<span class="fu">sapply</span>(author_gender,length) <span class="sc">&gt;</span> <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "m" "f"

[[2]]
[1] "f" "m"

[[3]]
[1] "m" "f"

[[4]]
[1] "f" "f"

[[5]]
[1] "m" "f"

[[6]]
[1] "f" "m"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#which(sapply(author_gender,length) &gt; 1)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># checking with which titles it occurs</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data<span class="sc">$</span>title[<span class="fu">which</span>(<span class="fu">sapply</span>(author_gender,length) <span class="sc">&gt;</span> <span class="dv">1</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Seeing her with another guy has crushed me (M30 F28)"                                                         
[2] "I (19FTM) have a secret partner (32M)"                                                                        
[3] "(19m, 19f) Im kinda starting to freak out haha. Girl I'm talking too is a bad texter and it's throwing me off"
[4] "Keep forgetting stuff my friends and people tell me (23f (23f)"                                               
[5] "(21m, 24f) Should I cut things off with her?"                                                                 
[6] "I (19FTM) dislike my mom (48F). I feel somewhat bad for having to rely on her."                               </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">which</span>(<span class="fu">sapply</span>(author_gender,length) <span class="sc">&gt;</span> <span class="dv">1</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "m30 f28"  "19ftm"    "19m, 19f" "23f (23f" "21m, 24f" "19ftm"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># taking only first element of every sublist</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>author_gender <span class="ot">&lt;-</span> <span class="fu">sapply</span>(author_gender, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># including trans indications</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grep</span>(<span class="st">"mtf"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"mtf"</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grep</span>(<span class="st">"m2f"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"mtf"</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grep</span>(<span class="st">"ftm"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"ftm"</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grep</span>(<span class="st">"f2m"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"ftm"</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># setting trans indicators </span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"trans"</span>,AuthorInfo) <span class="sc">&amp;</span> author_gender <span class="sc">==</span> <span class="st">"m"</span>] <span class="ot">&lt;-</span> <span class="st">"ftm"</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"trans"</span>,AuthorInfo) <span class="sc">&amp;</span> author_gender <span class="sc">==</span> <span class="st">"f"</span>] <span class="ot">&lt;-</span> <span class="st">"mtf"</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"trans"</span>,AuthorInfo) <span class="sc">&amp;</span> <span class="fu">is.na</span>(author_gender)] <span class="ot">&lt;-</span> <span class="st">"trans"</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co"># setting non-binary indicator</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"nb"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"non-binary"</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"non-binary"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"non-binary"</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co"># first results</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(author_gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>author_gender
         f        ftm          m        mtf non-binary 
     24864         65      18074         18        312 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(author_gender))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adding author gender to the dataframe</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(data,author_gender, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual Sanity Check</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">#View(data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="automated-gender-and-age-detection" class="level2">
<h2 class="anchored" data-anchor-id="automated-gender-and-age-detection">Automated Gender and Age detection</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### script for interacting with gpt3 ####</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="do">## setting up access token as described here:</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/ben-aaron188/rgpt3</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co"># installing package</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"ben-aaron188/rgpt3"</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgpt3)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co"># authenticate access</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: BE CAREFUL, THIS IS LINKED TO CARSTENS PRIVATE CREDIT CARD!</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="fu">gpt3_authenticate</span>(<span class="st">"./GPT_access_token//gpt3_token_carsten2.txt"</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="co"># make test request</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="fu">gpt3_test_completion</span>()</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="do">#### Testing author and gender attribution via gpt3 ####</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="co"># loading in data</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"./data_final/"</span>)</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>()</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"Reddit_relationship_data_final.Rdata"</span>)</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a><span class="co"># subsetting data</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a><span class="co">#sample_size &lt;- 100</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a><span class="co">#data_subset &lt;- data[sample(1:dim(data)[1],sample_size),]</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>data_subset <span class="ot">&lt;-</span> data</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="co"># constructing subset dataframe</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>preface <span class="ot">&lt;-</span> <span class="st">"Extract only the authors' self-indicated age and gender. Ignore anyone but the author: "</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>addon <span class="ot">&lt;-</span> <span class="st">"</span><span class="sc">\n</span><span class="st"> </span><span class="sc">\n</span><span class="st"> Do not include any additional text. If no info is available for the author, return NA"</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>prompt_frame <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">prompt_role_var =</span> <span class="fu">rep</span>(<span class="st">"user"</span>,<span class="fu">dim</span>(data_subset)[<span class="dv">1</span>]),</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prompt_content_var =</span> <span class="fu">paste</span>(preface,data_subset<span class="sc">$</span>title,addon),</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>                           <span class="at">id_var =</span> data_subset<span class="sc">$</span>id)</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a><span class="co"># sending to gpt3</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: ALWAYS DOUBLE CHECK TO NOT SEND TOO MUCH DATA!</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(prompt_frame)</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a><span class="co"># token amount</span></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(prompt_frame<span class="sc">$</span>prompt_content_var,<span class="st">" "</span>)))</span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a><span class="co"># pricing</span></span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a><span class="co"># https://openai.com/pricing</span></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a><span class="co"># GPT3 (4k context):</span></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a><span class="co"># in: 0.03$ / 1000 tokens</span></span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a><span class="co"># out: 0.002$ / 1000 tokens</span></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a><span class="co"># input tokens</span></span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>input_tokens <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(prompt_frame<span class="sc">$</span>prompt_content_var,<span class="st">" "</span>)))</span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a><span class="co"># input costs</span></span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>input_costs <span class="ot">&lt;-</span> (input_tokens <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">*</span> <span class="fl">0.03</span>;input_costs <span class="co"># = price in dollar </span></span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a><span class="co"># output costs (max)</span></span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a>output_costs <span class="ot">&lt;-</span> ((<span class="dv">50</span> <span class="sc">*</span> <span class="fu">length</span>(prompt_frame<span class="sc">$</span>prompt_content_var)) <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">*</span> <span class="fl">0.06</span>;output_costs</span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Total costs (in DOLLARS)</span></span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a>total_costs <span class="ot">&lt;-</span> input_costs <span class="sc">+</span> output_costs;total_costs</span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a><span class="do">### We do this with traCatch to not break everything when sth goes wrong </span><span class="al">###</span></span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a><span class="co"># sending the model off to compute</span></span>
<span id="cb63-68"><a href="#cb63-68" aria-hidden="true" tabindex="-1"></a>gpt_age_gender <span class="ot">&lt;-</span> <span class="fu">chatgpt</span>(<span class="at">prompt_role_var =</span> prompt_frame<span class="sc">$</span>prompt_role_var,</span>
<span id="cb63-69"><a href="#cb63-69" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prompt_content_var =</span> prompt_frame<span class="sc">$</span>prompt_content_var,</span>
<span id="cb63-70"><a href="#cb63-70" aria-hidden="true" tabindex="-1"></a>                          <span class="at">id_var =</span> prompt_frame<span class="sc">$</span>id_var,</span>
<span id="cb63-71"><a href="#cb63-71" aria-hidden="true" tabindex="-1"></a>                          <span class="at">param_max_tokens =</span> <span class="dv">50</span>,</span>
<span id="cb63-72"><a href="#cb63-72" aria-hidden="true" tabindex="-1"></a>                          <span class="at">param_temperature =</span> <span class="dv">0</span>,</span>
<span id="cb63-73"><a href="#cb63-73" aria-hidden="true" tabindex="-1"></a>                          <span class="at">param_n =</span> <span class="dv">1</span>,</span>
<span id="cb63-74"><a href="#cb63-74" aria-hidden="true" tabindex="-1"></a>                          <span class="at">param_model =</span> <span class="st">"gpt-3.5-turbo"</span>)</span>
<span id="cb63-75"><a href="#cb63-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-76"><a href="#cb63-76" aria-hidden="true" tabindex="-1"></a><span class="co"># saving results</span></span>
<span id="cb63-77"><a href="#cb63-77" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(gpt_age_gender,<span class="at">file =</span> <span class="st">"GPT3_Age_Gender_annotations.rds"</span>,<span class="at">ver=</span><span class="dv">2</span>)</span>
<span id="cb63-78"><a href="#cb63-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-79"><a href="#cb63-79" aria-hidden="true" tabindex="-1"></a><span class="co"># checking results</span></span>
<span id="cb63-80"><a href="#cb63-80" aria-hidden="true" tabindex="-1"></a>gpt_age_gender[[<span class="dv">1</span>]]<span class="sc">$</span>chatgpt_content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-wrangling-formatting-and-subsetting" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling-formatting-and-subsetting">Data Wrangling: Formatting and Subsetting</h2>
<p>To further clean our data, we first make sure that all our variables come in the right format. Second, we further clean the data by removing (a) missing texts in the posts (because, of course, we cannot use these posts to examine its text, if there is none) and (b) posts from minors or posts where the writer indicated an unrealistic age (above 100). Lastly, we save our cleaned data set.</p>
</section>
<section id="preprocessing-text-data" class="level2">
<h2 class="anchored" data-anchor-id="preprocessing-text-data">Preprocessing Text Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textmodels)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textstats)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co"># loading data</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">'data/RedditData_Cleaned.Rdata'</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title to selftext</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">paste</span>(title, selftext))</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove punctuation</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>text <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(data<span class="sc">$</span>text, <span class="st">"(?&lt;=(</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">())(.*?)(?=(</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">)))"</span>, <span class="st">""</span>)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate corpus</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>reddit_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(data,</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">text_field =</span> <span class="st">"text"</span>,</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">docid_field =</span> <span class="st">"id"</span>)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(reddit_corpus)<span class="sc">$</span>text <span class="ot">&lt;-</span> data<span class="sc">$</span>text</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a><span class="co"># From corpus to tokens</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>reddit_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(reddit_corpus,</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_url =</span> <span class="cn">TRUE</span>, <span class="co"># remove URLs</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>, <span class="co"># remove numbers</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, <span class="co"># remove punctuation</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_separators =</span> <span class="cn">TRUE</span>,</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># remove empty spaces/line breaks</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Further pre-processing of tokens:</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>own_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"i’m"</span>, <span class="st">"it’s"</span>, <span class="st">"i’ve"</span>,</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"he’s"</span>, <span class="st">"she’s"</span>,</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"doesn’t"</span>, <span class="st">"don’t"</span>, <span class="st">"didn’t"</span>,</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"they’ve"</span>, <span class="st">"they’re"</span>, <span class="st">"tl"</span>,</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"dr"</span>, <span class="st">"tldr"</span>, <span class="st">"ldr"</span>, <span class="st">"tld"</span>,</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"can’t"</span>, <span class="st">"cant"</span>, <span class="st">"can"</span>,</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"cannot"</span>, <span class="st">"wont"</span>, <span class="st">"im"</span>,</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"its"</span>, <span class="st">"hes"</span>, <span class="st">"shes"</span>, <span class="st">"theyve"</span>,</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"theyre"</span>, <span class="st">"hed"</span>, <span class="st">"shed"</span>, <span class="st">"_+"</span>,</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"arent"</span>, <span class="st">"post"</span>,</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"crosspost"</span>, <span class="st">"update"</span>, <span class="st">"edit"</span>,</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"hi"</span>, <span class="st">"hello"</span>, <span class="st">"everyone"</span>,</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"we’ve"</span>, <span class="st">"he’d"</span>, <span class="st">"#x200b"</span>,</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"aren’t"</span>, <span class="st">"he’ll"</span>, <span class="st">"i’d"</span>,</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"really"</span>, <span class="st">"ive"</span>, <span class="st">"dont"</span>,</span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"doesnt"</span>, <span class="st">"didnt"</span>)</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply among other:</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>reddit_tokens <span class="ot">&lt;-</span> reddit_tokens <span class="sc">%&gt;%</span> </span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">'english'</span>), </span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>                <span class="at">padding =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(own_stopwords)</span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect results:</span></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(reddit_tokens[[<span class="dv">1</span>]])</span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect collocations</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a>colls <span class="ot">&lt;-</span> <span class="fu">textstat_collocations</span>(reddit_tokens,</span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>                               <span class="at">min_count =</span> <span class="dv">400</span>)</span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a><span class="co"># look at terms</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(colls[<span class="fu">order</span>(<span class="fu">desc</span>(colls<span class="sc">$</span>lambda)),])</span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a><span class="co"># only consider collocations with a minimum lambda of 4</span></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>colls <span class="ot">&lt;-</span> colls[colls<span class="sc">$</span>lambda <span class="sc">&gt;=</span> <span class="dv">4</span>, ]</span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Some last refinements after further inspection of the collocations:</span></span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a>reddit_tokens_c <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(reddit_tokens, colls) <span class="sc">%&gt;%</span></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="st">''</span>) <span class="co"># remove empty strings</span></span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a>reddit_tokens_c <span class="ot">&lt;-</span> reddit_tokens_c <span class="sc">%&gt;%</span></span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="fu">c</span>(<span class="st">"title_says"</span>, <span class="st">"long_story"</span>, <span class="st">"story_short"</span>))</span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a><span class="co"># From tokens to dfm</span></span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a>reddit_dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(reddit_tokens_c)</span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(reddit_dfm)</span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Only keep terms that appear in at least 10 documents &amp; are at least 2</span></span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a><span class="co"># characters long</span></span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a>reddit_dfm <span class="ot">&lt;-</span> reddit_dfm <span class="sc">%&gt;%</span></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_trim</span>(<span class="at">min_docfreq =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_keep</span>(<span class="at">min_nchar =</span> <span class="dv">2</span>)</span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a><span class="co">#View(reddit_dfm)</span></span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dfm</span></span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(reddit_dfm, "reddit_dfm.rds")</span></span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a><span class="do">## Create STM object</span></span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a>reddit_stm <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">convert</span>(reddit_dfm, <span class="at">to =</span> <span class="st">'stm'</span>)</span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Save stm object</span></span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(reddit_stm, "reddit_stm.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analysis" class="level1">
<h1>Analysis</h1>
<section id="descriptive-statistics" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-statistics">Descriptive Statistics</h2>
<section id="distribution-of-author-age-groups" class="level4">
<h4 class="anchored" data-anchor-id="distribution-of-author-age-groups">Distribution of Author Age Groups</h4>
<p>We now examine the distribution of various variables in our data set by age group. First, we look at how old the writers of our Reddit posts are overall.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-figures1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now, we look at the distribution of author age groups across subreddits</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-figures3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Age groups over time:</p>
<p>Over the years:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-figures6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Across weekdays:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-figures7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Across hours of the day:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-figures8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Across whole observation period:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-figures9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Distribution of upvotes by age group and subreddit</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-figures10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Distribution of number of comments by age group and subreddit</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-figures11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="age-as-a-continuous-variable" class="level4">
<h4 class="anchored" data-anchor-id="age-as-a-continuous-variable">Age as a continuous variable</h4>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-cont1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Distribution by subreddit</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-cont2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Age distribution by subreddit and gender</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-cont4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="age-distribution-by-subreddit-and-gender-for-non-cis-gender-authors" class="level4">
<h4 class="anchored" data-anchor-id="age-distribution-by-subreddit-and-gender-for-non-cis-gender-authors">Age distribution by subreddit and gender for non-cis gender authors</h4>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/age-cont6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="distribution-of-author-gender" class="level4">
<h4 class="anchored" data-anchor-id="distribution-of-author-gender">Distribution of Author Gender</h4>
<p>In the next steps, we look at the distribution of various variables in our data set by gender (sometimes in combination with the subreddit in which a post was posted). We start by checking the gender of the writers of our posts:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Next, we have a look at the distribution of posts across subreddits:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now, gender over time:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Looking at the number of comments a post received depending on the poster’s gender:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   0.000   0.000   2.874   1.000 729.000 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    0.00    1.00    2.67    1.00  729.00   32783 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    0.00    1.00    2.22    1.00  369.00   32783 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Female authors with higher average number of comments and also higher maximum. Winsorized distribution of the number of comments hard to interpret, so let’s have a look at a boxplot &amp; violin (which also will not tell us that much because of the extremely skewed distribution).</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures8a-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures8b-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now, doing the same for the number of upvotes:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    1.00    1.00    3.59    1.00 3924.00 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    1.00    1.00    4.01    1.00 2216.00   32783 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    1.00    1.00    2.71    1.00 1892.00   32783 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Again, extremely left skewed distribution, as large majority of posts received 1 upvote due to Reddit’s internal policies which is why we can try boxplots again (which also again will not be so much more revealing).</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As before, we see that female posters get slightly more upvotes and the maximum of upvotes is also higher for women.</p>
<p>Lastly, we want to look at how often female and male author’s post.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/gender-figures15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="structural-topic-modelling" class="level2">
<h2 class="anchored" data-anchor-id="structural-topic-modelling">Structural Topic Modelling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="do">### STM</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>reddit_stm <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">convert</span>(reddit_dfm, <span class="at">to =</span> <span class="st">'stm'</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(reddit_stm, <span class="st">"reddit_stm.rds"</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_wordcloud</span>(reddit_dfm,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">max_words =</span> <span class="dv">100</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">'black'</span>,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">min_size =</span> <span class="dv">2</span>,</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">max_size =</span> <span class="dv">5</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="fu">textstat_frequency</span>(reddit_dfm) <span class="sc">%&gt;%</span>  <span class="fu">head</span>(<span class="dv">400</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="do">### STM 15</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>stm_15 <span class="ot">&lt;-</span> <span class="fu">stm</span>(<span class="at">documents =</span> reddit_stm<span class="sc">$</span>documents,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">vocab =</span> reddit_stm<span class="sc">$</span>vocab,</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> reddit_stm<span class="sc">$</span>meta,</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">K =</span> <span class="dv">15</span>,</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">prevalence =</span> <span class="sc">~</span> author_age_group <span class="sc">+</span> author_gender_binary,</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">seed =</span> <span class="dv">1328</span>)</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>stm_effects15 <span class="ot">&lt;-</span> <span class="fu">estimateEffect</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">~</span> author_age_group <span class="sc">+</span> </span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>                                  author_gender_binary,</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>                                <span class="at">stmobj =</span> stm_15, <span class="at">metadata =</span> reddit_stm<span class="sc">$</span>meta)</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(reddit_stm, stm_15, stm_effects15, </span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="st">"data/stm15_relationship.RData"</span>)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stm_15)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assigning-meaning-to-topics" class="level2">
<h2 class="anchored" data-anchor-id="assigning-meaning-to-topics">Assigning Meaning to Topics</h2>
<ol type="1">
<li><p>Estimating Models with different K (between 10 and 50)</p></li>
<li><p>Inspecting the resulting topics qualitatively</p></li>
<li><p>Rock-paper-scissors to decide between K = 12 and K = 15</p></li>
</ol>
</section>
<section id="topics" class="level2">
<h2 class="anchored" data-anchor-id="topics">Topics</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/topics.jpeg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Demographic Information on r/relationships</figcaption>
</figure>
</div>
</section>
<section id="resulting-topics-sorted-by-frequency" class="level2">
<h2 class="anchored" data-anchor-id="resulting-topics-sorted-by-frequency">Resulting Topics (sorted by frequency)</h2>
<ol type="1">
<li><p><strong>Communication issues</strong></p>
<ul>
<li>“When”I say “hey what’s wrong” he says nothing”,“We have issues communicating our feelings help”</li>
</ul></li>
<li><p><strong>Dating &amp; Flirting</strong></p>
<ul>
<li>“How do I SUBTLETY flirt with a guy”, “How soon is”too soon” to kiss someone?”</li>
</ul></li>
<li><p><strong>Emotions &amp; Attachment issues</strong></p>
<ul>
<li>“How to overcome anxious attachment style?”, “How to deal with falling out of love?”</li>
</ul></li>
<li><p><strong>Breakup</strong></p>
<ul>
<li>“My BF broke up with me twice in one year.” “How to get over an ex?”</li>
</ul></li>
<li><p><strong>Time together</strong></p>
<ul>
<li>“My girlfriend is so busy, we barely spend any time together” or “My girlfriend sees nothing wrong in never being apart from me”</li>
</ul></li>
<li><p><strong>Trust &amp; Cheating</strong></p>
<ul>
<li>“Is she cheating on me?” “When is it ok to lie or hide something from your partner?”</li>
</ul></li>
<li><p><strong>Social media &amp; Communication</strong></p>
<ul>
<li>“Girlfriend commented on post for single people” ,“I don’t know if boyfriend is lying about secret snapchat account”</li>
</ul></li>
<li><p><strong>General helplessness</strong></p>
<ul>
<li>“What should I do in this situation?”, “Was it a nasty thing to do?”</li>
</ul></li>
<li><p><strong>Money</strong></p>
<ul>
<li>“Any Advice on Splitting Expenses?”</li>
</ul></li>
<li><p><strong>Domestic abuse</strong></p>
<ul>
<li>“My boyfriend tried to murder me because I left him”</li>
</ul></li>
<li><p><strong>Sex</strong></p>
<ul>
<li>“Want to know how to spice our sex life up?”,“My boyfriend said he”loves my flat ass””</li>
</ul></li>
<li><p><strong>Marriage &amp; Family</strong></p>
<ul>
<li>“He wants to adopt I want a biological child”, “How to handle my fiancee’s overbearing mother before we get married”</li>
</ul></li>
<li><p><strong>Weekend plans</strong></p>
<ul>
<li>“Boyfriend left to go to bar”, “Boyfriend rather go on a trip with friends than with me”</li>
</ul></li>
<li><p><strong>Gifts &amp; Invitations</strong></p>
<ul>
<li>“Mildly furious because my girlfriend wants me to return the gifts I bought her”, “Is He Cheap or Am I Entitled?”</li>
</ul></li>
<li><p>Data artifact</p>
<ul>
<li>Many posts contain almost identical texts -&gt; statistical artifact</li>
</ul></li>
</ol>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="effects-by-age" class="level2">
<h2 class="anchored" data-anchor-id="effects-by-age">Effects by Age</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(stm))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(stminsights))</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 2: Money</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>custom_label_age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Missing"</span>, <span class="st">"&lt;21"</span>, <span class="st">"21-30"</span>, <span class="st">"31-40"</span>, <span class="st">"41-50"</span>, <span class="st">"&gt;50"</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">2</span>, </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic money across age"</span>,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 9: Sex</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">9</span>, </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic sex across age"</span>,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 6 breakup:</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">6</span>, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic breakup across age"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 7: Dating</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">7</span>, </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic dating across age"</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 3: Time together</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">3</span>, </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic time together across age"</span>,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 13: Cheating</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">13</span>, </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic cheating across age"</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="effects-by-gender" class="level2">
<h2 class="anchored" data-anchor-id="effects-by-gender">Effects by Gender</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 6: Breakup:</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>custom_label_gender <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Missing"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Other"</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">6</span>, </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_gender_binary'</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic breakup across gender"</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 13 cheating:</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">13</span>, </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_gender_binary'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic cheating across gender"</span>,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="SICSS_Group_project_Reddit_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="relationships-between-topics" class="level2">
<h2 class="anchored" data-anchor-id="relationships-between-topics">Relationships between topics</h2>
<p><img src="./img/Correlation_Plot-1.png" class="img-fluid"></p>
</section>
<section id="if-we-had-unlimited-time-we-would-continue-by" class="level2">
<h2 class="anchored" data-anchor-id="if-we-had-unlimited-time-we-would-continue-by">If we had unlimited time, we would continue by…</h2>
<ul>
<li><p>…looking at the reactions of other users to specific topics.</p></li>
<li><p>…running all our models with the huge data dump (&gt;1 Million posts).</p></li>
<li><p>…trying some even fancier methods (e.g., word embeddings to look for stereotypes surrounding males &amp; females in relationships).</p></li>
<li><p>… getting way better with age and gender detection</p></li>
<li><p>… better remove artifacts, bots, double posts</p></li>
<li><p>… Obvious insanity</p></li>
</ul>
</section>
</section>
<section id="takeaways" class="level1">
<h1>Takeaways</h1>
<ul>
<li>Often, the bottleneck is not the method but the technical implementaton</li>
<li>Time pressure leads to <strong>bad</strong> science</li>
<li>Deciding on number of topics is rather arbitrary</li>
<li>Running the same stm twice can give vastly different topics</li>
</ul>
</section>
<section id="thank-you" class="level1">
<h1>Thank You!</h1>
<p><strong>Thanks to all who made this aweseom summer school possible:</strong></p>
<ul>
<li>Carsten, Alex, Mario, Renata, Sammie…</li>
<li>SICSS</li>
<li>LMU &amp; Maggus</li>
<li>ALL OF YOU!</li>
</ul>
<p>…and…</p>
<p>Fuck u/spez for closing the Reddit API!</p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb80" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Relationship Advice on Reddit"</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - Paul Binder</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - Julian Kohne</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - Johanna Mehltretter</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - "[Mark Sparhuber]"</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - Birgit Zeyer-Gliozzo</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 5</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="an">code-fold:</span><span class="co"> false</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic Idea</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>We use data from subreddits where people ask for relationship advice, specifically <span class="co">[</span><span class="ot">r/relationships</span><span class="co">](https://www.reddit.com/r/relationships/)</span> and <span class="co">[</span><span class="ot">r/relationships_advice</span><span class="co">](https://www.reddit.com/r/relationship_advice/)</span> to understand how users discuss relationship problems online. As a first step, we aim to categorize posts using structural topic models according to explore prevalent topics and examine patterns regarding sociodemographic factors, such as age and gender. Additionally, we might scrape comments to these posts and investigate reactions towards topics as well as redditors' interests in and judgement of different topics based on sentiment analysis.</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Research Questions</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>We set out to answer the following questions:</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Which topics/relationship issues are discussed in reddit relationship posts?</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Are there differences in the discussed topics according to gender/age/time?</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**\[BONUS\]** How do users react to posts about relationship issues?</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Do the upvotes of posts differ according to topic/gender/age/time?</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>How are different issues discussed/perceived/liked?</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Selection</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>We decided to use two specific subreddits that are thematically relevant and have a high number of posts and active users.</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">r/relationships</span><span class="co">](https://www.reddit.com/r/relationships/)</span>:</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Description** /r/Relationships is a community built around helping people and the goal of providing a platform for interpersonal relationship advice between redditors. We seek posts from users who have specific and personal relationship quandaries that other redditors can help them try to solve.</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**No of subscribers:** 3.4 Million</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">r/relationships_advice</span><span class="co">](https://www.reddit.com/r/relationship_advice/)</span>:</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Description** Need help with your relationship? Whether it's romance, friendship, family, co-workers, or basic human interaction: we're here to help!</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**No of subscribers:** 9.6 Million</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a><span class="fu">## Collecting Data</span></span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>Our aim was to collect as much data as possible to:</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a>a)  Enable us to see trends and patterns over time</span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>b)  Achieve sufficient sample sizes even for marginalized groups (trans peopl, non-binary redditors)</span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a>c)  Enable us to look for temporal patterns between different sociodemographic groups</span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a><span class="fu">### Things we tried</span></span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>We tried **many** different approached because unfortunately, many did not work (any more):</span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**R wrappers**</span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">RedditExractoR</span><span class="co">](https://github.com/ivan-rivera/RedditExtractor)</span>️ ⚠️</span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">PSAWR</span><span class="co">](https://github.com/schochastics/PSAWR)</span> 🛑</span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">rreddit</span><span class="co">](https://github.com/mkearney/rreddit)</span> 🛑</span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Python wrapper**</span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">PRAW</span><span class="co">](https://github.com/praw-dev/praw)</span> ⚠️</span>
<span id="cb80-70"><a href="#cb80-70" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Reddit API**</span>
<span id="cb80-71"><a href="#cb80-71" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">Free API</span><span class="co">](https://www.redditinc.com/policies/data-api-terms)</span> ⚠️</span>
<span id="cb80-72"><a href="#cb80-72" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">Paid API</span><span class="co">](https://www.reddit.com/wiki/api/)</span> ⚠️</span>
<span id="cb80-73"><a href="#cb80-73" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Webscraping**</span>
<span id="cb80-74"><a href="#cb80-74" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">rvest</span><span class="co">](https://github.com/tidyverse/rvest)</span> 🛑</span>
<span id="cb80-75"><a href="#cb80-75" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">RSelenium</span><span class="co">](https://github.com/ropensci/RSelenium)</span> 🛑</span>
<span id="cb80-76"><a href="#cb80-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-77"><a href="#cb80-77" aria-hidden="true" tabindex="-1"></a><span class="fu">### Main Problems</span></span>
<span id="cb80-78"><a href="#cb80-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-79"><a href="#cb80-79" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As of June 30th 2023 Reddit closed down it's public API, likely to prevent providers of LLMs to use their data for free as training data (see <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.theverge.com/2023/6/9/23755640/reddit-api-changes-apps-apollo-shut-down-ama-spez-steve-huffman)</span>). All wrappers that rely on Reddits API directly are thus heavily limited or downright broken.</span>
<span id="cb80-80"><a href="#cb80-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-81"><a href="#cb80-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In addition, Reddit implemented measures to prevent webscraping, specifcally <span class="co">[</span><span class="ot">shadow DOMS</span><span class="co">](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM)</span>. While it's still possible to get data by injecting Javascript, it is extremely tedious, takes lots of time and probabaly against Reddit TOS.</span>
<span id="cb80-82"><a href="#cb80-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-83"><a href="#cb80-83" aria-hidden="true" tabindex="-1"></a><span class="fu">### Our Solution</span></span>
<span id="cb80-84"><a href="#cb80-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-85"><a href="#cb80-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Pre-scraped data**</span>
<span id="cb80-86"><a href="#cb80-86" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We luckily had some data that was previously scraped by a student assistant before the API was closed</span>
<span id="cb80-87"><a href="#cb80-87" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Historic data dumps**</span>
<span id="cb80-88"><a href="#cb80-88" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Pushshift used to provide an API for accessing Reddit. With Reddits' own API shutting down, Pushshift has shut down too. However, there are still dumps of historic data available that were extracted before Reddits' API shut down. These dumps contain all posts and comments from the most frequently used Subreddits from 2005 - 2013.</span>
<span id="cb80-89"><a href="#cb80-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-90"><a href="#cb80-90" aria-hidden="true" tabindex="-1"></a>***Course of Action:*** We will first use the prescraped data to develop our methods and write our code and then run it on the (much bigger) data dump that we will download and preprocess in the meantime.</span>
<span id="cb80-91"><a href="#cb80-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-92"><a href="#cb80-92" aria-hidden="true" tabindex="-1"></a><span class="fu"># (Pre)processing</span></span>
<span id="cb80-93"><a href="#cb80-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-94"><a href="#cb80-94" aria-hidden="true" tabindex="-1"></a><span class="fu">## Set-Up: Loading Packages and Data</span></span>
<span id="cb80-95"><a href="#cb80-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-96"><a href="#cb80-96" aria-hidden="true" tabindex="-1"></a>We start by installing and loading all packages that we need for our project.</span>
<span id="cb80-97"><a href="#cb80-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-98"><a href="#cb80-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-packages, echo = FALSE, output = FALSE, warning=FALSE, include=FALSE}</span></span>
<span id="cb80-99"><a href="#cb80-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-100"><a href="#cb80-100" aria-hidden="true" tabindex="-1"></a>list.of.packages  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"readr"</span>,</span>
<span id="cb80-101"><a href="#cb80-101" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"quanteda"</span>,</span>
<span id="cb80-102"><a href="#cb80-102" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"car"</span>,</span>
<span id="cb80-103"><a href="#cb80-103" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"rgl"</span>,</span>
<span id="cb80-104"><a href="#cb80-104" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"corrplot"</span>,</span>
<span id="cb80-105"><a href="#cb80-105" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Hmisc"</span>,</span>
<span id="cb80-106"><a href="#cb80-106" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"lubridate"</span>,</span>
<span id="cb80-107"><a href="#cb80-107" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"anytime"</span>,</span>
<span id="cb80-108"><a href="#cb80-108" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"DescTools"</span>,</span>
<span id="cb80-109"><a href="#cb80-109" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"stringr"</span>,</span>
<span id="cb80-110"><a href="#cb80-110" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"tidyverse"</span>,</span>
<span id="cb80-111"><a href="#cb80-111" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"RedditExtractoR"</span>,</span>
<span id="cb80-112"><a href="#cb80-112" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"ggplot2"</span>,</span>
<span id="cb80-113"><a href="#cb80-113" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"topicmodels"</span>,</span>
<span id="cb80-114"><a href="#cb80-114" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"janitor"</span>,</span>
<span id="cb80-115"><a href="#cb80-115" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"stm"</span>,</span>
<span id="cb80-116"><a href="#cb80-116" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"stminsights"</span>,</span>
<span id="cb80-117"><a href="#cb80-117" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"quanteda.textstats"</span>,</span>
<span id="cb80-118"><a href="#cb80-118" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"quanteda.textmodels"</span>,</span>
<span id="cb80-119"><a href="#cb80-119" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"quanteda.text"</span>,</span>
<span id="cb80-120"><a href="#cb80-120" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"anytime"</span>,</span>
<span id="cb80-121"><a href="#cb80-121" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"miceadds"</span>,</span>
<span id="cb80-122"><a href="#cb80-122" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"stringi"</span>,</span>
<span id="cb80-123"><a href="#cb80-123" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"stringr"</span>,</span>
<span id="cb80-124"><a href="#cb80-124" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"dplyr"</span>)</span>
<span id="cb80-125"><a href="#cb80-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-126"><a href="#cb80-126" aria-hidden="true" tabindex="-1"></a>new.packages <span class="ot">&lt;-</span> list.of.packages[<span class="sc">!</span>(list.of.packages <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="st">"Package"</span>])]</span>
<span id="cb80-127"><a href="#cb80-127" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(new.packages)) <span class="fu">install.packages</span>(new.packages, <span class="at">repos =</span> <span class="st">'http://cran.us.r-project.org'</span>)</span>
<span id="cb80-128"><a href="#cb80-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-129"><a href="#cb80-129" aria-hidden="true" tabindex="-1"></a><span class="co"># attaching packages</span></span>
<span id="cb80-130"><a href="#cb80-130" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(list.of.packages)) {<span class="cf">function</span>(x){<span class="fu">library</span>(x)}}</span>
<span id="cb80-131"><a href="#cb80-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-132"><a href="#cb80-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-133"><a href="#cb80-133" aria-hidden="true" tabindex="-1"></a>Next, we import the raw data that was previously scraped.</span>
<span id="cb80-134"><a href="#cb80-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-135"><a href="#cb80-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r raw-data}</span></span>
<span id="cb80-136"><a href="#cb80-136" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'data/previous/RedditData_Raw.rds'</span>)</span>
<span id="cb80-137"><a href="#cb80-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-138"><a href="#cb80-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-139"><a href="#cb80-139" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extracting Age &amp; Gender Information</span></span>
<span id="cb80-140"><a href="#cb80-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-141"><a href="#cb80-141" aria-hidden="true" tabindex="-1"></a><span class="al">![](./img/Age_Gender_info_example_red.png)</span></span>
<span id="cb80-142"><a href="#cb80-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-143"><a href="#cb80-143" aria-hidden="true" tabindex="-1"></a>In a next step, we extracted age and gender information on the author's of a post from the titles of the Reddit posts. On the one hand, we did this extraction with regex:</span>
<span id="cb80-144"><a href="#cb80-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-145"><a href="#cb80-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-info, echo = FALSE}</span></span>
<span id="cb80-146"><a href="#cb80-146" aria-hidden="true" tabindex="-1"></a><span class="co"># detecting posts containing age + gender information in title (in () or [] )</span></span>
<span id="cb80-147"><a href="#cb80-147" aria-hidden="true" tabindex="-1"></a>detector <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">"(^|(</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S*</span><span class="sc">\\</span><span class="st">s)|(</span><span class="sc">\\</span><span class="st">S*</span><span class="sc">\\</span><span class="st">s)|(</span><span class="sc">\\</span><span class="st">S*))[</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">[](?&lt;=[</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">[]).{1,20}?(?=[</span><span class="sc">\\</span><span class="st">)</span><span class="sc">\\</span><span class="st">]])[</span><span class="sc">\\</span><span class="st">)</span><span class="sc">\\</span><span class="st">]]"</span>, data<span class="sc">$</span>title, <span class="at">perl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-148"><a href="#cb80-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-149"><a href="#cb80-149" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb80-150"><a href="#cb80-150" aria-hidden="true" tabindex="-1"></a>demo <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(data<span class="sc">$</span>title,<span class="st">"(^|(</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S*</span><span class="sc">\\</span><span class="st">s)|(</span><span class="sc">\\</span><span class="st">S*</span><span class="sc">\\</span><span class="st">s)|(</span><span class="sc">\\</span><span class="st">S*))[</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">[](?&lt;=[</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">[]).{1,20}?(?=[</span><span class="sc">\\</span><span class="st">)</span><span class="sc">\\</span><span class="st">]])[</span><span class="sc">\\</span><span class="st">)</span><span class="sc">\\</span><span class="st">]]"</span>)</span>
<span id="cb80-151"><a href="#cb80-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-152"><a href="#cb80-152" aria-hidden="true" tabindex="-1"></a><span class="co"># data preparation function to format extracted demographic information</span></span>
<span id="cb80-153"><a href="#cb80-153" aria-hidden="true" tabindex="-1"></a>dataprep <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb80-154"><a href="#cb80-154" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">trimws</span>(x)</span>
<span id="cb80-155"><a href="#cb80-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(x) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-156"><a href="#cb80-156" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">tolower</span>(x)</span>
<span id="cb80-157"><a href="#cb80-157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-158"><a href="#cb80-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-159"><a href="#cb80-159" aria-hidden="true" tabindex="-1"></a><span class="co"># applying function to all list elements</span></span>
<span id="cb80-160"><a href="#cb80-160" aria-hidden="true" tabindex="-1"></a>demo_prep <span class="ot">&lt;-</span> <span class="fu">lapply</span>(demo, dataprep)</span>
<span id="cb80-161"><a href="#cb80-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-162"><a href="#cb80-162" aria-hidden="true" tabindex="-1"></a><span class="co"># replacing the empty list elements with NAs</span></span>
<span id="cb80-163"><a href="#cb80-163" aria-hidden="true" tabindex="-1"></a>demo_prep[<span class="fu">sapply</span>(demo_prep,length) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb80-164"><a href="#cb80-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-165"><a href="#cb80-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-166"><a href="#cb80-166" aria-hidden="true" tabindex="-1"></a><span class="al">![Demographic Information on r/relationships](./img/Age_Gender_info_example_green.png)</span></span>
<span id="cb80-167"><a href="#cb80-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb80-168"><a href="#cb80-168" aria-hidden="true" tabindex="-1"></a><span class="co"># we now want to distinguish between author and others using regex (THE ^ IN THE SECOND BRACKETS MIGHT CAUSE PROBLEMS)</span></span>
<span id="cb80-169"><a href="#cb80-169" aria-hidden="true" tabindex="-1"></a>author_pronouns <span class="ot">&lt;-</span> <span class="st">"(^|</span><span class="sc">\\</span><span class="st">s)(^|me|i|my|myself|i'm|i’m|im|i`m|i´m|i've|i’ve|i`ve|i´ve|ive|i'll|i’ll|i´ll|i`ll)(</span><span class="sc">\\</span><span class="st">s|</span><span class="sc">\\</span><span class="st">(|</span><span class="sc">\\</span><span class="st">[)(|</span><span class="sc">\\</span><span class="st">(|</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">d)(.*?)(</span><span class="sc">\\</span><span class="st">)|</span><span class="sc">\\</span><span class="st">])"</span></span>
<span id="cb80-170"><a href="#cb80-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-171"><a href="#cb80-171" aria-hidden="true" tabindex="-1"></a><span class="co"># extracting age + gender info for authors (we need to write a function for this)</span></span>
<span id="cb80-172"><a href="#cb80-172" aria-hidden="true" tabindex="-1"></a>AuthorExtraction <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb80-173"><a href="#cb80-173" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract author information indicated by pronouns</span></span>
<span id="cb80-174"><a href="#cb80-174" aria-hidden="true" tabindex="-1"></a>  Author <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(x,author_pronouns)</span>
<span id="cb80-175"><a href="#cb80-175" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fixing empty string+</span></span>
<span id="cb80-176"><a href="#cb80-176" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(Author[[<span class="dv">1</span>]]) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb80-177"><a href="#cb80-177" aria-hidden="true" tabindex="-1"></a>    Author[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb80-178"><a href="#cb80-178" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-179"><a href="#cb80-179" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return result</span></span>
<span id="cb80-180"><a href="#cb80-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Author)</span>
<span id="cb80-181"><a href="#cb80-181" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-182"><a href="#cb80-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-183"><a href="#cb80-183" aria-hidden="true" tabindex="-1"></a><span class="co"># applying the function to every list element while preserving list structure</span></span>
<span id="cb80-184"><a href="#cb80-184" aria-hidden="true" tabindex="-1"></a>AuthorInfoList <span class="ot">&lt;-</span> <span class="fu">rapply</span>(demo_prep,AuthorExtraction, <span class="at">how =</span> <span class="st">"list"</span>, <span class="at">deflt =</span> <span class="cn">NA</span>)</span>
<span id="cb80-185"><a href="#cb80-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-186"><a href="#cb80-186" aria-hidden="true" tabindex="-1"></a><span class="co"># replacing the "character (0)" strings for empty elements with NA</span></span>
<span id="cb80-187"><a href="#cb80-187" aria-hidden="true" tabindex="-1"></a>AuthorInfoList <span class="ot">&lt;-</span> <span class="fu">rapply</span>(AuthorInfoList,<span class="cf">function</span>(x){<span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">0</span>) {<span class="fu">return</span>(<span class="cn">NA</span>)}<span class="cf">else</span> {<span class="fu">return</span>(x)}},<span class="at">how =</span> <span class="st">"list"</span>, <span class="at">deflt =</span> <span class="cn">NA</span>)</span>
<span id="cb80-188"><a href="#cb80-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-189"><a href="#cb80-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for extracting demographic indicators for authors</span></span>
<span id="cb80-190"><a href="#cb80-190" aria-hidden="true" tabindex="-1"></a>SublistExtractor <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb80-191"><a href="#cb80-191" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if we only have one instance, just return it</span></span>
<span id="cb80-192"><a href="#cb80-192" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">1</span>) {<span class="fu">return</span>(x)}</span>
<span id="cb80-193"><a href="#cb80-193" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if we have more than one instance, we return</span></span>
<span id="cb80-194"><a href="#cb80-194" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the first instance that is *not* NA</span></span>
<span id="cb80-195"><a href="#cb80-195" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">&gt;</span> <span class="dv">1</span>) {<span class="fu">return</span>(<span class="fu">unlist</span>(x)[<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">unlist</span>(x))])}</span>
<span id="cb80-196"><a href="#cb80-196" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-197"><a href="#cb80-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-198"><a href="#cb80-198" aria-hidden="true" tabindex="-1"></a><span class="co"># Applying the function</span></span>
<span id="cb80-199"><a href="#cb80-199" aria-hidden="true" tabindex="-1"></a>AuthorInfo <span class="ot">&lt;-</span> <span class="fu">sapply</span>(AuthorInfoList, SublistExtractor)</span>
<span id="cb80-200"><a href="#cb80-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-201"><a href="#cb80-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting only the information between the brackets</span></span>
<span id="cb80-202"><a href="#cb80-202" aria-hidden="true" tabindex="-1"></a>AuthorInfo <span class="ot">&lt;-</span> <span class="fu">sapply</span>(AuthorInfo, <span class="cf">function</span>(x){<span class="fu">str_extract_all</span>(<span class="fu">unlist</span>(x),<span class="st">"(?&lt;=(</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">())(.*?)(?=(</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">)))"</span>)})</span>
<span id="cb80-203"><a href="#cb80-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-204"><a href="#cb80-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-205"><a href="#cb80-205" aria-hidden="true" tabindex="-1"></a>checking how much info we have per row</span>
<span id="cb80-208"><a href="#cb80-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-209"><a href="#cb80-209" aria-hidden="true" tabindex="-1"></a><span class="co"># how many author info boxes we detect per post</span></span>
<span id="cb80-210"><a href="#cb80-210" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">sapply</span>(AuthorInfo,length))</span>
<span id="cb80-211"><a href="#cb80-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-212"><a href="#cb80-212" aria-hidden="true" tabindex="-1"></a><span class="co"># how many posts have more than one author info box detected</span></span>
<span id="cb80-213"><a href="#cb80-213" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">sapply</span>(AuthorInfo,length) <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb80-214"><a href="#cb80-214" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">sapply</span>(AuthorInfo,length) <span class="sc">&gt;</span> <span class="dv">1</span>))</span>
<span id="cb80-215"><a href="#cb80-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-216"><a href="#cb80-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-217"><a href="#cb80-217" aria-hidden="true" tabindex="-1"></a>**PROBLEM:** How do we decide which author info to take if we have multiple based on "I" and "My" indicators?</span>
<span id="cb80-218"><a href="#cb80-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-219"><a href="#cb80-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-220"><a href="#cb80-220" aria-hidden="true" tabindex="-1"></a><span class="al">![Author vs. other Information on r/relationships](./img/Age_Gender_info_example_green.png)</span></span>
<span id="cb80-221"><a href="#cb80-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-222"><a href="#cb80-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE, echo = FALSE}</span></span>
<span id="cb80-223"><a href="#cb80-223" aria-hidden="true" tabindex="-1"></a><span class="co"># Take I indicator over my/me indicator</span></span>
<span id="cb80-224"><a href="#cb80-224" aria-hidden="true" tabindex="-1"></a>AuthorInfo[<span class="fu">sapply</span>(AuthorInfo,length) <span class="sc">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb80-225"><a href="#cb80-225" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>title[<span class="fu">sapply</span>(AuthorInfo,length) <span class="sc">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb80-226"><a href="#cb80-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-227"><a href="#cb80-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-228"><a href="#cb80-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE, output = FALSE, include = FALSE}</span></span>
<span id="cb80-229"><a href="#cb80-229" aria-hidden="true" tabindex="-1"></a><span class="co"># function for deciding on the Author demographics in a smart way</span></span>
<span id="cb80-230"><a href="#cb80-230" aria-hidden="true" tabindex="-1"></a>AuthorDecider <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb80-231"><a href="#cb80-231" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do nothing if we only have one indication</span></span>
<span id="cb80-232"><a href="#cb80-232" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">1</span>) {<span class="fu">return</span>(x)}</span>
<span id="cb80-233"><a href="#cb80-233" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make smart decisions if we have more than 1 author indicator</span></span>
<span id="cb80-234"><a href="#cb80-234" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb80-235"><a href="#cb80-235" aria-hidden="true" tabindex="-1"></a>    <span class="co"># checking if I indicator is present</span></span>
<span id="cb80-236"><a href="#cb80-236" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">grepl</span>(<span class="st">"i"</span>,x))) {</span>
<span id="cb80-237"><a href="#cb80-237" aria-hidden="true" tabindex="-1"></a>      <span class="co"># taking the first instance of the I indicator</span></span>
<span id="cb80-238"><a href="#cb80-238" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> x[<span class="fu">grepl</span>(<span class="st">"i"</span>,x)][<span class="dv">1</span>]</span>
<span id="cb80-239"><a href="#cb80-239" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb80-240"><a href="#cb80-240" aria-hidden="true" tabindex="-1"></a>      <span class="co"># checking if me indicator is present</span></span>
<span id="cb80-241"><a href="#cb80-241" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">grepl</span>(<span class="st">"me"</span>,x))) {</span>
<span id="cb80-242"><a href="#cb80-242" aria-hidden="true" tabindex="-1"></a>        <span class="co"># taking the first instance of the Me indicator</span></span>
<span id="cb80-243"><a href="#cb80-243" aria-hidden="true" tabindex="-1"></a>        x <span class="ot">&lt;-</span> x[<span class="fu">grepl</span>(<span class="st">"me"</span>,x)][<span class="dv">1</span>]</span>
<span id="cb80-244"><a href="#cb80-244" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb80-245"><a href="#cb80-245" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if neither I nor Me indicator are present, we just take the first instance</span></span>
<span id="cb80-246"><a href="#cb80-246" aria-hidden="true" tabindex="-1"></a>        x <span class="ot">&lt;-</span> x[<span class="dv">1</span>]</span>
<span id="cb80-247"><a href="#cb80-247" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb80-248"><a href="#cb80-248" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-249"><a href="#cb80-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-250"><a href="#cb80-250" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-251"><a href="#cb80-251" aria-hidden="true" tabindex="-1"></a>  <span class="co"># returning Author info</span></span>
<span id="cb80-252"><a href="#cb80-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb80-253"><a href="#cb80-253" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-254"><a href="#cb80-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-255"><a href="#cb80-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Applying function and checking it's performance</span></span>
<span id="cb80-256"><a href="#cb80-256" aria-hidden="true" tabindex="-1"></a>AuthorInfo <span class="ot">&lt;-</span> <span class="fu">sapply</span>(AuthorInfo,AuthorDecider)</span>
<span id="cb80-257"><a href="#cb80-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-258"><a href="#cb80-258" aria-hidden="true" tabindex="-1"></a><span class="co"># setting the cases without info to NA</span></span>
<span id="cb80-259"><a href="#cb80-259" aria-hidden="true" tabindex="-1"></a>AuthorInfo[<span class="fu">sapply</span>(AuthorInfo,length) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb80-260"><a href="#cb80-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-261"><a href="#cb80-261" aria-hidden="true" tabindex="-1"></a><span class="co"># length check</span></span>
<span id="cb80-262"><a href="#cb80-262" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(AuthorInfo)</span>
<span id="cb80-263"><a href="#cb80-263" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">sapply</span>(AuthorInfo,length))</span>
<span id="cb80-264"><a href="#cb80-264" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">rapply</span>(AuthorInfo,length))</span>
<span id="cb80-265"><a href="#cb80-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-266"><a href="#cb80-266" aria-hidden="true" tabindex="-1"></a><span class="co"># making absolutely sure we reassign empty strings as NA</span></span>
<span id="cb80-267"><a href="#cb80-267" aria-hidden="true" tabindex="-1"></a>AuthorInfo[<span class="fu">rapply</span>(AuthorInfo,length) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb80-268"><a href="#cb80-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-269"><a href="#cb80-269" aria-hidden="true" tabindex="-1"></a><span class="co"># dealing with the two odd strings that are too long</span></span>
<span id="cb80-270"><a href="#cb80-270" aria-hidden="true" tabindex="-1"></a>AuthorInfo[<span class="fu">rapply</span>(AuthorInfo,length) <span class="sc">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb80-271"><a href="#cb80-271" aria-hidden="true" tabindex="-1"></a>AuthorInfo[<span class="fu">rapply</span>(AuthorInfo,length) <span class="sc">&gt;</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb80-272"><a href="#cb80-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-273"><a href="#cb80-273" aria-hidden="true" tabindex="-1"></a><span class="co"># redoiing length check</span></span>
<span id="cb80-274"><a href="#cb80-274" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(AuthorInfo)</span>
<span id="cb80-275"><a href="#cb80-275" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">sapply</span>(AuthorInfo,length))</span>
<span id="cb80-276"><a href="#cb80-276" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">rapply</span>(AuthorInfo,length))</span>
<span id="cb80-277"><a href="#cb80-277" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">rapply</span>(AuthorInfo,length)))</span>
<span id="cb80-278"><a href="#cb80-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-279"><a href="#cb80-279" aria-hidden="true" tabindex="-1"></a><span class="co"># Unlisting the extracted information</span></span>
<span id="cb80-280"><a href="#cb80-280" aria-hidden="true" tabindex="-1"></a>AuthorInfo <span class="ot">&lt;-</span> <span class="fu">unlist</span>(AuthorInfo)</span>
<span id="cb80-281"><a href="#cb80-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-282"><a href="#cb80-282" aria-hidden="true" tabindex="-1"></a><span class="co"># preparing AuthorInfo variable by replacing formatting issue</span></span>
<span id="cb80-283"><a href="#cb80-283" aria-hidden="true" tabindex="-1"></a>AuthorInfo <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(AuthorInfo,<span class="st">"â\u0080\u0099"</span>,<span class="st">"'"</span>)</span>
<span id="cb80-284"><a href="#cb80-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-285"><a href="#cb80-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-286"><a href="#cb80-286" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking with visual sanity check</span></span>
<span id="cb80-287"><a href="#cb80-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-288"><a href="#cb80-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-291"><a href="#cb80-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-292"><a href="#cb80-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual sanity check</span></span>
<span id="cb80-293"><a href="#cb80-293" aria-hidden="true" tabindex="-1"></a>Test <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(data<span class="sc">$</span>title,AuthorInfo)</span>
<span id="cb80-294"><a href="#cb80-294" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Test) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-295"><a href="#cb80-295" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Test[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb80-296"><a href="#cb80-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-297"><a href="#cb80-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-298"><a href="#cb80-298" aria-hidden="true" tabindex="-1"></a> ### Splitting Age and Gender information</span>
<span id="cb80-299"><a href="#cb80-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-300"><a href="#cb80-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include= FALSE}</span></span>
<span id="cb80-301"><a href="#cb80-301" aria-hidden="true" tabindex="-1"></a><span class="do">### Author Age</span></span>
<span id="cb80-302"><a href="#cb80-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-303"><a href="#cb80-303" aria-hidden="true" tabindex="-1"></a><span class="co"># extracting author age to list</span></span>
<span id="cb80-304"><a href="#cb80-304" aria-hidden="true" tabindex="-1"></a>author_age <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(AuthorInfo,<span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span>
<span id="cb80-305"><a href="#cb80-305" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(author_age) <span class="sc">==</span> <span class="fu">length</span>(AuthorInfo) <span class="co"># This should always return TRUE, we have a problem if it doesn't</span></span>
<span id="cb80-306"><a href="#cb80-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-307"><a href="#cb80-307" aria-hidden="true" tabindex="-1"></a><span class="co"># There are some cases were there is no age, this is indicated with empty strings that get dropped</span></span>
<span id="cb80-308"><a href="#cb80-308" aria-hidden="true" tabindex="-1"></a><span class="co"># when we unlist, so we have to assign them an NA first</span></span>
<span id="cb80-309"><a href="#cb80-309" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">sapply</span>(author_age,length))</span>
<span id="cb80-310"><a href="#cb80-310" aria-hidden="true" tabindex="-1"></a>author_age[<span class="fu">sapply</span>(author_age,length) <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb80-311"><a href="#cb80-311" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">sapply</span>(author_age,length) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb80-312"><a href="#cb80-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-313"><a href="#cb80-313" aria-hidden="true" tabindex="-1"></a><span class="co"># setting those instances to NA</span></span>
<span id="cb80-314"><a href="#cb80-314" aria-hidden="true" tabindex="-1"></a>author_age[<span class="fu">which</span>(<span class="fu">sapply</span>(author_age,length) <span class="sc">==</span> <span class="dv">0</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb80-315"><a href="#cb80-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-316"><a href="#cb80-316" aria-hidden="true" tabindex="-1"></a><span class="co"># rechecking</span></span>
<span id="cb80-317"><a href="#cb80-317" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">sapply</span>(author_age,length))</span>
<span id="cb80-318"><a href="#cb80-318" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">sapply</span>(author_age,length)))</span>
<span id="cb80-319"><a href="#cb80-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-320"><a href="#cb80-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-321"><a href="#cb80-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-322"><a href="#cb80-322" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multiple ages</span></span>
<span id="cb80-325"><a href="#cb80-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-326"><a href="#cb80-326" aria-hidden="true" tabindex="-1"></a><span class="co"># there are some instances were we extracted multiple numbers</span></span>
<span id="cb80-327"><a href="#cb80-327" aria-hidden="true" tabindex="-1"></a><span class="co"># this is because some people are writing the information of multiple</span></span>
<span id="cb80-328"><a href="#cb80-328" aria-hidden="true" tabindex="-1"></a><span class="co"># people into one set of brackets. This is only the case however</span></span>
<span id="cb80-329"><a href="#cb80-329" aria-hidden="true" tabindex="-1"></a><span class="co"># for less than 0.003 % of posts</span></span>
<span id="cb80-330"><a href="#cb80-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-331"><a href="#cb80-331" aria-hidden="true" tabindex="-1"></a><span class="co"># Examples:</span></span>
<span id="cb80-332"><a href="#cb80-332" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[<span class="fu">sapply</span>(author_age,length) <span class="sc">&gt;</span> <span class="dv">1</span>,]<span class="sc">$</span>title[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])</span>
<span id="cb80-333"><a href="#cb80-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-334"><a href="#cb80-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-335"><a href="#cb80-335" aria-hidden="true" tabindex="-1"></a><span class="fu">### Taking first instances</span></span>
<span id="cb80-338"><a href="#cb80-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-339"><a href="#cb80-339" aria-hidden="true" tabindex="-1"></a><span class="co"># From visual inspection, it seems safe to assume that the first</span></span>
<span id="cb80-340"><a href="#cb80-340" aria-hidden="true" tabindex="-1"></a><span class="co"># indication is usually the age of the author, consequently, we</span></span>
<span id="cb80-341"><a href="#cb80-341" aria-hidden="true" tabindex="-1"></a><span class="co"># always take the first value</span></span>
<span id="cb80-342"><a href="#cb80-342" aria-hidden="true" tabindex="-1"></a>author_age <span class="ot">&lt;-</span> <span class="fu">sapply</span>(author_age, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb80-343"><a href="#cb80-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-344"><a href="#cb80-344" aria-hidden="true" tabindex="-1"></a><span class="co"># rechecking</span></span>
<span id="cb80-345"><a href="#cb80-345" aria-hidden="true" tabindex="-1"></a><span class="co">#table(sapply(author_age,length))</span></span>
<span id="cb80-346"><a href="#cb80-346" aria-hidden="true" tabindex="-1"></a><span class="co">#prop.table(table(sapply(author_age,length)))</span></span>
<span id="cb80-347"><a href="#cb80-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-348"><a href="#cb80-348" aria-hidden="true" tabindex="-1"></a><span class="co"># finally, we transform to numeric</span></span>
<span id="cb80-349"><a href="#cb80-349" aria-hidden="true" tabindex="-1"></a>author_age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(author_age)</span>
<span id="cb80-350"><a href="#cb80-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-351"><a href="#cb80-351" aria-hidden="true" tabindex="-1"></a><span class="co"># first results</span></span>
<span id="cb80-352"><a href="#cb80-352" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(author_age)</span>
<span id="cb80-353"><a href="#cb80-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-354"><a href="#cb80-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-355"><a href="#cb80-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-356"><a href="#cb80-356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dealing with weird cases</span></span>
<span id="cb80-359"><a href="#cb80-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-360"><a href="#cb80-360" aria-hidden="true" tabindex="-1"></a><span class="co"># we have some unreasonably large and small numbers in there</span></span>
<span id="cb80-361"><a href="#cb80-361" aria-hidden="true" tabindex="-1"></a><span class="co"># (and some zeros)</span></span>
<span id="cb80-362"><a href="#cb80-362" aria-hidden="true" tabindex="-1"></a><span class="co"># lets check what went wrong there:</span></span>
<span id="cb80-363"><a href="#cb80-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-364"><a href="#cb80-364" aria-hidden="true" tabindex="-1"></a><span class="co"># The zeros are almost exclusively from people pasting the example</span></span>
<span id="cb80-365"><a href="#cb80-365" aria-hidden="true" tabindex="-1"></a><span class="co"># title format as their own title, we should exclude those posts</span></span>
<span id="cb80-366"><a href="#cb80-366" aria-hidden="true" tabindex="-1"></a><span class="co"># later</span></span>
<span id="cb80-367"><a href="#cb80-367" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[author_age <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(author_age),]<span class="sc">$</span>title)</span>
<span id="cb80-368"><a href="#cb80-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-369"><a href="#cb80-369" aria-hidden="true" tabindex="-1"></a><span class="co"># The people who indicate an age above 100 are basically 50/50</span></span>
<span id="cb80-370"><a href="#cb80-370" aria-hidden="true" tabindex="-1"></a><span class="co"># between typos and trolls, but we can throw this away as it's</span></span>
<span id="cb80-371"><a href="#cb80-371" aria-hidden="true" tabindex="-1"></a><span class="co"># not that much data. It's also little enough data to manually</span></span>
<span id="cb80-372"><a href="#cb80-372" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb80-373"><a href="#cb80-373" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[author_age <span class="sc">&gt;=</span> <span class="dv">100</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(author_age),]<span class="sc">$</span>title)</span>
<span id="cb80-374"><a href="#cb80-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-375"><a href="#cb80-375" aria-hidden="true" tabindex="-1"></a><span class="co"># These are usually people talking about their children, trolls</span></span>
<span id="cb80-376"><a href="#cb80-376" aria-hidden="true" tabindex="-1"></a><span class="co"># or people with an unusual infobox e.g. (M2F) for transgender</span></span>
<span id="cb80-377"><a href="#cb80-377" aria-hidden="true" tabindex="-1"></a><span class="co"># As these cases are not that many, we can exlcude them</span></span>
<span id="cb80-378"><a href="#cb80-378" aria-hidden="true" tabindex="-1"></a><span class="co"># They also frequently contain typos like 2F instead of 23F or</span></span>
<span id="cb80-379"><a href="#cb80-379" aria-hidden="true" tabindex="-1"></a><span class="co"># anonymizations like 2XM for a man in his twenties</span></span>
<span id="cb80-380"><a href="#cb80-380" aria-hidden="true" tabindex="-1"></a>UnderageFrame <span class="ot">&lt;-</span> data[(author_age <span class="sc">&lt;</span> <span class="dv">11</span> <span class="sc">&amp;</span></span>
<span id="cb80-381"><a href="#cb80-381" aria-hidden="true" tabindex="-1"></a>                         author_age <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb80-382"><a href="#cb80-382" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!</span><span class="fu">is.na</span>(author_age)),]</span>
<span id="cb80-383"><a href="#cb80-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-384"><a href="#cb80-384" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(UnderageFrame<span class="sc">$</span>title)</span>
<span id="cb80-385"><a href="#cb80-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-386"><a href="#cb80-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-387"><a href="#cb80-387" aria-hidden="true" tabindex="-1"></a><span class="fu">### Distribution of reasonable age range</span></span>
<span id="cb80-390"><a href="#cb80-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-391"><a href="#cb80-391" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting age distribution of author age for ages between 10 and 100</span></span>
<span id="cb80-392"><a href="#cb80-392" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">as.numeric</span>(author_age[author_age <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> author_age <span class="sc">&lt;</span> <span class="dv">100</span>]))</span>
<span id="cb80-393"><a href="#cb80-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-394"><a href="#cb80-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-395"><a href="#cb80-395" aria-hidden="true" tabindex="-1"></a><span class="fu">### Building age groups</span></span>
<span id="cb80-398"><a href="#cb80-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-399"><a href="#cb80-399" aria-hidden="true" tabindex="-1"></a><span class="co"># We create a factor level for age as well for easier breakdown in further analysis, levels are</span></span>
<span id="cb80-400"><a href="#cb80-400" aria-hidden="true" tabindex="-1"></a>author_age_group <span class="ot">&lt;-</span> author_age</span>
<span id="cb80-401"><a href="#cb80-401" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">&lt;=</span> <span class="dv">20</span>] <span class="ot">&lt;-</span> <span class="st">"&lt;21"</span></span>
<span id="cb80-402"><a href="#cb80-402" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">&gt;=</span> <span class="dv">21</span> <span class="sc">&amp;</span> author_age_group <span class="sc">&lt;=</span> <span class="dv">30</span>] <span class="ot">&lt;-</span> <span class="st">"21-30"</span></span>
<span id="cb80-403"><a href="#cb80-403" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">&gt;=</span> <span class="dv">31</span> <span class="sc">&amp;</span> author_age_group <span class="sc">&lt;=</span> <span class="dv">40</span>] <span class="ot">&lt;-</span> <span class="st">"31-40"</span></span>
<span id="cb80-404"><a href="#cb80-404" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">&gt;=</span> <span class="dv">41</span> <span class="sc">&amp;</span> author_age_group <span class="sc">&lt;=</span> <span class="dv">50</span>] <span class="ot">&lt;-</span> <span class="st">"41-50"</span></span>
<span id="cb80-405"><a href="#cb80-405" aria-hidden="true" tabindex="-1"></a>author_age_group[author_age_group <span class="sc">!=</span> <span class="st">"&lt;21"</span> <span class="sc">&amp;</span></span>
<span id="cb80-406"><a href="#cb80-406" aria-hidden="true" tabindex="-1"></a>                        author_age_group <span class="sc">!=</span> <span class="st">"21-30"</span> <span class="sc">&amp;</span> </span>
<span id="cb80-407"><a href="#cb80-407" aria-hidden="true" tabindex="-1"></a>                        author_age_group <span class="sc">!=</span> <span class="st">"31-40"</span>  <span class="sc">&amp;</span></span>
<span id="cb80-408"><a href="#cb80-408" aria-hidden="true" tabindex="-1"></a>                        author_age_group <span class="sc">!=</span> <span class="st">"41-50"</span>] <span class="ot">&lt;-</span> <span class="st">"&gt;50"</span></span>
<span id="cb80-409"><a href="#cb80-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-410"><a href="#cb80-410" aria-hidden="true" tabindex="-1"></a><span class="co"># checking variable</span></span>
<span id="cb80-411"><a href="#cb80-411" aria-hidden="true" tabindex="-1"></a><span class="co">#class(author_age_group)</span></span>
<span id="cb80-412"><a href="#cb80-412" aria-hidden="true" tabindex="-1"></a>author_age_group <span class="ot">&lt;-</span> <span class="fu">factor</span>(author_age_group,</span>
<span id="cb80-413"><a href="#cb80-413" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,</span>
<span id="cb80-414"><a href="#cb80-414" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"21-30"</span>,</span>
<span id="cb80-415"><a href="#cb80-415" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"31-40"</span>,</span>
<span id="cb80-416"><a href="#cb80-416" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"41-50"</span>,</span>
<span id="cb80-417"><a href="#cb80-417" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"&gt;50"</span>))</span>
<span id="cb80-418"><a href="#cb80-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-419"><a href="#cb80-419" aria-hidden="true" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb80-420"><a href="#cb80-420" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(author_age,author_age_group, <span class="at">useNA =</span> <span class="st">"ifany"</span>)</span>
<span id="cb80-421"><a href="#cb80-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-422"><a href="#cb80-422" aria-hidden="true" tabindex="-1"></a><span class="co"># Missing values</span></span>
<span id="cb80-423"><a href="#cb80-423" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">is.na</span>(author_age_group))</span>
<span id="cb80-424"><a href="#cb80-424" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">is.na</span>(author_age_group)))</span>
<span id="cb80-425"><a href="#cb80-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-426"><a href="#cb80-426" aria-hidden="true" tabindex="-1"></a><span class="co"># age group</span></span>
<span id="cb80-427"><a href="#cb80-427" aria-hidden="true" tabindex="-1"></a><span class="co">#table(author_age_group, author_age, useNA = "ifany")</span></span>
<span id="cb80-428"><a href="#cb80-428" aria-hidden="true" tabindex="-1"></a><span class="co">#prop.table(table(author_age_group))</span></span>
<span id="cb80-429"><a href="#cb80-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-430"><a href="#cb80-430" aria-hidden="true" tabindex="-1"></a><span class="co"># lets bind everything together for easier subsetting</span></span>
<span id="cb80-431"><a href="#cb80-431" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(data,author_age,author_age_group, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-432"><a href="#cb80-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-433"><a href="#cb80-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-434"><a href="#cb80-434" aria-hidden="true" tabindex="-1"></a><span class="fu">### Non cis-gendered Authors</span></span>
<span id="cb80-435"><a href="#cb80-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE}</span></span>
<span id="cb80-436"><a href="#cb80-436" aria-hidden="true" tabindex="-1"></a><span class="co"># having a look at the unusual cases</span></span>
<span id="cb80-437"><a href="#cb80-437" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">sapply</span>(AuthorInfo,nchar) <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(AuthorInfo)])</span>
<span id="cb80-438"><a href="#cb80-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-439"><a href="#cb80-439" aria-hidden="true" tabindex="-1"></a><span class="co"># there are a few specific things that pop up often</span></span>
<span id="cb80-440"><a href="#cb80-440" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"relationship"</span>,AuthorInfo)])</span>
<span id="cb80-441"><a href="#cb80-441" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"update"</span>,AuthorInfo)])</span>
<span id="cb80-442"><a href="#cb80-442" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"advice"</span>,AuthorInfo)])</span>
<span id="cb80-443"><a href="#cb80-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-444"><a href="#cb80-444" aria-hidden="true" tabindex="-1"></a><span class="co"># In these cases, we often have information that doesn't fit the standard formatting.</span></span>
<span id="cb80-445"><a href="#cb80-445" aria-hidden="true" tabindex="-1"></a><span class="co"># For the most part, it's save to just extract the instance of m or f as the gender from</span></span>
<span id="cb80-446"><a href="#cb80-446" aria-hidden="true" tabindex="-1"></a><span class="co"># the author info, however, we need to pay special attention to the terms</span></span>
<span id="cb80-447"><a href="#cb80-447" aria-hidden="true" tabindex="-1"></a><span class="co"># -trans</span></span>
<span id="cb80-448"><a href="#cb80-448" aria-hidden="true" tabindex="-1"></a><span class="co"># -mtf</span></span>
<span id="cb80-449"><a href="#cb80-449" aria-hidden="true" tabindex="-1"></a><span class="co"># -ftm</span></span>
<span id="cb80-450"><a href="#cb80-450" aria-hidden="true" tabindex="-1"></a><span class="co"># -nb</span></span>
<span id="cb80-451"><a href="#cb80-451" aria-hidden="true" tabindex="-1"></a><span class="co"># -non-binary</span></span>
<span id="cb80-452"><a href="#cb80-452" aria-hidden="true" tabindex="-1"></a><span class="co"># We should also check how often the following terms appear</span></span>
<span id="cb80-453"><a href="#cb80-453" aria-hidden="true" tabindex="-1"></a><span class="co">#- gay</span></span>
<span id="cb80-454"><a href="#cb80-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-455"><a href="#cb80-455" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"trans"</span>,AuthorInfo)])</span>
<span id="cb80-456"><a href="#cb80-456" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"mtf"</span>,AuthorInfo)])</span>
<span id="cb80-457"><a href="#cb80-457" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"m2f"</span>,AuthorInfo)])</span>
<span id="cb80-458"><a href="#cb80-458" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"ftm"</span>,AuthorInfo)])</span>
<span id="cb80-459"><a href="#cb80-459" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"f2m"</span>,AuthorInfo)])</span>
<span id="cb80-460"><a href="#cb80-460" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"nb"</span>,AuthorInfo)])</span>
<span id="cb80-461"><a href="#cb80-461" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"non-binary"</span>,AuthorInfo)])</span>
<span id="cb80-462"><a href="#cb80-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-463"><a href="#cb80-463" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"gay"</span>,AuthorInfo)])</span>
<span id="cb80-464"><a href="#cb80-464" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">grep</span>(<span class="st">"lesbian"</span>,AuthorInfo)])</span>
<span id="cb80-465"><a href="#cb80-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-466"><a href="#cb80-466" aria-hidden="true" tabindex="-1"></a><span class="co"># We should first extract the gender only using the (m/f) indicator</span></span>
<span id="cb80-467"><a href="#cb80-467" aria-hidden="true" tabindex="-1"></a><span class="co"># and then add corrections where-ever necessary</span></span>
<span id="cb80-468"><a href="#cb80-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-469"><a href="#cb80-469" aria-hidden="true" tabindex="-1"></a><span class="co"># extracting gender from author variable</span></span>
<span id="cb80-470"><a href="#cb80-470" aria-hidden="true" tabindex="-1"></a>author_gender <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(AuthorInfo,<span class="st">"(f|m)"</span>)</span>
<span id="cb80-471"><a href="#cb80-471" aria-hidden="true" tabindex="-1"></a>author_gender[author_gender <span class="sc">==</span> <span class="st">"character(0)"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(author_gender)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb80-472"><a href="#cb80-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-473"><a href="#cb80-473" aria-hidden="true" tabindex="-1"></a><span class="co"># There is an issue: We sometimes get two matching gender indicators from the titles</span></span>
<span id="cb80-474"><a href="#cb80-474" aria-hidden="true" tabindex="-1"></a><span class="co"># This usually happens when people mention something else within their self-description in brackets</span></span>
<span id="cb80-475"><a href="#cb80-475" aria-hidden="true" tabindex="-1"></a><span class="co"># such as their sexual orientation or something unrelated. As convention, we just take the first instance</span></span>
<span id="cb80-476"><a href="#cb80-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-477"><a href="#cb80-477" aria-hidden="true" tabindex="-1"></a><span class="co"># checking how many ambiguities are present and where they are</span></span>
<span id="cb80-478"><a href="#cb80-478" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(author_gender[<span class="fu">sapply</span>(author_gender,length) <span class="sc">&gt;</span> <span class="dv">1</span>])</span>
<span id="cb80-479"><a href="#cb80-479" aria-hidden="true" tabindex="-1"></a><span class="co">#which(sapply(author_gender,length) &gt; 1)</span></span>
<span id="cb80-480"><a href="#cb80-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-481"><a href="#cb80-481" aria-hidden="true" tabindex="-1"></a><span class="co"># checking with which titles it occurs</span></span>
<span id="cb80-482"><a href="#cb80-482" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data<span class="sc">$</span>title[<span class="fu">which</span>(<span class="fu">sapply</span>(author_gender,length) <span class="sc">&gt;</span> <span class="dv">1</span>)])</span>
<span id="cb80-483"><a href="#cb80-483" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(AuthorInfo[<span class="fu">which</span>(<span class="fu">sapply</span>(author_gender,length) <span class="sc">&gt;</span> <span class="dv">1</span>)])</span>
<span id="cb80-484"><a href="#cb80-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-485"><a href="#cb80-485" aria-hidden="true" tabindex="-1"></a><span class="co"># taking only first element of every sublist</span></span>
<span id="cb80-486"><a href="#cb80-486" aria-hidden="true" tabindex="-1"></a>author_gender <span class="ot">&lt;-</span> <span class="fu">sapply</span>(author_gender, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb80-487"><a href="#cb80-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-488"><a href="#cb80-488" aria-hidden="true" tabindex="-1"></a><span class="co"># including trans indications</span></span>
<span id="cb80-489"><a href="#cb80-489" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grep</span>(<span class="st">"mtf"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"mtf"</span></span>
<span id="cb80-490"><a href="#cb80-490" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grep</span>(<span class="st">"m2f"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"mtf"</span></span>
<span id="cb80-491"><a href="#cb80-491" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grep</span>(<span class="st">"ftm"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"ftm"</span></span>
<span id="cb80-492"><a href="#cb80-492" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grep</span>(<span class="st">"f2m"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"ftm"</span></span>
<span id="cb80-493"><a href="#cb80-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-494"><a href="#cb80-494" aria-hidden="true" tabindex="-1"></a><span class="co"># setting trans indicators </span></span>
<span id="cb80-495"><a href="#cb80-495" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"trans"</span>,AuthorInfo) <span class="sc">&amp;</span> author_gender <span class="sc">==</span> <span class="st">"m"</span>] <span class="ot">&lt;-</span> <span class="st">"ftm"</span></span>
<span id="cb80-496"><a href="#cb80-496" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"trans"</span>,AuthorInfo) <span class="sc">&amp;</span> author_gender <span class="sc">==</span> <span class="st">"f"</span>] <span class="ot">&lt;-</span> <span class="st">"mtf"</span></span>
<span id="cb80-497"><a href="#cb80-497" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"trans"</span>,AuthorInfo) <span class="sc">&amp;</span> <span class="fu">is.na</span>(author_gender)] <span class="ot">&lt;-</span> <span class="st">"trans"</span></span>
<span id="cb80-498"><a href="#cb80-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-499"><a href="#cb80-499" aria-hidden="true" tabindex="-1"></a><span class="co"># setting non-binary indicator</span></span>
<span id="cb80-500"><a href="#cb80-500" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"nb"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"non-binary"</span></span>
<span id="cb80-501"><a href="#cb80-501" aria-hidden="true" tabindex="-1"></a>author_gender[<span class="fu">grepl</span>(<span class="st">"non-binary"</span>,AuthorInfo)] <span class="ot">&lt;-</span> <span class="st">"non-binary"</span></span>
<span id="cb80-502"><a href="#cb80-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-503"><a href="#cb80-503" aria-hidden="true" tabindex="-1"></a><span class="co"># first results</span></span>
<span id="cb80-504"><a href="#cb80-504" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(author_gender)</span>
<span id="cb80-505"><a href="#cb80-505" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(author_gender))</span>
<span id="cb80-506"><a href="#cb80-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-507"><a href="#cb80-507" aria-hidden="true" tabindex="-1"></a><span class="co"># adding author gender to the dataframe</span></span>
<span id="cb80-508"><a href="#cb80-508" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(data,author_gender, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-509"><a href="#cb80-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-510"><a href="#cb80-510" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual Sanity Check</span></span>
<span id="cb80-511"><a href="#cb80-511" aria-hidden="true" tabindex="-1"></a><span class="co">#View(data)</span></span>
<span id="cb80-512"><a href="#cb80-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-513"><a href="#cb80-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-514"><a href="#cb80-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clean-env1, include=FALSE, echo = FALSE}</span></span>
<span id="cb80-515"><a href="#cb80-515" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean environment (delete objects that we don't need anymore)</span></span>
<span id="cb80-516"><a href="#cb80-516" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(AuthorInfoList, demo, demo_prep, Test, UnderageFrame,</span>
<span id="cb80-517"><a href="#cb80-517" aria-hidden="true" tabindex="-1"></a>   author_age, author_age_group, author_gender, author_pronouns,</span>
<span id="cb80-518"><a href="#cb80-518" aria-hidden="true" tabindex="-1"></a>   AuthorInfo, detector, AuthorDecider, AuthorExtraction,</span>
<span id="cb80-519"><a href="#cb80-519" aria-hidden="true" tabindex="-1"></a>   dataprep, SublistExtractor)</span>
<span id="cb80-520"><a href="#cb80-520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-521"><a href="#cb80-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-522"><a href="#cb80-522" aria-hidden="true" tabindex="-1"></a><span class="fu">## Automated Gender and Age detection</span></span>
<span id="cb80-523"><a href="#cb80-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb80-524"><a href="#cb80-524" aria-hidden="true" tabindex="-1"></a><span class="do">#### script for interacting with gpt3 ####</span></span>
<span id="cb80-525"><a href="#cb80-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-526"><a href="#cb80-526" aria-hidden="true" tabindex="-1"></a><span class="do">## setting up access token as described here:</span></span>
<span id="cb80-527"><a href="#cb80-527" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/ben-aaron188/rgpt3</span></span>
<span id="cb80-528"><a href="#cb80-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-529"><a href="#cb80-529" aria-hidden="true" tabindex="-1"></a><span class="co"># installing package</span></span>
<span id="cb80-530"><a href="#cb80-530" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"ben-aaron188/rgpt3"</span>)</span>
<span id="cb80-531"><a href="#cb80-531" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgpt3)</span>
<span id="cb80-532"><a href="#cb80-532" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb80-533"><a href="#cb80-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-534"><a href="#cb80-534" aria-hidden="true" tabindex="-1"></a><span class="co"># authenticate access</span></span>
<span id="cb80-535"><a href="#cb80-535" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: BE CAREFUL, THIS IS LINKED TO CARSTENS PRIVATE CREDIT CARD!</span></span>
<span id="cb80-536"><a href="#cb80-536" aria-hidden="true" tabindex="-1"></a><span class="fu">gpt3_authenticate</span>(<span class="st">"./GPT_access_token//gpt3_token_carsten2.txt"</span>)</span>
<span id="cb80-537"><a href="#cb80-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-538"><a href="#cb80-538" aria-hidden="true" tabindex="-1"></a><span class="co"># make test request</span></span>
<span id="cb80-539"><a href="#cb80-539" aria-hidden="true" tabindex="-1"></a><span class="fu">gpt3_test_completion</span>()</span>
<span id="cb80-540"><a href="#cb80-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-541"><a href="#cb80-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-542"><a href="#cb80-542" aria-hidden="true" tabindex="-1"></a><span class="do">#### Testing author and gender attribution via gpt3 ####</span></span>
<span id="cb80-543"><a href="#cb80-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-544"><a href="#cb80-544" aria-hidden="true" tabindex="-1"></a><span class="co"># loading in data</span></span>
<span id="cb80-545"><a href="#cb80-545" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"./data_final/"</span>)</span>
<span id="cb80-546"><a href="#cb80-546" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>()</span>
<span id="cb80-547"><a href="#cb80-547" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"Reddit_relationship_data_final.Rdata"</span>)</span>
<span id="cb80-548"><a href="#cb80-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-549"><a href="#cb80-549" aria-hidden="true" tabindex="-1"></a><span class="co"># subsetting data</span></span>
<span id="cb80-550"><a href="#cb80-550" aria-hidden="true" tabindex="-1"></a><span class="co">#sample_size &lt;- 100</span></span>
<span id="cb80-551"><a href="#cb80-551" aria-hidden="true" tabindex="-1"></a><span class="co">#data_subset &lt;- data[sample(1:dim(data)[1],sample_size),]</span></span>
<span id="cb80-552"><a href="#cb80-552" aria-hidden="true" tabindex="-1"></a>data_subset <span class="ot">&lt;-</span> data</span>
<span id="cb80-553"><a href="#cb80-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-554"><a href="#cb80-554" aria-hidden="true" tabindex="-1"></a><span class="co"># constructing subset dataframe</span></span>
<span id="cb80-555"><a href="#cb80-555" aria-hidden="true" tabindex="-1"></a>preface <span class="ot">&lt;-</span> <span class="st">"Extract only the authors' self-indicated age and gender. Ignore anyone but the author: "</span></span>
<span id="cb80-556"><a href="#cb80-556" aria-hidden="true" tabindex="-1"></a>addon <span class="ot">&lt;-</span> <span class="st">"</span><span class="sc">\n</span><span class="st"> </span><span class="sc">\n</span><span class="st"> Do not include any additional text. If no info is available for the author, return NA"</span></span>
<span id="cb80-557"><a href="#cb80-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-558"><a href="#cb80-558" aria-hidden="true" tabindex="-1"></a>prompt_frame <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">prompt_role_var =</span> <span class="fu">rep</span>(<span class="st">"user"</span>,<span class="fu">dim</span>(data_subset)[<span class="dv">1</span>]),</span>
<span id="cb80-559"><a href="#cb80-559" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prompt_content_var =</span> <span class="fu">paste</span>(preface,data_subset<span class="sc">$</span>title,addon),</span>
<span id="cb80-560"><a href="#cb80-560" aria-hidden="true" tabindex="-1"></a>                           <span class="at">id_var =</span> data_subset<span class="sc">$</span>id)</span>
<span id="cb80-561"><a href="#cb80-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-562"><a href="#cb80-562" aria-hidden="true" tabindex="-1"></a><span class="co"># sending to gpt3</span></span>
<span id="cb80-563"><a href="#cb80-563" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: ALWAYS DOUBLE CHECK TO NOT SEND TOO MUCH DATA!</span></span>
<span id="cb80-564"><a href="#cb80-564" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(prompt_frame)</span>
<span id="cb80-565"><a href="#cb80-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-566"><a href="#cb80-566" aria-hidden="true" tabindex="-1"></a><span class="co"># token amount</span></span>
<span id="cb80-567"><a href="#cb80-567" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(prompt_frame<span class="sc">$</span>prompt_content_var,<span class="st">" "</span>)))</span>
<span id="cb80-568"><a href="#cb80-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-569"><a href="#cb80-569" aria-hidden="true" tabindex="-1"></a><span class="co"># pricing</span></span>
<span id="cb80-570"><a href="#cb80-570" aria-hidden="true" tabindex="-1"></a><span class="co"># https://openai.com/pricing</span></span>
<span id="cb80-571"><a href="#cb80-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-572"><a href="#cb80-572" aria-hidden="true" tabindex="-1"></a><span class="co"># GPT3 (4k context):</span></span>
<span id="cb80-573"><a href="#cb80-573" aria-hidden="true" tabindex="-1"></a><span class="co"># in: 0.03$ / 1000 tokens</span></span>
<span id="cb80-574"><a href="#cb80-574" aria-hidden="true" tabindex="-1"></a><span class="co"># out: 0.002$ / 1000 tokens</span></span>
<span id="cb80-575"><a href="#cb80-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-576"><a href="#cb80-576" aria-hidden="true" tabindex="-1"></a><span class="co"># input tokens</span></span>
<span id="cb80-577"><a href="#cb80-577" aria-hidden="true" tabindex="-1"></a>input_tokens <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(prompt_frame<span class="sc">$</span>prompt_content_var,<span class="st">" "</span>)))</span>
<span id="cb80-578"><a href="#cb80-578" aria-hidden="true" tabindex="-1"></a><span class="co"># input costs</span></span>
<span id="cb80-579"><a href="#cb80-579" aria-hidden="true" tabindex="-1"></a>input_costs <span class="ot">&lt;-</span> (input_tokens <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">*</span> <span class="fl">0.03</span>;input_costs <span class="co"># = price in dollar </span></span>
<span id="cb80-580"><a href="#cb80-580" aria-hidden="true" tabindex="-1"></a><span class="co"># output costs (max)</span></span>
<span id="cb80-581"><a href="#cb80-581" aria-hidden="true" tabindex="-1"></a>output_costs <span class="ot">&lt;-</span> ((<span class="dv">50</span> <span class="sc">*</span> <span class="fu">length</span>(prompt_frame<span class="sc">$</span>prompt_content_var)) <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">*</span> <span class="fl">0.06</span>;output_costs</span>
<span id="cb80-582"><a href="#cb80-582" aria-hidden="true" tabindex="-1"></a><span class="co"># Total costs (in DOLLARS)</span></span>
<span id="cb80-583"><a href="#cb80-583" aria-hidden="true" tabindex="-1"></a>total_costs <span class="ot">&lt;-</span> input_costs <span class="sc">+</span> output_costs;total_costs</span>
<span id="cb80-584"><a href="#cb80-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-585"><a href="#cb80-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-586"><a href="#cb80-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-587"><a href="#cb80-587" aria-hidden="true" tabindex="-1"></a><span class="do">### We do this with traCatch to not break everything when sth goes wrong </span><span class="al">###</span></span>
<span id="cb80-588"><a href="#cb80-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-589"><a href="#cb80-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-590"><a href="#cb80-590" aria-hidden="true" tabindex="-1"></a><span class="co"># sending the model off to compute</span></span>
<span id="cb80-591"><a href="#cb80-591" aria-hidden="true" tabindex="-1"></a>gpt_age_gender <span class="ot">&lt;-</span> <span class="fu">chatgpt</span>(<span class="at">prompt_role_var =</span> prompt_frame<span class="sc">$</span>prompt_role_var,</span>
<span id="cb80-592"><a href="#cb80-592" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prompt_content_var =</span> prompt_frame<span class="sc">$</span>prompt_content_var,</span>
<span id="cb80-593"><a href="#cb80-593" aria-hidden="true" tabindex="-1"></a>                          <span class="at">id_var =</span> prompt_frame<span class="sc">$</span>id_var,</span>
<span id="cb80-594"><a href="#cb80-594" aria-hidden="true" tabindex="-1"></a>                          <span class="at">param_max_tokens =</span> <span class="dv">50</span>,</span>
<span id="cb80-595"><a href="#cb80-595" aria-hidden="true" tabindex="-1"></a>                          <span class="at">param_temperature =</span> <span class="dv">0</span>,</span>
<span id="cb80-596"><a href="#cb80-596" aria-hidden="true" tabindex="-1"></a>                          <span class="at">param_n =</span> <span class="dv">1</span>,</span>
<span id="cb80-597"><a href="#cb80-597" aria-hidden="true" tabindex="-1"></a>                          <span class="at">param_model =</span> <span class="st">"gpt-3.5-turbo"</span>)</span>
<span id="cb80-598"><a href="#cb80-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-599"><a href="#cb80-599" aria-hidden="true" tabindex="-1"></a><span class="co"># saving results</span></span>
<span id="cb80-600"><a href="#cb80-600" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(gpt_age_gender,<span class="at">file =</span> <span class="st">"GPT3_Age_Gender_annotations.rds"</span>,<span class="at">ver=</span><span class="dv">2</span>)</span>
<span id="cb80-601"><a href="#cb80-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-602"><a href="#cb80-602" aria-hidden="true" tabindex="-1"></a><span class="co"># checking results</span></span>
<span id="cb80-603"><a href="#cb80-603" aria-hidden="true" tabindex="-1"></a>gpt_age_gender[[<span class="dv">1</span>]]<span class="sc">$</span>chatgpt_content</span>
<span id="cb80-604"><a href="#cb80-604" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-605"><a href="#cb80-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-606"><a href="#cb80-606" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Wrangling: Formatting and Subsetting</span></span>
<span id="cb80-607"><a href="#cb80-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-608"><a href="#cb80-608" aria-hidden="true" tabindex="-1"></a>To further clean our data, we first make sure that all our variables come in the right format. Second, we further clean the data by removing (a) missing texts in the posts (because, of course, we cannot use these posts to examine its text, if there is none) and (b) posts from minors or posts where the writer indicated an unrealistic age (above 100). Lastly, we save our cleaned data set.</span>
<span id="cb80-609"><a href="#cb80-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-610"><a href="#cb80-610" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data-wrangling1, include=FALSE}</span></span>
<span id="cb80-611"><a href="#cb80-611" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb80-612"><a href="#cb80-612" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(anytime)</span>
<span id="cb80-613"><a href="#cb80-613" aria-hidden="true" tabindex="-1"></a><span class="do">#### (1) Formatting ####</span></span>
<span id="cb80-614"><a href="#cb80-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-615"><a href="#cb80-615" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate alternative to gender variable we already have:</span></span>
<span id="cb80-616"><a href="#cb80-616" aria-hidden="true" tabindex="-1"></a><span class="co"># Gender as binary with one "Other" category:</span></span>
<span id="cb80-617"><a href="#cb80-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-618"><a href="#cb80-618" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode the 'author_gender' variable</span></span>
<span id="cb80-619"><a href="#cb80-619" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>author_gender_binary <span class="ot">&lt;-</span> <span class="fu">recode</span>(data<span class="sc">$</span>author_gender,</span>
<span id="cb80-620"><a href="#cb80-620" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"f"</span> <span class="ot">=</span> <span class="st">"f"</span>,</span>
<span id="cb80-621"><a href="#cb80-621" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"m"</span> <span class="ot">=</span> <span class="st">"m"</span>,</span>
<span id="cb80-622"><a href="#cb80-622" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Missing"</span>  <span class="ot">=</span> <span class="st">"Missing"</span>,</span>
<span id="cb80-623"><a href="#cb80-623" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">.default =</span> <span class="st">"other"</span>)</span>
<span id="cb80-624"><a href="#cb80-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-625"><a href="#cb80-625" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the levels of 'author_gender_binary'</span></span>
<span id="cb80-626"><a href="#cb80-626" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>author_gender_binary <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>author_gender_binary, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"m"</span>, <span class="st">"other"</span>, <span class="st">"Missing"</span>))</span>
<span id="cb80-627"><a href="#cb80-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-628"><a href="#cb80-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-629"><a href="#cb80-629" aria-hidden="true" tabindex="-1"></a><span class="co"># setting deleted authors to NA</span></span>
<span id="cb80-630"><a href="#cb80-630" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>author[data<span class="sc">$</span>author <span class="sc">==</span> <span class="st">"[deleted]"</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb80-631"><a href="#cb80-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-632"><a href="#cb80-632" aria-hidden="true" tabindex="-1"></a><span class="co"># lets also ensure that every variable is formatted correctly</span></span>
<span id="cb80-633"><a href="#cb80-633" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>created_utc <span class="ot">&lt;-</span> <span class="fu">anytime</span>(data<span class="sc">$</span>created_utc)</span>
<span id="cb80-634"><a href="#cb80-634" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>subreddit <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>subreddit)</span>
<span id="cb80-635"><a href="#cb80-635" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>author <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data<span class="sc">$</span>author, iconv,</span>
<span id="cb80-636"><a href="#cb80-636" aria-hidden="true" tabindex="-1"></a>                      <span class="at">from =</span> <span class="st">"ASCII"</span>, <span class="at">to =</span> <span class="st">"utf8"</span>)</span>
<span id="cb80-637"><a href="#cb80-637" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>title <span class="ot">&lt;-</span> <span class="fu">as.character</span>(data<span class="sc">$</span>title)  </span>
<span id="cb80-638"><a href="#cb80-638" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>num_comments <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>num_comments)</span>
<span id="cb80-639"><a href="#cb80-639" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>score <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>score)</span>
<span id="cb80-640"><a href="#cb80-640" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>selftext <span class="ot">&lt;-</span> <span class="fu">as.character</span>(data<span class="sc">$</span>selftext) </span>
<span id="cb80-641"><a href="#cb80-641" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>url <span class="ot">&lt;-</span> <span class="fu">as.character</span>(data<span class="sc">$</span>url)</span>
<span id="cb80-642"><a href="#cb80-642" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>author_age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>author_age)</span>
<span id="cb80-643"><a href="#cb80-643" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>author_gender <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>author_gender)</span>
<span id="cb80-644"><a href="#cb80-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-645"><a href="#cb80-645" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting rows with a negative number of comments (we don't know why the API returns these values) to zero</span></span>
<span id="cb80-646"><a href="#cb80-646" aria-hidden="true" tabindex="-1"></a><span class="co">#data[data$num_comments &lt; 0,]$num_comments &lt;- 0</span></span>
<span id="cb80-647"><a href="#cb80-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-648"><a href="#cb80-648" aria-hidden="true" tabindex="-1"></a><span class="co"># We give an explicit value "Missing" to NAs in author_gender so they appear in plots etc.</span></span>
<span id="cb80-649"><a href="#cb80-649" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>author_gender <span class="ot">&lt;-</span> forcats<span class="sc">::</span><span class="fu">fct_na_value_to_level</span>(data<span class="sc">$</span>author_gender, <span class="at">level =</span> <span class="st">"Missing"</span>)</span>
<span id="cb80-650"><a href="#cb80-650" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>author_gender)</span>
<span id="cb80-651"><a href="#cb80-651" aria-hidden="true" tabindex="-1"></a><span class="co"># We give an explicit missing value to NAs in author_age_group so they appear in plots etc.</span></span>
<span id="cb80-652"><a href="#cb80-652" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>author_age_group <span class="ot">&lt;-</span> forcats<span class="sc">::</span><span class="fu">fct_na_value_to_level</span>(data<span class="sc">$</span>author_age_group, <span class="at">level =</span> <span class="st">"Missing"</span>)</span>
<span id="cb80-653"><a href="#cb80-653" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>author_age_group)</span>
<span id="cb80-654"><a href="#cb80-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-655"><a href="#cb80-655" aria-hidden="true" tabindex="-1"></a><span class="co"># checking</span></span>
<span id="cb80-656"><a href="#cb80-656" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(data,class)</span>
<span id="cb80-657"><a href="#cb80-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-658"><a href="#cb80-658" aria-hidden="true" tabindex="-1"></a><span class="co"># ordering based on timestamp</span></span>
<span id="cb80-659"><a href="#cb80-659" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[<span class="fu">order</span>(data<span class="sc">$</span>created_utc),]</span>
<span id="cb80-660"><a href="#cb80-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-661"><a href="#cb80-661" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual inspection</span></span>
<span id="cb80-662"><a href="#cb80-662" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span>
<span id="cb80-663"><a href="#cb80-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-664"><a href="#cb80-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-665"><a href="#cb80-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data-wrangling2, include = FALSE}</span></span>
<span id="cb80-666"><a href="#cb80-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-667"><a href="#cb80-667" aria-hidden="true" tabindex="-1"></a><span class="do">#### (2) Subsetting ####</span></span>
<span id="cb80-668"><a href="#cb80-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-669"><a href="#cb80-669" aria-hidden="true" tabindex="-1"></a><span class="co"># (a)</span></span>
<span id="cb80-670"><a href="#cb80-670" aria-hidden="true" tabindex="-1"></a><span class="co"># excluding rows based on text: we want to exclude posts where the post text was removed</span></span>
<span id="cb80-671"><a href="#cb80-671" aria-hidden="true" tabindex="-1"></a><span class="co"># or deleted by a moderator or the author. We'll also remove posts where the text is less than</span></span>
<span id="cb80-672"><a href="#cb80-672" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 characters</span></span>
<span id="cb80-673"><a href="#cb80-673" aria-hidden="true" tabindex="-1"></a>deletedposts <span class="ot">&lt;-</span> data[data<span class="sc">$</span>selftext <span class="sc">==</span> <span class="st">"[removed]"</span> <span class="sc">|</span> data<span class="sc">$</span>selftext <span class="sc">==</span> <span class="st">"[deleted]"</span> <span class="sc">|</span> <span class="fu">nchar</span>(data<span class="sc">$</span>selftext) <span class="sc">&lt;</span> <span class="dv">5</span>,]</span>
<span id="cb80-674"><a href="#cb80-674" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(deletedposts)</span>
<span id="cb80-675"><a href="#cb80-675" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data[data<span class="sc">$</span>selftext <span class="sc">==</span> <span class="st">"[removed]"</span> <span class="sc">|</span> data<span class="sc">$</span>selftext <span class="sc">==</span> <span class="st">"[deleted]"</span> <span class="sc">|</span> <span class="fu">nchar</span>(data<span class="sc">$</span>selftext) <span class="sc">&lt;</span> <span class="dv">5</span>,])</span>
<span id="cb80-676"><a href="#cb80-676" aria-hidden="true" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="fu">which</span>(data<span class="sc">$</span>selftext <span class="sc">==</span> <span class="st">"[removed]"</span> <span class="sc">|</span> data<span class="sc">$</span>selftext <span class="sc">==</span> <span class="st">"[deleted]"</span> <span class="sc">|</span> <span class="fu">nchar</span>(data<span class="sc">$</span>selftext) <span class="sc">&lt;</span> <span class="dv">5</span>,)</span>
<span id="cb80-677"><a href="#cb80-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-678"><a href="#cb80-678" aria-hidden="true" tabindex="-1"></a><span class="co"># (b)</span></span>
<span id="cb80-679"><a href="#cb80-679" aria-hidden="true" tabindex="-1"></a><span class="co"># excluding posts based on indicated age: We will also remove all posts by authors who indicated an</span></span>
<span id="cb80-680"><a href="#cb80-680" aria-hidden="true" tabindex="-1"></a><span class="co"># age above 100 or below 10. these are partially trolls but also typos and or legit posts where our</span></span>
<span id="cb80-681"><a href="#cb80-681" aria-hidden="true" tabindex="-1"></a><span class="co"># regex broke down</span></span>
<span id="cb80-682"><a href="#cb80-682" aria-hidden="true" tabindex="-1"></a>improbableage <span class="ot">&lt;-</span> data[data<span class="sc">$</span>author_age <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age) <span class="sc">|</span> data<span class="sc">$</span>author_age <span class="sc">&gt;</span> <span class="dv">100</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age),]</span>
<span id="cb80-683"><a href="#cb80-683" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(improbableage)</span>
<span id="cb80-684"><a href="#cb80-684" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data[data<span class="sc">$</span>author_age <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age) <span class="sc">|</span> data<span class="sc">$</span>author_age <span class="sc">&gt;</span> <span class="dv">100</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age),])</span>
<span id="cb80-685"><a href="#cb80-685" aria-hidden="true" tabindex="-1"></a>ex_age <span class="ot">&lt;-</span> <span class="fu">which</span>(data<span class="sc">$</span>author_age <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age) <span class="sc">|</span> data<span class="sc">$</span>author_age <span class="sc">&gt;</span> <span class="dv">100</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age))</span>
<span id="cb80-686"><a href="#cb80-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-687"><a href="#cb80-687" aria-hidden="true" tabindex="-1"></a><span class="co"># We create a vector to base the subsetting on, we specify the reason for exclusion as well</span></span>
<span id="cb80-688"><a href="#cb80-688" aria-hidden="true" tabindex="-1"></a>exclusion <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>,<span class="fu">dim</span>(data)[<span class="dv">1</span>])</span>
<span id="cb80-689"><a href="#cb80-689" aria-hidden="true" tabindex="-1"></a>exclusion[ex_age] <span class="ot">&lt;-</span> <span class="st">"ex_age"</span></span>
<span id="cb80-690"><a href="#cb80-690" aria-hidden="true" tabindex="-1"></a>exclusion[ex_text] <span class="ot">&lt;-</span> <span class="st">"ex_text"</span></span>
<span id="cb80-691"><a href="#cb80-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-692"><a href="#cb80-692" aria-hidden="true" tabindex="-1"></a><span class="co"># checking how much we exlcude for which reasons</span></span>
<span id="cb80-693"><a href="#cb80-693" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(exclusion)</span>
<span id="cb80-694"><a href="#cb80-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-695"><a href="#cb80-695" aria-hidden="true" tabindex="-1"></a><span class="co"># splitting of the exluded data</span></span>
<span id="cb80-696"><a href="#cb80-696" aria-hidden="true" tabindex="-1"></a>data_ex <span class="ot">&lt;-</span> data[exclusion <span class="sc">!=</span> <span class="cn">FALSE</span>,]</span>
<span id="cb80-697"><a href="#cb80-697" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_ex)</span>
<span id="cb80-698"><a href="#cb80-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-699"><a href="#cb80-699" aria-hidden="true" tabindex="-1"></a><span class="co"># excluding data from usable dataframe</span></span>
<span id="cb80-700"><a href="#cb80-700" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[exclusion <span class="sc">==</span> <span class="cn">FALSE</span>,]</span>
<span id="cb80-701"><a href="#cb80-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-702"><a href="#cb80-702" aria-hidden="true" tabindex="-1"></a><span class="co">#test</span></span>
<span id="cb80-703"><a href="#cb80-703" aria-hidden="true" tabindex="-1"></a>deletedposts <span class="ot">&lt;-</span> data[data<span class="sc">$</span>selftext <span class="sc">==</span> <span class="st">"[removed]"</span> <span class="sc">|</span> data<span class="sc">$</span>selftext <span class="sc">==</span> <span class="st">"[deleted]"</span> <span class="sc">|</span> <span class="fu">nchar</span>(data<span class="sc">$</span>selftext) <span class="sc">&lt;</span> <span class="dv">5</span>,]</span>
<span id="cb80-704"><a href="#cb80-704" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(deletedposts)</span>
<span id="cb80-705"><a href="#cb80-705" aria-hidden="true" tabindex="-1"></a>improbableage <span class="ot">&lt;-</span> data[data<span class="sc">$</span>author_age <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age) <span class="sc">|</span> data<span class="sc">$</span>author_age <span class="sc">&gt;</span> <span class="dv">100</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age),]</span>
<span id="cb80-706"><a href="#cb80-706" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(improbableage)</span>
<span id="cb80-707"><a href="#cb80-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-708"><a href="#cb80-708" aria-hidden="true" tabindex="-1"></a><span class="co"># Saving cleaned data set</span></span>
<span id="cb80-709"><a href="#cb80-709" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(data, <span class="at">file =</span> <span class="st">"data/RedditData_Cleaned.Rdata"</span>)</span>
<span id="cb80-710"><a href="#cb80-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-711"><a href="#cb80-711" aria-hidden="true" tabindex="-1"></a><span class="co"># freeing up memory/cleaning the environment</span></span>
<span id="cb80-712"><a href="#cb80-712" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(list = ls())</span></span>
<span id="cb80-713"><a href="#cb80-713" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb80-714"><a href="#cb80-714" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-715"><a href="#cb80-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-716"><a href="#cb80-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-717"><a href="#cb80-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-718"><a href="#cb80-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-719"><a href="#cb80-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-720"><a href="#cb80-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-721"><a href="#cb80-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-722"><a href="#cb80-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-723"><a href="#cb80-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-724"><a href="#cb80-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-725"><a href="#cb80-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-726"><a href="#cb80-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-727"><a href="#cb80-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-728"><a href="#cb80-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-729"><a href="#cb80-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-730"><a href="#cb80-730" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preprocessing Text Data</span></span>
<span id="cb80-731"><a href="#cb80-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-732"><a href="#cb80-732" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pre-processing, eval = FALSE}</span></span>
<span id="cb80-733"><a href="#cb80-733" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb80-734"><a href="#cb80-734" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textmodels)</span>
<span id="cb80-735"><a href="#cb80-735" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb80-736"><a href="#cb80-736" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textstats)</span>
<span id="cb80-737"><a href="#cb80-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-738"><a href="#cb80-738" aria-hidden="true" tabindex="-1"></a><span class="co"># loading data</span></span>
<span id="cb80-739"><a href="#cb80-739" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">'data/RedditData_Cleaned.Rdata'</span>)</span>
<span id="cb80-740"><a href="#cb80-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-741"><a href="#cb80-741" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title to selftext</span></span>
<span id="cb80-742"><a href="#cb80-742" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-743"><a href="#cb80-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">paste</span>(title, selftext))</span>
<span id="cb80-744"><a href="#cb80-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-745"><a href="#cb80-745" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove punctuation</span></span>
<span id="cb80-746"><a href="#cb80-746" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>text <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(data<span class="sc">$</span>text, <span class="st">"(?&lt;=(</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">())(.*?)(?=(</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">)))"</span>, <span class="st">""</span>)</span>
<span id="cb80-747"><a href="#cb80-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-748"><a href="#cb80-748" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate corpus</span></span>
<span id="cb80-749"><a href="#cb80-749" aria-hidden="true" tabindex="-1"></a>reddit_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(data,</span>
<span id="cb80-750"><a href="#cb80-750" aria-hidden="true" tabindex="-1"></a>                        <span class="at">text_field =</span> <span class="st">"text"</span>,</span>
<span id="cb80-751"><a href="#cb80-751" aria-hidden="true" tabindex="-1"></a>                        <span class="at">docid_field =</span> <span class="st">"id"</span>)</span>
<span id="cb80-752"><a href="#cb80-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-753"><a href="#cb80-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-754"><a href="#cb80-754" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(reddit_corpus)<span class="sc">$</span>text <span class="ot">&lt;-</span> data<span class="sc">$</span>text</span>
<span id="cb80-755"><a href="#cb80-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-756"><a href="#cb80-756" aria-hidden="true" tabindex="-1"></a><span class="co"># From corpus to tokens</span></span>
<span id="cb80-757"><a href="#cb80-757" aria-hidden="true" tabindex="-1"></a>reddit_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(reddit_corpus,</span>
<span id="cb80-758"><a href="#cb80-758" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_url =</span> <span class="cn">TRUE</span>, <span class="co"># remove URLs</span></span>
<span id="cb80-759"><a href="#cb80-759" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>, <span class="co"># remove numbers</span></span>
<span id="cb80-760"><a href="#cb80-760" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, <span class="co"># remove punctuation</span></span>
<span id="cb80-761"><a href="#cb80-761" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_separators =</span> <span class="cn">TRUE</span>,</span>
<span id="cb80-762"><a href="#cb80-762" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># remove empty spaces/line breaks</span></span>
<span id="cb80-763"><a href="#cb80-763" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-764"><a href="#cb80-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-765"><a href="#cb80-765" aria-hidden="true" tabindex="-1"></a><span class="co"># Further pre-processing of tokens:</span></span>
<span id="cb80-766"><a href="#cb80-766" aria-hidden="true" tabindex="-1"></a>own_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"i’m"</span>, <span class="st">"it’s"</span>, <span class="st">"i’ve"</span>,</span>
<span id="cb80-767"><a href="#cb80-767" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"he’s"</span>, <span class="st">"she’s"</span>,</span>
<span id="cb80-768"><a href="#cb80-768" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"doesn’t"</span>, <span class="st">"don’t"</span>, <span class="st">"didn’t"</span>,</span>
<span id="cb80-769"><a href="#cb80-769" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"they’ve"</span>, <span class="st">"they’re"</span>, <span class="st">"tl"</span>,</span>
<span id="cb80-770"><a href="#cb80-770" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"dr"</span>, <span class="st">"tldr"</span>, <span class="st">"ldr"</span>, <span class="st">"tld"</span>,</span>
<span id="cb80-771"><a href="#cb80-771" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"can’t"</span>, <span class="st">"cant"</span>, <span class="st">"can"</span>,</span>
<span id="cb80-772"><a href="#cb80-772" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"cannot"</span>, <span class="st">"wont"</span>, <span class="st">"im"</span>,</span>
<span id="cb80-773"><a href="#cb80-773" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"its"</span>, <span class="st">"hes"</span>, <span class="st">"shes"</span>, <span class="st">"theyve"</span>,</span>
<span id="cb80-774"><a href="#cb80-774" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"theyre"</span>, <span class="st">"hed"</span>, <span class="st">"shed"</span>, <span class="st">"_+"</span>,</span>
<span id="cb80-775"><a href="#cb80-775" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"arent"</span>, <span class="st">"post"</span>,</span>
<span id="cb80-776"><a href="#cb80-776" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"crosspost"</span>, <span class="st">"update"</span>, <span class="st">"edit"</span>,</span>
<span id="cb80-777"><a href="#cb80-777" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"hi"</span>, <span class="st">"hello"</span>, <span class="st">"everyone"</span>,</span>
<span id="cb80-778"><a href="#cb80-778" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"we’ve"</span>, <span class="st">"he’d"</span>, <span class="st">"#x200b"</span>,</span>
<span id="cb80-779"><a href="#cb80-779" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"aren’t"</span>, <span class="st">"he’ll"</span>, <span class="st">"i’d"</span>,</span>
<span id="cb80-780"><a href="#cb80-780" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"really"</span>, <span class="st">"ive"</span>, <span class="st">"dont"</span>,</span>
<span id="cb80-781"><a href="#cb80-781" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"doesnt"</span>, <span class="st">"didnt"</span>)</span>
<span id="cb80-782"><a href="#cb80-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-783"><a href="#cb80-783" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply among other:</span></span>
<span id="cb80-784"><a href="#cb80-784" aria-hidden="true" tabindex="-1"></a>reddit_tokens <span class="ot">&lt;-</span> reddit_tokens <span class="sc">%&gt;%</span> </span>
<span id="cb80-785"><a href="#cb80-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb80-786"><a href="#cb80-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">'english'</span>), </span>
<span id="cb80-787"><a href="#cb80-787" aria-hidden="true" tabindex="-1"></a>                <span class="at">padding =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb80-788"><a href="#cb80-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(own_stopwords)</span>
<span id="cb80-789"><a href="#cb80-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-790"><a href="#cb80-790" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect results:</span></span>
<span id="cb80-791"><a href="#cb80-791" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(reddit_tokens[[<span class="dv">1</span>]])</span>
<span id="cb80-792"><a href="#cb80-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-793"><a href="#cb80-793" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect collocations</span></span>
<span id="cb80-794"><a href="#cb80-794" aria-hidden="true" tabindex="-1"></a>colls <span class="ot">&lt;-</span> <span class="fu">textstat_collocations</span>(reddit_tokens,</span>
<span id="cb80-795"><a href="#cb80-795" aria-hidden="true" tabindex="-1"></a>                               <span class="at">min_count =</span> <span class="dv">400</span>)</span>
<span id="cb80-796"><a href="#cb80-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-797"><a href="#cb80-797" aria-hidden="true" tabindex="-1"></a><span class="co"># look at terms</span></span>
<span id="cb80-798"><a href="#cb80-798" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(colls[<span class="fu">order</span>(<span class="fu">desc</span>(colls<span class="sc">$</span>lambda)),])</span>
<span id="cb80-799"><a href="#cb80-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-800"><a href="#cb80-800" aria-hidden="true" tabindex="-1"></a><span class="co"># only consider collocations with a minimum lambda of 4</span></span>
<span id="cb80-801"><a href="#cb80-801" aria-hidden="true" tabindex="-1"></a>colls <span class="ot">&lt;-</span> colls[colls<span class="sc">$</span>lambda <span class="sc">&gt;=</span> <span class="dv">4</span>, ]</span>
<span id="cb80-802"><a href="#cb80-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-803"><a href="#cb80-803" aria-hidden="true" tabindex="-1"></a><span class="co"># Some last refinements after further inspection of the collocations:</span></span>
<span id="cb80-804"><a href="#cb80-804" aria-hidden="true" tabindex="-1"></a>reddit_tokens_c <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(reddit_tokens, colls) <span class="sc">%&gt;%</span></span>
<span id="cb80-805"><a href="#cb80-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="st">''</span>) <span class="co"># remove empty strings</span></span>
<span id="cb80-806"><a href="#cb80-806" aria-hidden="true" tabindex="-1"></a>reddit_tokens_c <span class="ot">&lt;-</span> reddit_tokens_c <span class="sc">%&gt;%</span></span>
<span id="cb80-807"><a href="#cb80-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="fu">c</span>(<span class="st">"title_says"</span>, <span class="st">"long_story"</span>, <span class="st">"story_short"</span>))</span>
<span id="cb80-808"><a href="#cb80-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-809"><a href="#cb80-809" aria-hidden="true" tabindex="-1"></a><span class="co"># From tokens to dfm</span></span>
<span id="cb80-810"><a href="#cb80-810" aria-hidden="true" tabindex="-1"></a>reddit_dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(reddit_tokens_c)</span>
<span id="cb80-811"><a href="#cb80-811" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(reddit_dfm)</span>
<span id="cb80-812"><a href="#cb80-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-813"><a href="#cb80-813" aria-hidden="true" tabindex="-1"></a><span class="co"># Only keep terms that appear in at least 10 documents &amp; are at least 2</span></span>
<span id="cb80-814"><a href="#cb80-814" aria-hidden="true" tabindex="-1"></a><span class="co"># characters long</span></span>
<span id="cb80-815"><a href="#cb80-815" aria-hidden="true" tabindex="-1"></a>reddit_dfm <span class="ot">&lt;-</span> reddit_dfm <span class="sc">%&gt;%</span></span>
<span id="cb80-816"><a href="#cb80-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_trim</span>(<span class="at">min_docfreq =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-817"><a href="#cb80-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_keep</span>(<span class="at">min_nchar =</span> <span class="dv">2</span>)</span>
<span id="cb80-818"><a href="#cb80-818" aria-hidden="true" tabindex="-1"></a><span class="co">#View(reddit_dfm)</span></span>
<span id="cb80-819"><a href="#cb80-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-820"><a href="#cb80-820" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dfm</span></span>
<span id="cb80-821"><a href="#cb80-821" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(reddit_dfm, "reddit_dfm.rds")</span></span>
<span id="cb80-822"><a href="#cb80-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-823"><a href="#cb80-823" aria-hidden="true" tabindex="-1"></a><span class="do">## Create STM object</span></span>
<span id="cb80-824"><a href="#cb80-824" aria-hidden="true" tabindex="-1"></a>reddit_stm <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">convert</span>(reddit_dfm, <span class="at">to =</span> <span class="st">'stm'</span>)</span>
<span id="cb80-825"><a href="#cb80-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-826"><a href="#cb80-826" aria-hidden="true" tabindex="-1"></a><span class="co"># Save stm object</span></span>
<span id="cb80-827"><a href="#cb80-827" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(reddit_stm, "reddit_stm.rds")</span></span>
<span id="cb80-828"><a href="#cb80-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-829"><a href="#cb80-829" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-830"><a href="#cb80-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-831"><a href="#cb80-831" aria-hidden="true" tabindex="-1"></a><span class="fu"># Analysis</span></span>
<span id="cb80-832"><a href="#cb80-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-833"><a href="#cb80-833" aria-hidden="true" tabindex="-1"></a><span class="fu">## Descriptive Statistics</span></span>
<span id="cb80-834"><a href="#cb80-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-835"><a href="#cb80-835" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Distribution of Author Age Groups</span></span>
<span id="cb80-836"><a href="#cb80-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-837"><a href="#cb80-837" aria-hidden="true" tabindex="-1"></a>We now examine the distribution of various variables in our data set by age group. First, we look at how old the writers of our Reddit posts are overall.</span>
<span id="cb80-838"><a href="#cb80-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-839"><a href="#cb80-839" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures1, echo = TRUE, warning=FALSE}</span></span>
<span id="cb80-840"><a href="#cb80-840" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-841"><a href="#cb80-841" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(ggplot2))</span>
<span id="cb80-842"><a href="#cb80-842" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(miceadds))</span>
<span id="cb80-843"><a href="#cb80-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-844"><a href="#cb80-844" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the relevant data:</span></span>
<span id="cb80-845"><a href="#cb80-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-846"><a href="#cb80-846" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">load.Rdata2</span>(<span class="st">"data/RedditData_Cleaned.Rdata"</span>,</span>
<span id="cb80-847"><a href="#cb80-847" aria-hidden="true" tabindex="-1"></a>                    <span class="at">path =</span> <span class="fu">getwd</span>(), <span class="at">RDS =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-848"><a href="#cb80-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-849"><a href="#cb80-849" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of age groups</span></span>
<span id="cb80-850"><a href="#cb80-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-851"><a href="#cb80-851" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> author_age_group, <span class="at">fill =</span> author_age_group)) <span class="sc">+</span> </span>
<span id="cb80-852"><a href="#cb80-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb80-853"><a href="#cb80-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Post Author Age Group"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of "</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">" posts, "</span>, <span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>]), <span class="st">" had an age indication "</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">"%)"</span>,<span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb80-854"><a href="#cb80-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age group"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb80-855"><a href="#cb80-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb80-856"><a href="#cb80-856" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,<span class="st">"21-30"</span>,<span class="st">"31-40"</span>,<span class="st">"41-50"</span>,<span class="st">"&gt;50"</span>,</span>
<span id="cb80-857"><a href="#cb80-857" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Missing"</span>),</span>
<span id="cb80-858"><a href="#cb80-858" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>,<span class="st">"#DAF7A6"</span>,<span class="st">"#FFC300"</span>,<span class="st">"#FF5733"</span>,</span>
<span id="cb80-859"><a href="#cb80-859" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#C70039"</span>,<span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-860"><a href="#cb80-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-861"><a href="#cb80-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-862"><a href="#cb80-862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-863"><a href="#cb80-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-864"><a href="#cb80-864" aria-hidden="true" tabindex="-1"></a>Now, we look at the distribution of author age groups across subreddits</span>
<span id="cb80-865"><a href="#cb80-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-866"><a href="#cb80-866" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures2, include = FALSE}</span></span>
<span id="cb80-867"><a href="#cb80-867" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">table</span>(data<span class="sc">$</span>author_age_group,data<span class="sc">$</span>subreddit);tab2</span>
<span id="cb80-868"><a href="#cb80-868" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(tab2)</span>
<span id="cb80-869"><a href="#cb80-869" aria-hidden="true" tabindex="-1"></a>tab_data2 <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="fu">unlist</span>(tab2))</span>
<span id="cb80-870"><a href="#cb80-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-871"><a href="#cb80-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-872"><a href="#cb80-872" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures3, echo=TRUE}</span></span>
<span id="cb80-873"><a href="#cb80-873" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-874"><a href="#cb80-874" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting age_group by subreddit (dodged)</span></span>
<span id="cb80-875"><a href="#cb80-875" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-876"><a href="#cb80-876" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tab_data2, <span class="fu">aes</span>(<span class="at">fill =</span> Var1, <span class="at">y =</span> Freq, <span class="at">x =</span> Var2)) <span class="sc">+</span> </span>
<span id="cb80-877"><a href="#cb80-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-878"><a href="#cb80-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Post Author Age Group by Subreddit"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of "</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">" posts, "</span>, <span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>]), <span class="st">" had an age indication "</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">"%)"</span>,<span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb80-879"><a href="#cb80-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Subreddit"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb80-880"><a href="#cb80-880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb80-881"><a href="#cb80-881" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,<span class="st">"21-30"</span>,<span class="st">"31-40"</span>,<span class="st">"41-50"</span>,<span class="st">"&gt;50"</span>,</span>
<span id="cb80-882"><a href="#cb80-882" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Missing"</span>),</span>
<span id="cb80-883"><a href="#cb80-883" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>,<span class="st">"#DAF7A6"</span>,<span class="st">"#FFC300"</span>,<span class="st">"#FF5733"</span>,</span>
<span id="cb80-884"><a href="#cb80-884" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#C70039"</span>,<span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-885"><a href="#cb80-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-886"><a href="#cb80-886" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-887"><a href="#cb80-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-888"><a href="#cb80-888" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures4, include= FALSE}</span></span>
<span id="cb80-889"><a href="#cb80-889" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean the environment:</span></span>
<span id="cb80-890"><a href="#cb80-890" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(tab2, tab_data2)</span>
<span id="cb80-891"><a href="#cb80-891" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-892"><a href="#cb80-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-893"><a href="#cb80-893" aria-hidden="true" tabindex="-1"></a>Age groups over time:</span>
<span id="cb80-894"><a href="#cb80-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-895"><a href="#cb80-895" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures5, include = FALSE}</span></span>
<span id="cb80-896"><a href="#cb80-896" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate separate variables for year, month, day, &amp; hours</span></span>
<span id="cb80-897"><a href="#cb80-897" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">format</span>(data<span class="sc">$</span>created_utc,<span class="st">"%Y"</span>)</span>
<span id="cb80-898"><a href="#cb80-898" aria-hidden="true" tabindex="-1"></a>months <span class="ot">&lt;-</span> <span class="fu">format</span>(data<span class="sc">$</span>created_utc,<span class="st">"%m"</span>)</span>
<span id="cb80-899"><a href="#cb80-899" aria-hidden="true" tabindex="-1"></a>days <span class="ot">&lt;-</span> <span class="fu">format</span>(data<span class="sc">$</span>created_utc,<span class="st">"%d"</span>)</span>
<span id="cb80-900"><a href="#cb80-900" aria-hidden="true" tabindex="-1"></a>weekdays <span class="ot">&lt;-</span> <span class="fu">format</span>(data<span class="sc">$</span>created_utc,<span class="st">"%w"</span>)</span>
<span id="cb80-901"><a href="#cb80-901" aria-hidden="true" tabindex="-1"></a>hours <span class="ot">&lt;-</span> <span class="fu">format</span>(data<span class="sc">$</span>created_utc,<span class="st">"%H"</span>)</span>
<span id="cb80-902"><a href="#cb80-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-903"><a href="#cb80-903" aria-hidden="true" tabindex="-1"></a><span class="co"># We attach this to the existing dataframe</span></span>
<span id="cb80-904"><a href="#cb80-904" aria-hidden="true" tabindex="-1"></a>data_time <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(years,months,days,weekdays,hours,data,<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-905"><a href="#cb80-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-906"><a href="#cb80-906" aria-hidden="true" tabindex="-1"></a><span class="co"># creating new dataframes bases on different time levels</span></span>
<span id="cb80-907"><a href="#cb80-907" aria-hidden="true" tabindex="-1"></a>data_aggregated_years_age <span class="ot">&lt;-</span> data_time <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(years,subreddit,author_age_group) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-908"><a href="#cb80-908" aria-hidden="true" tabindex="-1"></a>data_aggregated_months_age <span class="ot">&lt;-</span> data_time <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(months,subreddit,author_age_group) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-909"><a href="#cb80-909" aria-hidden="true" tabindex="-1"></a>data_aggregated_days_age <span class="ot">&lt;-</span> data_time <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(days,subreddit,author_age_group) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-910"><a href="#cb80-910" aria-hidden="true" tabindex="-1"></a>data_aggregated_weekdays_age <span class="ot">&lt;-</span> data_time <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(weekdays,subreddit,author_age_group) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-911"><a href="#cb80-911" aria-hidden="true" tabindex="-1"></a>data_aggregated_hours_age <span class="ot">&lt;-</span> data_time <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(hours,subreddit,author_age_group) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-912"><a href="#cb80-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-913"><a href="#cb80-913" aria-hidden="true" tabindex="-1"></a><span class="co"># Also generate month-year variable:</span></span>
<span id="cb80-914"><a href="#cb80-914" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode created_utc variable to month-year format</span></span>
<span id="cb80-915"><a href="#cb80-915" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>created_month_year <span class="ot">&lt;-</span> <span class="fu">format</span>(data<span class="sc">$</span>created_utc, <span class="st">"%Y-%m"</span>)</span>
<span id="cb80-916"><a href="#cb80-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-917"><a href="#cb80-917" aria-hidden="true" tabindex="-1"></a>data_aggregated_time <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(created_month_year,author_age_group) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-918"><a href="#cb80-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-919"><a href="#cb80-919" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(years, months, days, weekdays, hours)</span>
<span id="cb80-920"><a href="#cb80-920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-921"><a href="#cb80-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-922"><a href="#cb80-922" aria-hidden="true" tabindex="-1"></a>Over the years:</span>
<span id="cb80-923"><a href="#cb80-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-924"><a href="#cb80-924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures6, echo = TRUE}</span></span>
<span id="cb80-925"><a href="#cb80-925" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-926"><a href="#cb80-926" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizing post author Age groups over years</span></span>
<span id="cb80-927"><a href="#cb80-927" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-928"><a href="#cb80-928" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_years_age, <span class="fu">aes</span>(<span class="at">fill =</span> author_age_group,</span>
<span id="cb80-929"><a href="#cb80-929" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> count, <span class="at">x =</span> years)) <span class="sc">+</span> </span>
<span id="cb80-930"><a href="#cb80-930" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-931"><a href="#cb80-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Post Author Age Group by Subreddit"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of "</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">" posts, "</span>, <span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>]), <span class="st">" had an age indication "</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">"%)"</span>,<span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb80-932"><a href="#cb80-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Amnount of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-933"><a href="#cb80-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb80-934"><a href="#cb80-934" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,<span class="st">"21-30"</span>,<span class="st">"31-40"</span>,<span class="st">"41-50"</span>,<span class="st">"&gt;50"</span>,</span>
<span id="cb80-935"><a href="#cb80-935" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Missing"</span>),</span>
<span id="cb80-936"><a href="#cb80-936" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>,<span class="st">"#DAF7A6"</span>,<span class="st">"#FFC300"</span>,<span class="st">"#FF5733"</span>,</span>
<span id="cb80-937"><a href="#cb80-937" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#C70039"</span>,<span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-938"><a href="#cb80-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-939"><a href="#cb80-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb80-940"><a href="#cb80-940" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(subreddit),</span>
<span id="cb80-941"><a href="#cb80-941" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">subreddit =</span> <span class="fu">c</span>(<span class="st">"relationship_advice"</span> <span class="ot">=</span> <span class="st">"Relationship advice"</span>, <span class="st">"relationships"</span> <span class="ot">=</span> <span class="st">"Relationships"</span>)))</span>
<span id="cb80-942"><a href="#cb80-942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-943"><a href="#cb80-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-944"><a href="#cb80-944" aria-hidden="true" tabindex="-1"></a>Across weekdays:</span>
<span id="cb80-945"><a href="#cb80-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-946"><a href="#cb80-946" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures7, echo = TRUE}</span></span>
<span id="cb80-947"><a href="#cb80-947" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-948"><a href="#cb80-948" aria-hidden="true" tabindex="-1"></a><span class="co"># weekdays</span></span>
<span id="cb80-949"><a href="#cb80-949" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-950"><a href="#cb80-950" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb80-951"><a href="#cb80-951" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_weekdays_age, <span class="fu">aes</span>(<span class="at">fill =</span> author_age_group, <span class="at">y =</span> count, <span class="at">x =</span> weekdays)) <span class="sc">+</span> </span>
<span id="cb80-952"><a href="#cb80-952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-953"><a href="#cb80-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Post Author Age Group by Subreddit"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of "</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">" posts, "</span>, <span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>]), <span class="st">" had an age indication "</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">"%)"</span>,<span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb80-954"><a href="#cb80-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Weekday"</span>, <span class="at">y =</span> <span class="st">"Amnount of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-955"><a href="#cb80-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Age Group"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,<span class="st">"21-30"</span>,<span class="st">"31-40"</span>,<span class="st">"41-50"</span>,<span class="st">"&gt;50"</span>,<span class="st">"Missing"</span>),<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>,<span class="st">"#DAF7A6"</span>,<span class="st">"#FFC300"</span>,<span class="st">"#FF5733"</span>,<span class="st">"#C70039"</span>,<span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-956"><a href="#cb80-956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-957"><a href="#cb80-957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb80-958"><a href="#cb80-958" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(subreddit),</span>
<span id="cb80-959"><a href="#cb80-959" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">subreddit =</span> <span class="fu">c</span>(<span class="st">"relationship_advice"</span> <span class="ot">=</span> <span class="st">"Relationship advice"</span>, <span class="st">"relationships"</span> <span class="ot">=</span> <span class="st">"Relationships"</span>))) <span class="sc">+</span></span>
<span id="cb80-960"><a href="#cb80-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> day.abb[<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)])</span>
<span id="cb80-961"><a href="#cb80-961" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-962"><a href="#cb80-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-963"><a href="#cb80-963" aria-hidden="true" tabindex="-1"></a>Across hours of the day:</span>
<span id="cb80-964"><a href="#cb80-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-965"><a href="#cb80-965" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures8, echo = TRUE}</span></span>
<span id="cb80-966"><a href="#cb80-966" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-967"><a href="#cb80-967" aria-hidden="true" tabindex="-1"></a><span class="co"># hours</span></span>
<span id="cb80-968"><a href="#cb80-968" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-969"><a href="#cb80-969" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_hours_age, <span class="fu">aes</span>(<span class="at">fill =</span> author_age_group,</span>
<span id="cb80-970"><a href="#cb80-970" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> count, <span class="at">x =</span> hours)) <span class="sc">+</span> </span>
<span id="cb80-971"><a href="#cb80-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-972"><a href="#cb80-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Post Author Age Group by Subreddit"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of "</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">" posts, "</span>, <span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>]), <span class="st">" had an age indication "</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">"%)"</span>,<span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb80-973"><a href="#cb80-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Hour of Day"</span>, <span class="at">y =</span> <span class="st">"Amnount of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-974"><a href="#cb80-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb80-975"><a href="#cb80-975" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,<span class="st">"21-30"</span>,<span class="st">"31-40"</span>,<span class="st">"41-50"</span>,<span class="st">"&gt;50"</span>,</span>
<span id="cb80-976"><a href="#cb80-976" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Missing"</span>),</span>
<span id="cb80-977"><a href="#cb80-977" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>,<span class="st">"#DAF7A6"</span>,<span class="st">"#FFC300"</span>,<span class="st">"#FF5733"</span>,</span>
<span id="cb80-978"><a href="#cb80-978" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#C70039"</span>,<span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-979"><a href="#cb80-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-980"><a href="#cb80-980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb80-981"><a href="#cb80-981" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(subreddit),</span>
<span id="cb80-982"><a href="#cb80-982" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">subreddit =</span> <span class="fu">c</span>(<span class="st">"relationship_advice"</span> <span class="ot">=</span> <span class="st">"Relationship advice"</span>, <span class="st">"relationships"</span> <span class="ot">=</span> <span class="st">"Relationships"</span>)))</span>
<span id="cb80-983"><a href="#cb80-983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-984"><a href="#cb80-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-985"><a href="#cb80-985" aria-hidden="true" tabindex="-1"></a>Across whole observation period:</span>
<span id="cb80-986"><a href="#cb80-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-987"><a href="#cb80-987" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures9, echo = TRUE}</span></span>
<span id="cb80-988"><a href="#cb80-988" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-989"><a href="#cb80-989" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-990"><a href="#cb80-990" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_time, <span class="fu">aes</span>(<span class="at">fill =</span> author_age_group,</span>
<span id="cb80-991"><a href="#cb80-991" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> count, <span class="at">x =</span> created_month_year)) <span class="sc">+</span> </span>
<span id="cb80-992"><a href="#cb80-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-993"><a href="#cb80-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Post Author Age Group Over Time"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of "</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">" posts, "</span>, <span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>]), <span class="st">" had an age indication "</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_age_group[data<span class="sc">$</span>author_age_group <span class="sc">!=</span> <span class="st">"Missing"</span>])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">"%)"</span>,<span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb80-994"><a href="#cb80-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year-Month"</span>, <span class="at">y =</span> <span class="st">"Amnount of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-995"><a href="#cb80-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb80-996"><a href="#cb80-996" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,<span class="st">"21-30"</span>,<span class="st">"31-40"</span>,<span class="st">"41-50"</span>,<span class="st">"&gt;50"</span>,</span>
<span id="cb80-997"><a href="#cb80-997" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Missing"</span>),</span>
<span id="cb80-998"><a href="#cb80-998" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>,<span class="st">"#DAF7A6"</span>,<span class="st">"#FFC300"</span>,<span class="st">"#FF5733"</span>,</span>
<span id="cb80-999"><a href="#cb80-999" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#C70039"</span>,<span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-1000"><a href="#cb80-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-1001"><a href="#cb80-1001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">gsub</span>(<span class="st">'-'</span>, <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>, x))</span>
<span id="cb80-1002"><a href="#cb80-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1003"><a href="#cb80-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1004"><a href="#cb80-1004" aria-hidden="true" tabindex="-1"></a>Distribution of upvotes by age group and subreddit</span>
<span id="cb80-1005"><a href="#cb80-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1006"><a href="#cb80-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures10, echo = TRUE}</span></span>
<span id="cb80-1007"><a href="#cb80-1007" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1008"><a href="#cb80-1008" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1009"><a href="#cb80-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">Winsorize</span>(score, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)), <span class="at">fill =</span> author_age_group)) <span class="sc">+</span> </span>
<span id="cb80-1010"><a href="#cb80-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="st">'stack'</span>) <span class="sc">+</span></span>
<span id="cb80-1011"><a href="#cb80-1011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Upvote Score per Subreddit"</span>, <span class="at">subtitle =</span> <span class="st">"Winsorizing was done for top 5%"</span>) <span class="sc">+</span></span>
<span id="cb80-1012"><a href="#cb80-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Winsorized Upvote Scores"</span>, <span class="at">y =</span> <span class="st">"Amount of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1013"><a href="#cb80-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb80-1014"><a href="#cb80-1014" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,<span class="st">"21-30"</span>,<span class="st">"31-40"</span>,<span class="st">"41-50"</span>,<span class="st">"&gt;50"</span>,</span>
<span id="cb80-1015"><a href="#cb80-1015" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Missing"</span>),</span>
<span id="cb80-1016"><a href="#cb80-1016" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>,<span class="st">"#DAF7A6"</span>,<span class="st">"#FFC300"</span>,<span class="st">"#FF5733"</span>,</span>
<span id="cb80-1017"><a href="#cb80-1017" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#C70039"</span>,<span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-1018"><a href="#cb80-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(subreddit)) <span class="sc">+</span></span>
<span id="cb80-1019"><a href="#cb80-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1020"><a href="#cb80-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1021"><a href="#cb80-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1022"><a href="#cb80-1022" aria-hidden="true" tabindex="-1"></a>Distribution of number of comments by age group and subreddit</span>
<span id="cb80-1023"><a href="#cb80-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1024"><a href="#cb80-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-figures11, echo = TRUE}</span></span>
<span id="cb80-1025"><a href="#cb80-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1026"><a href="#cb80-1026" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1027"><a href="#cb80-1027" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">Winsorize</span>(num_comments, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>)), <span class="at">fill =</span> author_age_group)) <span class="sc">+</span> </span>
<span id="cb80-1028"><a href="#cb80-1028" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="st">'stack'</span>) <span class="sc">+</span></span>
<span id="cb80-1029"><a href="#cb80-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Upvote Score per Subreddit"</span>, <span class="at">subtitle =</span> <span class="st">"Winsorizing was done for top 1,72%, representing posts with more than 100 upvotes"</span>) <span class="sc">+</span></span>
<span id="cb80-1030"><a href="#cb80-1030" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Winsorized Upvote Scores"</span>, <span class="at">y =</span> <span class="st">"Amount of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1031"><a href="#cb80-1031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Age Group"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt;21"</span>,<span class="st">"21-30"</span>,<span class="st">"31-40"</span>,<span class="st">"41-50"</span>,<span class="st">"&gt;50"</span>,<span class="st">"Missing"</span>),<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>,<span class="st">"#DAF7A6"</span>,<span class="st">"#FFC300"</span>,<span class="st">"#FF5733"</span>,<span class="st">"#C70039"</span>,<span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-1032"><a href="#cb80-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(subreddit)) <span class="sc">+</span></span>
<span id="cb80-1033"><a href="#cb80-1033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1034"><a href="#cb80-1034" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1035"><a href="#cb80-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1036"><a href="#cb80-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Age as a continuous variable</span></span>
<span id="cb80-1037"><a href="#cb80-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1038"><a href="#cb80-1038" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-cont1}</span></span>
<span id="cb80-1039"><a href="#cb80-1039" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb80-1040"><a href="#cb80-1040" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1041"><a href="#cb80-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1042"><a href="#cb80-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> author_age)) <span class="sc">+</span></span>
<span id="cb80-1043"><a href="#cb80-1043" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb80-1044"><a href="#cb80-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Frequency of posts"</span>, <span class="at">y =</span> <span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb80-1045"><a href="#cb80-1045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1046"><a href="#cb80-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1047"><a href="#cb80-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1048"><a href="#cb80-1048" aria-hidden="true" tabindex="-1"></a>Distribution by subreddit</span>
<span id="cb80-1049"><a href="#cb80-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1050"><a href="#cb80-1050" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-cont2}</span></span>
<span id="cb80-1051"><a href="#cb80-1051" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb80-1052"><a href="#cb80-1052" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1053"><a href="#cb80-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1054"><a href="#cb80-1054" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> author_age, <span class="at">fill =</span> subreddit)) <span class="sc">+</span> </span>
<span id="cb80-1055"><a href="#cb80-1055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="st">'stack'</span>) <span class="sc">+</span></span>
<span id="cb80-1056"><a href="#cb80-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Author Age per Subreddit"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of"</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">"posts,"</span>, <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age)), <span class="st">"had an age indication"</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age))<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1057"><a href="#cb80-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Author Age"</span>, <span class="at">y =</span> <span class="st">"Amount of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1058"><a href="#cb80-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Subreddit"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#69b3a2"</span>,<span class="st">"#404080"</span>),</span>
<span id="cb80-1059"><a href="#cb80-1059" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Relationship Advice"</span>,<span class="st">"Relationships"</span>),) <span class="sc">+</span></span>
<span id="cb80-1060"><a href="#cb80-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1061"><a href="#cb80-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1062"><a href="#cb80-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1063"><a href="#cb80-1063" aria-hidden="true" tabindex="-1"></a>Age distribution by subreddit and gender</span>
<span id="cb80-1064"><a href="#cb80-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1065"><a href="#cb80-1065" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-cont3, include = FALSE}</span></span>
<span id="cb80-1066"><a href="#cb80-1066" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribtuion of author Gender across subreddits</span></span>
<span id="cb80-1067"><a href="#cb80-1067" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(data<span class="sc">$</span>author_gender,data<span class="sc">$</span>subreddit)</span>
<span id="cb80-1068"><a href="#cb80-1068" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(tab)</span>
<span id="cb80-1069"><a href="#cb80-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1070"><a href="#cb80-1070" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe for plotting gender by subreddit</span></span>
<span id="cb80-1071"><a href="#cb80-1071" aria-hidden="true" tabindex="-1"></a>tab_data <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="fu">unlist</span>(tab))</span>
<span id="cb80-1072"><a href="#cb80-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1073"><a href="#cb80-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1074"><a href="#cb80-1074" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-cont4, echo=FALSE}</span></span>
<span id="cb80-1075"><a href="#cb80-1075" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb80-1076"><a href="#cb80-1076" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1077"><a href="#cb80-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1078"><a href="#cb80-1078" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1079"><a href="#cb80-1079" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> subreddit, <span class="at">y =</span> author_age, <span class="at">fill =</span> author_gender)) <span class="sc">+</span> </span>
<span id="cb80-1080"><a href="#cb80-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb80-1081"><a href="#cb80-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Author Age by Gender and Subreddit"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of"</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">"posts,"</span>, <span class="fu">sum</span>(tab_data<span class="sc">$</span>Freq[<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">14</span>)]), <span class="st">"had a gender indication"</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">sum</span>(tab_data<span class="sc">$</span>Freq[<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">14</span>)])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1082"><a href="#cb80-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Subreddit"</span>, <span class="at">y =</span> <span class="st">"Author Age"</span>) <span class="sc">+</span></span>
<span id="cb80-1083"><a href="#cb80-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1084"><a href="#cb80-1084" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>,<span class="st">"FemaleToMale"</span>,<span class="st">"Male"</span>,</span>
<span id="cb80-1085"><a href="#cb80-1085" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"MaleToFemale"</span>,<span class="st">"Non-binary"</span>,</span>
<span id="cb80-1086"><a href="#cb80-1086" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Missing"</span>),</span>
<span id="cb80-1087"><a href="#cb80-1087" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>,<span class="st">"#5DE2D6"</span>,<span class="st">"#5DC2E2"</span>,<span class="st">"#AC5DE2"</span>,<span class="st">"#CEE25D"</span>,</span>
<span id="cb80-1088"><a href="#cb80-1088" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-1089"><a href="#cb80-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Relationship Advice"</span>, <span class="st">"Relationships"</span>)) <span class="sc">+</span></span>
<span id="cb80-1090"><a href="#cb80-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1091"><a href="#cb80-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1092"><a href="#cb80-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1093"><a href="#cb80-1093" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Age distribution by subreddit and gender for non-cis gender authors</span></span>
<span id="cb80-1094"><a href="#cb80-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1095"><a href="#cb80-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-cont5, include = FALSE}</span></span>
<span id="cb80-1096"><a href="#cb80-1096" aria-hidden="true" tabindex="-1"></a><span class="co"># Subsetting the data</span></span>
<span id="cb80-1097"><a href="#cb80-1097" aria-hidden="true" tabindex="-1"></a>data_nc <span class="ot">&lt;-</span> data[data<span class="sc">$</span>author_gender <span class="sc">==</span> <span class="st">"ftm"</span> <span class="sc">|</span></span>
<span id="cb80-1098"><a href="#cb80-1098" aria-hidden="true" tabindex="-1"></a>                  data<span class="sc">$</span>author_gender <span class="sc">==</span> <span class="st">"mtf"</span> <span class="sc">|</span></span>
<span id="cb80-1099"><a href="#cb80-1099" aria-hidden="true" tabindex="-1"></a>                  data<span class="sc">$</span>author_gender <span class="sc">==</span> <span class="st">"non-binary"</span> <span class="sc">|</span></span>
<span id="cb80-1100"><a href="#cb80-1100" aria-hidden="true" tabindex="-1"></a>                  data<span class="sc">$</span>author_gender <span class="sc">==</span> <span class="st">"trans"</span>,]</span>
<span id="cb80-1101"><a href="#cb80-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1102"><a href="#cb80-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1103"><a href="#cb80-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-cont6, echo = FALSE}</span></span>
<span id="cb80-1104"><a href="#cb80-1104" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb80-1105"><a href="#cb80-1105" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1106"><a href="#cb80-1106" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1107"><a href="#cb80-1107" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_nc, <span class="fu">aes</span>(<span class="at">x =</span> author_age, <span class="at">fill =</span> author_gender)) <span class="sc">+</span> </span>
<span id="cb80-1108"><a href="#cb80-1108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="st">'stack'</span>) <span class="sc">+</span></span>
<span id="cb80-1109"><a href="#cb80-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Author Age for non Cis-gendered Authors per Subreddit"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of"</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">"posts,"</span>, <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age)), <span class="st">"had an age indication"</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>author_age))<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1110"><a href="#cb80-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Author Age"</span>, <span class="at">y =</span> <span class="st">"Amount of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1111"><a href="#cb80-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1112"><a href="#cb80-1112" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"FemaleToMale"</span>,<span class="st">"MaleToFemale"</span>,</span>
<span id="cb80-1113"><a href="#cb80-1113" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Non-binary"</span>,<span class="st">"Trans"</span>),</span>
<span id="cb80-1114"><a href="#cb80-1114" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DE2D6"</span>,<span class="st">"#AC5DE2"</span>,<span class="st">"#CEE25D"</span>,<span class="st">"#5DE28F"</span>)) <span class="sc">+</span> </span>
<span id="cb80-1115"><a href="#cb80-1115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb80-1116"><a href="#cb80-1116" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(subreddit),</span>
<span id="cb80-1117"><a href="#cb80-1117" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">subreddit =</span> <span class="fu">c</span>(<span class="st">"relationship_advice"</span> <span class="ot">=</span> <span class="st">"Relationship advice"</span>, <span class="st">"relationships"</span> <span class="ot">=</span> <span class="st">"Relationships"</span>))) <span class="sc">+</span></span>
<span id="cb80-1118"><a href="#cb80-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1119"><a href="#cb80-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1120"><a href="#cb80-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1121"><a href="#cb80-1121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age-cont7, include=FALSE}</span></span>
<span id="cb80-1122"><a href="#cb80-1122" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data_aggregated_days_age, data_aggregated_hours_age,</span>
<span id="cb80-1123"><a href="#cb80-1123" aria-hidden="true" tabindex="-1"></a>   data_aggregated_months_age, data_aggregated_time,</span>
<span id="cb80-1124"><a href="#cb80-1124" aria-hidden="true" tabindex="-1"></a>   data_aggregated_weekdays_age, data_aggregated_years_age,</span>
<span id="cb80-1125"><a href="#cb80-1125" aria-hidden="true" tabindex="-1"></a>   tab_data, data_time, tab, data_nc)</span>
<span id="cb80-1126"><a href="#cb80-1126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1127"><a href="#cb80-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1128"><a href="#cb80-1128" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Distribution of Author Gender</span></span>
<span id="cb80-1129"><a href="#cb80-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1130"><a href="#cb80-1130" aria-hidden="true" tabindex="-1"></a>In the next steps, we look at the distribution of various variables in our data set by gender (sometimes in combination with the subreddit in which a post was posted). We start by checking the gender of the writers of our posts:</span>
<span id="cb80-1131"><a href="#cb80-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1132"><a href="#cb80-1132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures, echo=FALSE}</span></span>
<span id="cb80-1133"><a href="#cb80-1133" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1134"><a href="#cb80-1134" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate data set aggregated at gender level:</span></span>
<span id="cb80-1135"><a href="#cb80-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1136"><a href="#cb80-1136" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1137"><a href="#cb80-1137" aria-hidden="true" tabindex="-1"></a>data_aggregated_gender <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-1138"><a href="#cb80-1138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(author_gender) <span class="sc">%&gt;%</span></span>
<span id="cb80-1139"><a href="#cb80-1139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"keep"</span>)</span>
<span id="cb80-1140"><a href="#cb80-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1141"><a href="#cb80-1141" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the colors</span></span>
<span id="cb80-1142"><a href="#cb80-1142" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>, <span class="st">"#5DE2D6"</span>, <span class="st">"#5DC2E2"</span>, <span class="st">"#AC5DE2"</span>, <span class="st">"#CEE25D"</span>, <span class="st">"#7E8581"</span>)</span>
<span id="cb80-1143"><a href="#cb80-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1144"><a href="#cb80-1144" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb80-1145"><a href="#cb80-1145" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_gender, <span class="fu">aes</span>(<span class="at">y =</span> count, <span class="at">x =</span> author_gender, <span class="at">fill =</span> author_gender)) <span class="sc">+</span> </span>
<span id="cb80-1146"><a href="#cb80-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-1147"><a href="#cb80-1147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb80-1148"><a href="#cb80-1148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of Posts by Gender of the Author"</span>,</span>
<span id="cb80-1149"><a href="#cb80-1149" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of "</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">" posts, "</span>,</span>
<span id="cb80-1150"><a href="#cb80-1150" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]), </span>
<span id="cb80-1151"><a href="#cb80-1151" aria-hidden="true" tabindex="-1"></a>                           <span class="st">" had a gender indication "</span>, <span class="st">"("</span>, <span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]) <span class="sc">/</span> <span class="fu">dim</span>(data)[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb80-1152"><a href="#cb80-1152" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb80-1153"><a href="#cb80-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gender"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb80-1154"><a href="#cb80-1154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"FemaleToMale"</span>, <span class="st">"Male"</span>, <span class="st">"MaleToFemale"</span>, <span class="st">"Non-binary"</span>, <span class="st">"Missing"</span>)) <span class="sc">+</span></span>
<span id="cb80-1155"><a href="#cb80-1155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-1156"><a href="#cb80-1156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb80-1157"><a href="#cb80-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1158"><a href="#cb80-1158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1159"><a href="#cb80-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1160"><a href="#cb80-1160" aria-hidden="true" tabindex="-1"></a>Next, we have a look at the distribution of posts across subreddits:</span>
<span id="cb80-1161"><a href="#cb80-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1162"><a href="#cb80-1162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures1, include = FALSE}</span></span>
<span id="cb80-1163"><a href="#cb80-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1164"><a href="#cb80-1164" aria-hidden="true" tabindex="-1"></a><span class="do">### Plots for various variables in our data set by genders</span></span>
<span id="cb80-1165"><a href="#cb80-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1166"><a href="#cb80-1166" aria-hidden="true" tabindex="-1"></a><span class="do">## Create aggregate data frames for month-years</span></span>
<span id="cb80-1167"><a href="#cb80-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1168"><a href="#cb80-1168" aria-hidden="true" tabindex="-1"></a><span class="co"># For all genders:</span></span>
<span id="cb80-1169"><a href="#cb80-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1170"><a href="#cb80-1170" aria-hidden="true" tabindex="-1"></a>data_aggregated_time <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-1171"><a href="#cb80-1171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(created_month_year, author_gender) <span class="sc">%&gt;%</span></span>
<span id="cb80-1172"><a href="#cb80-1172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"keep"</span>)</span>
<span id="cb80-1173"><a href="#cb80-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1174"><a href="#cb80-1174" aria-hidden="true" tabindex="-1"></a><span class="co"># For binary gender with one other category:</span></span>
<span id="cb80-1175"><a href="#cb80-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1176"><a href="#cb80-1176" aria-hidden="true" tabindex="-1"></a>data_aggregated_time_binary <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-1177"><a href="#cb80-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(created_month_year, author_gender_binary) <span class="sc">%&gt;%</span></span>
<span id="cb80-1178"><a href="#cb80-1178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"keep"</span>)</span>
<span id="cb80-1179"><a href="#cb80-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1180"><a href="#cb80-1180" aria-hidden="true" tabindex="-1"></a><span class="co"># For all other genders:</span></span>
<span id="cb80-1181"><a href="#cb80-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1182"><a href="#cb80-1182" aria-hidden="true" tabindex="-1"></a><span class="co"># Also across time &amp; subreddits for all genders:</span></span>
<span id="cb80-1183"><a href="#cb80-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1184"><a href="#cb80-1184" aria-hidden="true" tabindex="-1"></a>data_aggregated_time_sub <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-1185"><a href="#cb80-1185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(created_month_year,subreddit,author_gender) <span class="sc">%&gt;%</span></span>
<span id="cb80-1186"><a href="#cb80-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-1187"><a href="#cb80-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1188"><a href="#cb80-1188" aria-hidden="true" tabindex="-1"></a><span class="co"># Also across time &amp; subreddits for binary gender:</span></span>
<span id="cb80-1189"><a href="#cb80-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1190"><a href="#cb80-1190" aria-hidden="true" tabindex="-1"></a>data_aggregated_time_binary_sub <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-1191"><a href="#cb80-1191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(created_month_year,subreddit,author_gender_binary) <span class="sc">%&gt;%</span></span>
<span id="cb80-1192"><a href="#cb80-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-1193"><a href="#cb80-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1194"><a href="#cb80-1194" aria-hidden="true" tabindex="-1"></a><span class="co"># Only across subreddits &amp; gender</span></span>
<span id="cb80-1195"><a href="#cb80-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1196"><a href="#cb80-1196" aria-hidden="true" tabindex="-1"></a>data_aggregated_sub <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-1197"><a href="#cb80-1197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subreddit,author_gender) <span class="sc">%&gt;%</span></span>
<span id="cb80-1198"><a href="#cb80-1198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-1199"><a href="#cb80-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1200"><a href="#cb80-1200" aria-hidden="true" tabindex="-1"></a><span class="co"># For binary gender</span></span>
<span id="cb80-1201"><a href="#cb80-1201" aria-hidden="true" tabindex="-1"></a>data_aggregated_sub_binary <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-1202"><a href="#cb80-1202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subreddit,author_gender_binary) <span class="sc">%&gt;%</span></span>
<span id="cb80-1203"><a href="#cb80-1203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-1204"><a href="#cb80-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1205"><a href="#cb80-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1206"><a href="#cb80-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1207"><a href="#cb80-1207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures2, echo=FALSE}</span></span>
<span id="cb80-1208"><a href="#cb80-1208" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1209"><a href="#cb80-1209" aria-hidden="true" tabindex="-1"></a><span class="do">## Plotting gender across subreddits</span></span>
<span id="cb80-1210"><a href="#cb80-1210" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1211"><a href="#cb80-1211" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_sub, <span class="fu">aes</span>(<span class="at">fill =</span> author_gender, <span class="at">y =</span> count, <span class="at">x =</span> subreddit)) <span class="sc">+</span> </span>
<span id="cb80-1212"><a href="#cb80-1212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-1213"><a href="#cb80-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Post Author Gender by Subreddit"</span>,</span>
<span id="cb80-1214"><a href="#cb80-1214" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of "</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">" posts, "</span>,</span>
<span id="cb80-1215"><a href="#cb80-1215" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]), <span class="st">" had a gender indication "</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">"%)"</span>,<span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb80-1216"><a href="#cb80-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Subreddit"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb80-1217"><a href="#cb80-1217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1218"><a href="#cb80-1218" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>,<span class="st">"FemaleToMale"</span>,<span class="st">"Male"</span>,</span>
<span id="cb80-1219"><a href="#cb80-1219" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"MaleToFemale"</span>,<span class="st">"Non-binary"</span>,<span class="st">"Missing"</span>),</span>
<span id="cb80-1220"><a href="#cb80-1220" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>,<span class="st">"#5DE2D6"</span>,<span class="st">"#5DC2E2"</span>,<span class="st">"#AC5DE2"</span>,</span>
<span id="cb80-1221"><a href="#cb80-1221" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#CEE25D"</span>, <span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-1222"><a href="#cb80-1222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Relationship Advice"</span>, <span class="st">"Relationships"</span>)) <span class="sc">+</span></span>
<span id="cb80-1223"><a href="#cb80-1223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1224"><a href="#cb80-1224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1225"><a href="#cb80-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1226"><a href="#cb80-1226" aria-hidden="true" tabindex="-1"></a>Now, gender over time:</span>
<span id="cb80-1227"><a href="#cb80-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1228"><a href="#cb80-1228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures3, echo = FALSE}</span></span>
<span id="cb80-1229"><a href="#cb80-1229" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1230"><a href="#cb80-1230" aria-hidden="true" tabindex="-1"></a><span class="do">## Plotting post author gender over time:</span></span>
<span id="cb80-1231"><a href="#cb80-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1232"><a href="#cb80-1232" aria-hidden="true" tabindex="-1"></a><span class="do">## (1) for all genders</span></span>
<span id="cb80-1233"><a href="#cb80-1233" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1234"><a href="#cb80-1234" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_time, <span class="fu">aes</span>(<span class="at">fill =</span> author_gender, <span class="at">y =</span> count,</span>
<span id="cb80-1235"><a href="#cb80-1235" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x =</span> created_month_year)) <span class="sc">+</span> </span>
<span id="cb80-1236"><a href="#cb80-1236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-1237"><a href="#cb80-1237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Post Author Gender over time"</span>,</span>
<span id="cb80-1238"><a href="#cb80-1238" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of"</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">"posts,"</span>, <span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]), <span class="st">"had a gender indication"</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1239"><a href="#cb80-1239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month-Year"</span>, <span class="at">y =</span> <span class="st">"Number of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1240"><a href="#cb80-1240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Gender"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"FemaleToMale"</span>,</span>
<span id="cb80-1241"><a href="#cb80-1241" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Male"</span>, <span class="st">"MaleToFemale"</span>,</span>
<span id="cb80-1242"><a href="#cb80-1242" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Non-binary"</span>,</span>
<span id="cb80-1243"><a href="#cb80-1243" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Missing"</span>),</span>
<span id="cb80-1244"><a href="#cb80-1244" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>,<span class="st">"#5DE2D6"</span>,<span class="st">"#5DC2E2"</span>,<span class="st">"#AC5DE2"</span>,</span>
<span id="cb80-1245"><a href="#cb80-1245" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#CEE25D"</span>, <span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-1246"><a href="#cb80-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">gsub</span>(<span class="st">'-'</span>, <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>, x)) <span class="sc">+</span></span>
<span id="cb80-1247"><a href="#cb80-1247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1248"><a href="#cb80-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1249"><a href="#cb80-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1250"><a href="#cb80-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1251"><a href="#cb80-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures4, echo=FALSE}</span></span>
<span id="cb80-1252"><a href="#cb80-1252" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1253"><a href="#cb80-1253" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) For binary gender with one other category:</span></span>
<span id="cb80-1254"><a href="#cb80-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1255"><a href="#cb80-1255" aria-hidden="true" tabindex="-1"></a><span class="co"># Bars next to one another instead of stacked:</span></span>
<span id="cb80-1256"><a href="#cb80-1256" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1257"><a href="#cb80-1257" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_time_binary, <span class="fu">aes</span>(<span class="at">fill =</span> author_gender_binary, <span class="at">y =</span> count, <span class="at">x =</span> created_month_year)) <span class="sc">+</span></span>
<span id="cb80-1258"><a href="#cb80-1258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-1259"><a href="#cb80-1259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb80-1260"><a href="#cb80-1260" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Post Author Gender over time"</span>,</span>
<span id="cb80-1261"><a href="#cb80-1261" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(</span>
<span id="cb80-1262"><a href="#cb80-1262" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Out of"</span>,</span>
<span id="cb80-1263"><a href="#cb80-1263" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dim</span>(data)[<span class="dv">1</span>],</span>
<span id="cb80-1264"><a href="#cb80-1264" aria-hidden="true" tabindex="-1"></a>      <span class="st">"posts,"</span>,</span>
<span id="cb80-1265"><a href="#cb80-1265" aria-hidden="true" tabindex="-1"></a>      <span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]),</span>
<span id="cb80-1266"><a href="#cb80-1266" aria-hidden="true" tabindex="-1"></a>      <span class="st">"had a gender indication"</span>,</span>
<span id="cb80-1267"><a href="#cb80-1267" aria-hidden="true" tabindex="-1"></a>      <span class="st">"("</span>,</span>
<span id="cb80-1268"><a href="#cb80-1268" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(</span>
<span id="cb80-1269"><a href="#cb80-1269" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]) <span class="sc">/</span> <span class="fu">dim</span>(data)[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1270"><a href="#cb80-1270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month-Year"</span>, <span class="at">y =</span> <span class="st">"Number of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1271"><a href="#cb80-1271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb80-1272"><a href="#cb80-1272" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1273"><a href="#cb80-1273" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>, <span class="st">"Other"</span>, <span class="st">"Missing"</span>), <span class="co"># updated order of labels</span></span>
<span id="cb80-1274"><a href="#cb80-1274" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>, <span class="st">"#5DC2E2"</span>, <span class="st">"#5DE2D6"</span>, <span class="st">"#7E8581"</span>)</span>
<span id="cb80-1275"><a href="#cb80-1275" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb80-1276"><a href="#cb80-1276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">gsub</span>(<span class="st">'-'</span>, <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>, x)) <span class="sc">+</span></span>
<span id="cb80-1277"><a href="#cb80-1277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1278"><a href="#cb80-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1279"><a href="#cb80-1279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1280"><a href="#cb80-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1281"><a href="#cb80-1281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures5, echo=FALSE}</span></span>
<span id="cb80-1282"><a href="#cb80-1282" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1283"><a href="#cb80-1283" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting post author gender by subreddit over time</span></span>
<span id="cb80-1284"><a href="#cb80-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1285"><a href="#cb80-1285" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) For all genders</span></span>
<span id="cb80-1286"><a href="#cb80-1286" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1287"><a href="#cb80-1287" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_time_sub, <span class="fu">aes</span>(<span class="at">fill =</span> author_gender, <span class="at">y =</span> count,</span>
<span id="cb80-1288"><a href="#cb80-1288" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">x =</span> created_month_year)) <span class="sc">+</span> </span>
<span id="cb80-1289"><a href="#cb80-1289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-1290"><a href="#cb80-1290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Post Author Gender over time by Subreddit"</span>,</span>
<span id="cb80-1291"><a href="#cb80-1291" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of"</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">"posts,"</span>, <span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]), <span class="st">"had a gender indication"</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1292"><a href="#cb80-1292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month-Year"</span>, <span class="at">y =</span> <span class="st">"Number of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1293"><a href="#cb80-1293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Gender"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"FemaleToMale"</span>,</span>
<span id="cb80-1294"><a href="#cb80-1294" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Male"</span>, <span class="st">"MaleToFemale"</span>,</span>
<span id="cb80-1295"><a href="#cb80-1295" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Non-binary"</span>, <span class="st">"Missing"</span>),</span>
<span id="cb80-1296"><a href="#cb80-1296" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>,<span class="st">"#5DE2D6"</span>,<span class="st">"#5DC2E2"</span>,<span class="st">"#AC5DE2"</span>,</span>
<span id="cb80-1297"><a href="#cb80-1297" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"#CEE25D"</span>, <span class="st">"#7E8581"</span>)) <span class="sc">+</span> </span>
<span id="cb80-1298"><a href="#cb80-1298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb80-1299"><a href="#cb80-1299" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(subreddit),</span>
<span id="cb80-1300"><a href="#cb80-1300" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">subreddit =</span> <span class="fu">c</span>(<span class="st">"relationship_advice"</span> <span class="ot">=</span> <span class="st">"Relationship advice"</span>, <span class="st">"relationships"</span> <span class="ot">=</span> <span class="st">"Relationships"</span>))) <span class="sc">+</span></span>
<span id="cb80-1301"><a href="#cb80-1301" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">gsub</span>(<span class="st">'-'</span>, <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>, x)) <span class="sc">+</span></span>
<span id="cb80-1302"><a href="#cb80-1302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1303"><a href="#cb80-1303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1304"><a href="#cb80-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1305"><a href="#cb80-1305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures6, echo=FALSE}</span></span>
<span id="cb80-1306"><a href="#cb80-1306" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1307"><a href="#cb80-1307" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) For binary gender (stacked next to each other &amp; right order)</span></span>
<span id="cb80-1308"><a href="#cb80-1308" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1309"><a href="#cb80-1309" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_time_binary_sub, <span class="fu">aes</span>(<span class="at">fill =</span> author_gender_binary,</span>
<span id="cb80-1310"><a href="#cb80-1310" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">y =</span> count,</span>
<span id="cb80-1311"><a href="#cb80-1311" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">x =</span> created_month_year)) <span class="sc">+</span></span>
<span id="cb80-1312"><a href="#cb80-1312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-1313"><a href="#cb80-1313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb80-1314"><a href="#cb80-1314" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Post Author Gender over time"</span>,</span>
<span id="cb80-1315"><a href="#cb80-1315" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(</span>
<span id="cb80-1316"><a href="#cb80-1316" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Out of"</span>,</span>
<span id="cb80-1317"><a href="#cb80-1317" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dim</span>(data)[<span class="dv">1</span>],</span>
<span id="cb80-1318"><a href="#cb80-1318" aria-hidden="true" tabindex="-1"></a>      <span class="st">"posts,"</span>,</span>
<span id="cb80-1319"><a href="#cb80-1319" aria-hidden="true" tabindex="-1"></a>      <span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]),</span>
<span id="cb80-1320"><a href="#cb80-1320" aria-hidden="true" tabindex="-1"></a>      <span class="st">"had a gender indication"</span>,</span>
<span id="cb80-1321"><a href="#cb80-1321" aria-hidden="true" tabindex="-1"></a>      <span class="st">"("</span>,</span>
<span id="cb80-1322"><a href="#cb80-1322" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(</span>
<span id="cb80-1323"><a href="#cb80-1323" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]) <span class="sc">/</span> <span class="fu">dim</span>(data)[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1324"><a href="#cb80-1324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month-Year"</span>, <span class="at">y =</span> <span class="st">"Number of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1325"><a href="#cb80-1325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb80-1326"><a href="#cb80-1326" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1327"><a href="#cb80-1327" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>, <span class="st">"Other"</span>, <span class="st">"Missing"</span>), <span class="co"># updated order of labels</span></span>
<span id="cb80-1328"><a href="#cb80-1328" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>, <span class="st">"#5DC2E2"</span>, <span class="st">"#5DE2D6"</span>, <span class="st">"#7E8581"</span>)</span>
<span id="cb80-1329"><a href="#cb80-1329" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">+</span> </span>
<span id="cb80-1330"><a href="#cb80-1330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb80-1331"><a href="#cb80-1331" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(subreddit),</span>
<span id="cb80-1332"><a href="#cb80-1332" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">subreddit =</span> <span class="fu">c</span>(<span class="st">"relationship_advice"</span> <span class="ot">=</span> <span class="st">"Relationship advice"</span>, <span class="st">"relationships"</span> <span class="ot">=</span> <span class="st">"Relationships"</span>))) <span class="sc">+</span></span>
<span id="cb80-1333"><a href="#cb80-1333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">gsub</span>(<span class="st">'-'</span>, <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>, x)) <span class="sc">+</span></span>
<span id="cb80-1334"><a href="#cb80-1334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1335"><a href="#cb80-1335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1336"><a href="#cb80-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1337"><a href="#cb80-1337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures7, include=FALSE}</span></span>
<span id="cb80-1338"><a href="#cb80-1338" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean the environment</span></span>
<span id="cb80-1339"><a href="#cb80-1339" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data_aggregated_time, data_aggregated_time_binary,</span>
<span id="cb80-1340"><a href="#cb80-1340" aria-hidden="true" tabindex="-1"></a>   data_aggregated_time_binary_sub, data_aggregated_time_sub,</span>
<span id="cb80-1341"><a href="#cb80-1341" aria-hidden="true" tabindex="-1"></a>   data_aggregated_sub, data_aggregated_sub_binary, colors,</span>
<span id="cb80-1342"><a href="#cb80-1342" aria-hidden="true" tabindex="-1"></a>   data_aggregated_gender)</span>
<span id="cb80-1343"><a href="#cb80-1343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1344"><a href="#cb80-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1345"><a href="#cb80-1345" aria-hidden="true" tabindex="-1"></a>Looking at the number of comments a post received depending on the poster's gender:</span>
<span id="cb80-1346"><a href="#cb80-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1347"><a href="#cb80-1347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures8, echo = FALSE}</span></span>
<span id="cb80-1348"><a href="#cb80-1348" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1349"><a href="#cb80-1349" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>num_comments)</span>
<span id="cb80-1350"><a href="#cb80-1350" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>num_comments[data<span class="sc">$</span>author_gender_binary <span class="sc">==</span> <span class="st">"f"</span>])</span>
<span id="cb80-1351"><a href="#cb80-1351" aria-hidden="true" tabindex="-1"></a><span class="co"># female authors with higher mean &amp; maximum</span></span>
<span id="cb80-1352"><a href="#cb80-1352" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>num_comments[data<span class="sc">$</span>author_gender_binary <span class="sc">==</span> <span class="st">"m"</span>])</span>
<span id="cb80-1353"><a href="#cb80-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1354"><a href="#cb80-1354" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting winsorized number of comments distribution by gender</span></span>
<span id="cb80-1355"><a href="#cb80-1355" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1356"><a href="#cb80-1356" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the levels of 'author_gender_binary'</span></span>
<span id="cb80-1357"><a href="#cb80-1357" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>author_gender_binary <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>author_gender_binary,</span>
<span id="cb80-1358"><a href="#cb80-1358" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"m"</span>, <span class="st">"other"</span>, <span class="st">"Missing"</span>))</span>
<span id="cb80-1359"><a href="#cb80-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1360"><a href="#cb80-1360" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">Winsorize</span>(num_comments, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.0178</span>,<span class="fl">0.9822</span>)),</span>
<span id="cb80-1361"><a href="#cb80-1361" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> author_gender_binary)) <span class="sc">+</span></span>
<span id="cb80-1362"><a href="#cb80-1362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-1363"><a href="#cb80-1363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Number of Comments"</span>, <span class="at">subtitle =</span> <span class="st">"Winsorizing was done for top 1,72%, representing posts with more than 100 comments"</span>) <span class="sc">+</span></span>
<span id="cb80-1364"><a href="#cb80-1364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Winsorized Comment Number"</span>, <span class="at">y =</span> <span class="st">"Number of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1365"><a href="#cb80-1365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb80-1366"><a href="#cb80-1366" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1367"><a href="#cb80-1367" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>, <span class="st">"Other"</span>, <span class="st">"Missing"</span>), <span class="co"># updated order of labels</span></span>
<span id="cb80-1368"><a href="#cb80-1368" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>, <span class="st">"#5DC2E2"</span>, <span class="st">"#5DE2D6"</span>, <span class="st">"#7E8581"</span>)</span>
<span id="cb80-1369"><a href="#cb80-1369" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-1370"><a href="#cb80-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1371"><a href="#cb80-1371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1372"><a href="#cb80-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1373"><a href="#cb80-1373" aria-hidden="true" tabindex="-1"></a>Female authors with higher average number of comments and also higher maximum. Winsorized distribution of the number of comments hard to interpret, so let's have a look at a boxplot &amp; violin (which also will not tell us that much because of the extremely skewed distribution).</span>
<span id="cb80-1374"><a href="#cb80-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1375"><a href="#cb80-1375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures8a, echo = FALSE}</span></span>
<span id="cb80-1376"><a href="#cb80-1376" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1377"><a href="#cb80-1377" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of number of comments for male &amp; female:</span></span>
<span id="cb80-1378"><a href="#cb80-1378" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1379"><a href="#cb80-1379" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data</span></span>
<span id="cb80-1380"><a href="#cb80-1380" aria-hidden="true" tabindex="-1"></a>data_subset_gender <span class="ot">&lt;-</span> data[data<span class="sc">$</span>author_gender_binary <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"m"</span>),]</span>
<span id="cb80-1381"><a href="#cb80-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1382"><a href="#cb80-1382" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the boxplots</span></span>
<span id="cb80-1383"><a href="#cb80-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1384"><a href="#cb80-1384" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_subset_gender, <span class="fu">aes</span>(<span class="at">x =</span> author_gender_binary, <span class="at">y =</span> num_comments)) <span class="sc">+</span> </span>
<span id="cb80-1385"><a href="#cb80-1385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb80-1386"><a href="#cb80-1386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Author Gender"</span>, <span class="at">y =</span> <span class="st">"Number of Comments"</span>) <span class="sc">+</span></span>
<span id="cb80-1387"><a href="#cb80-1387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Number of Comments by Author Gender"</span>) <span class="sc">+</span></span>
<span id="cb80-1388"><a href="#cb80-1388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-1389"><a href="#cb80-1389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"f"</span> <span class="ot">=</span> <span class="st">"Female"</span>, <span class="st">"m"</span> <span class="ot">=</span> <span class="st">"Male"</span>))</span>
<span id="cb80-1390"><a href="#cb80-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1391"><a href="#cb80-1391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1392"><a href="#cb80-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1393"><a href="#cb80-1393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures8b, echo = FALSE}</span></span>
<span id="cb80-1394"><a href="#cb80-1394" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1395"><a href="#cb80-1395" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a violin plot (also not better)</span></span>
<span id="cb80-1396"><a href="#cb80-1396" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1397"><a href="#cb80-1397" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_subset_gender, <span class="fu">aes</span>(<span class="at">x =</span> author_gender_binary, <span class="at">y =</span> num_comments,</span>
<span id="cb80-1398"><a href="#cb80-1398" aria-hidden="true" tabindex="-1"></a>                               <span class="at">fill =</span> author_gender_binary)) <span class="sc">+</span> </span>
<span id="cb80-1399"><a href="#cb80-1399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb80-1400"><a href="#cb80-1400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Number of Comments by Gender of the Author"</span>, <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Out of"</span>, <span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="st">"posts,"</span>, <span class="fu">sum</span>(data<span class="sc">$</span>Freq[<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">14</span>)]), <span class="st">"had a gender indication"</span>, <span class="st">"("</span>,<span class="fu">round</span>((<span class="fu">sum</span>(data<span class="sc">$</span>Freq[<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">14</span>)])<span class="sc">/</span><span class="fu">dim</span>(data)[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1401"><a href="#cb80-1401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gender"</span>, <span class="at">y =</span> <span class="st">"Number of Comments"</span>) <span class="sc">+</span></span>
<span id="cb80-1402"><a href="#cb80-1402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1403"><a href="#cb80-1403" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>),</span>
<span id="cb80-1404"><a href="#cb80-1404" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>, <span class="st">"#5DC2E2"</span>)) <span class="sc">+</span></span>
<span id="cb80-1405"><a href="#cb80-1405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>)) <span class="sc">+</span></span>
<span id="cb80-1406"><a href="#cb80-1406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-1407"><a href="#cb80-1407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb80-1408"><a href="#cb80-1408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1409"><a href="#cb80-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1410"><a href="#cb80-1410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures9, include = FALSE}</span></span>
<span id="cb80-1411"><a href="#cb80-1411" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean environment</span></span>
<span id="cb80-1412"><a href="#cb80-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1413"><a href="#cb80-1413" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data_subset_gender)</span>
<span id="cb80-1414"><a href="#cb80-1414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1415"><a href="#cb80-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1416"><a href="#cb80-1416" aria-hidden="true" tabindex="-1"></a>Now, doing the same for the number of upvotes:</span>
<span id="cb80-1417"><a href="#cb80-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1418"><a href="#cb80-1418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures10, echo = FALSE}</span></span>
<span id="cb80-1419"><a href="#cb80-1419" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1420"><a href="#cb80-1420" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>score)</span>
<span id="cb80-1421"><a href="#cb80-1421" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>score[data<span class="sc">$</span>author_gender_binary <span class="sc">==</span> <span class="st">"f"</span>])</span>
<span id="cb80-1422"><a href="#cb80-1422" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>score[data<span class="sc">$</span>author_gender_binary <span class="sc">==</span> <span class="st">"m"</span>])</span>
<span id="cb80-1423"><a href="#cb80-1423" aria-hidden="true" tabindex="-1"></a><span class="co"># Female authors getting more upvotes on average &amp; also higher maximum</span></span>
<span id="cb80-1424"><a href="#cb80-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1425"><a href="#cb80-1425" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1426"><a href="#cb80-1426" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting winsorized upvotes score distribution by gender</span></span>
<span id="cb80-1427"><a href="#cb80-1427" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">Winsorize</span>(score, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.0178</span>,<span class="fl">0.9822</span>)),</span>
<span id="cb80-1428"><a href="#cb80-1428" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> author_gender_binary)) <span class="sc">+</span></span>
<span id="cb80-1429"><a href="#cb80-1429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-1430"><a href="#cb80-1430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Number of Comments"</span>, <span class="at">subtitle =</span> <span class="st">"Winsorizing was done for top 1,72%, representing posts with more than 100 upvotes"</span>) <span class="sc">+</span></span>
<span id="cb80-1431"><a href="#cb80-1431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Winsorized Comment Number"</span>, <span class="at">y =</span> <span class="st">"Number of Posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1432"><a href="#cb80-1432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1433"><a href="#cb80-1433" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>, <span class="st">"Other"</span>, <span class="st">"Missing"</span>),</span>
<span id="cb80-1434"><a href="#cb80-1434" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>, <span class="st">"#5DC2E2"</span>, <span class="st">"#5DE2D6"</span>, <span class="st">"#7E8581"</span>))</span>
<span id="cb80-1435"><a href="#cb80-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1436"><a href="#cb80-1436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1437"><a href="#cb80-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1438"><a href="#cb80-1438" aria-hidden="true" tabindex="-1"></a>Again, extremely left skewed distribution, as large majority of posts received 1 upvote due to Reddit's internal policies which is why we can try boxplots again (which also again will not be so much more revealing).</span>
<span id="cb80-1439"><a href="#cb80-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1440"><a href="#cb80-1440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures11, echo = FALSE}</span></span>
<span id="cb80-1441"><a href="#cb80-1441" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1442"><a href="#cb80-1442" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots of number of comments for male &amp; female:</span></span>
<span id="cb80-1443"><a href="#cb80-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1444"><a href="#cb80-1444" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1445"><a href="#cb80-1445" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data</span></span>
<span id="cb80-1446"><a href="#cb80-1446" aria-hidden="true" tabindex="-1"></a>data_subset_gender <span class="ot">&lt;-</span> data[data<span class="sc">$</span>author_gender_binary <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"m"</span>),]</span>
<span id="cb80-1447"><a href="#cb80-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1448"><a href="#cb80-1448" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the boxplots</span></span>
<span id="cb80-1449"><a href="#cb80-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1450"><a href="#cb80-1450" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_subset_gender, <span class="fu">aes</span>(<span class="at">x =</span> author_gender_binary, <span class="at">y =</span> score)) <span class="sc">+</span> </span>
<span id="cb80-1451"><a href="#cb80-1451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb80-1452"><a href="#cb80-1452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Author Gender"</span>, <span class="at">y =</span> <span class="st">"Number of Upvotes"</span>) <span class="sc">+</span></span>
<span id="cb80-1453"><a href="#cb80-1453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Number of Upvotes by Author Gender"</span>) <span class="sc">+</span></span>
<span id="cb80-1454"><a href="#cb80-1454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-1455"><a href="#cb80-1455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"f"</span> <span class="ot">=</span> <span class="st">"Female"</span>, <span class="st">"m"</span> <span class="ot">=</span> <span class="st">"Male"</span>))</span>
<span id="cb80-1456"><a href="#cb80-1456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1457"><a href="#cb80-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1458"><a href="#cb80-1458" aria-hidden="true" tabindex="-1"></a>As before, we see that female posters get slightly more upvotes and the maximum of upvotes is also higher for women.</span>
<span id="cb80-1459"><a href="#cb80-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1460"><a href="#cb80-1460" aria-hidden="true" tabindex="-1"></a>Lastly, we want to look at how often female and male author's post.</span>
<span id="cb80-1461"><a href="#cb80-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1462"><a href="#cb80-1462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures12, include = FALSE}</span></span>
<span id="cb80-1463"><a href="#cb80-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1464"><a href="#cb80-1464" aria-hidden="true" tabindex="-1"></a><span class="do">## Pre-processing</span></span>
<span id="cb80-1465"><a href="#cb80-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1466"><a href="#cb80-1466" aria-hidden="true" tabindex="-1"></a><span class="co"># If this code chunk has been run before, need to remove factor variable</span></span>
<span id="cb80-1467"><a href="#cb80-1467" aria-hidden="true" tabindex="-1"></a><span class="co"># freq_authors from data set before running again (or else code will not work)</span></span>
<span id="cb80-1468"><a href="#cb80-1468" aria-hidden="true" tabindex="-1"></a><span class="co">#data &lt;- data %&gt;%</span></span>
<span id="cb80-1469"><a href="#cb80-1469" aria-hidden="true" tabindex="-1"></a><span class="co">#     select(c(-freq_authors))</span></span>
<span id="cb80-1470"><a href="#cb80-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1471"><a href="#cb80-1471" aria-hidden="true" tabindex="-1"></a><span class="co"># Create variable that shows how often someone posted</span></span>
<span id="cb80-1472"><a href="#cb80-1472" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1473"><a href="#cb80-1473" aria-hidden="true" tabindex="-1"></a>freq_authors <span class="ot">&lt;-</span> <span class="fu">table</span>(data<span class="sc">$</span>author)</span>
<span id="cb80-1474"><a href="#cb80-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1475"><a href="#cb80-1475" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-1476"><a href="#cb80-1476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq_authors =</span> <span class="fu">case_when</span>(</span>
<span id="cb80-1477"><a href="#cb80-1477" aria-hidden="true" tabindex="-1"></a>    freq_authors[author] <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Exactly Once"</span>,</span>
<span id="cb80-1478"><a href="#cb80-1478" aria-hidden="true" tabindex="-1"></a>    freq_authors[author] <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> freq_authors[author] <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"1-5 Times"</span>,</span>
<span id="cb80-1479"><a href="#cb80-1479" aria-hidden="true" tabindex="-1"></a>    freq_authors[author] <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"More than 5 Times"</span></span>
<span id="cb80-1480"><a href="#cb80-1480" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb80-1481"><a href="#cb80-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1482"><a href="#cb80-1482" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the levels of 'freq_authors'</span></span>
<span id="cb80-1483"><a href="#cb80-1483" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>freq_authors <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>freq_authors,</span>
<span id="cb80-1484"><a href="#cb80-1484" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Exactly Once"</span>, <span class="st">"1-5 Times"</span>,</span>
<span id="cb80-1485"><a href="#cb80-1485" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"More than 5 Times"</span>))</span>
<span id="cb80-1486"><a href="#cb80-1486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1487"><a href="#cb80-1487" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data<span class="sc">$</span>author[<span class="fu">is.na</span>(data<span class="sc">$</span>freq_authors)]) <span class="co"># Missing frequency if missing </span></span>
<span id="cb80-1488"><a href="#cb80-1488" aria-hidden="true" tabindex="-1"></a><span class="co"># information on the author</span></span>
<span id="cb80-1489"><a href="#cb80-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1490"><a href="#cb80-1490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1491"><a href="#cb80-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1492"><a href="#cb80-1492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures13, echo = FALSE}</span></span>
<span id="cb80-1493"><a href="#cb80-1493" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1494"><a href="#cb80-1494" aria-hidden="true" tabindex="-1"></a><span class="co"># As graph (only binary gender):</span></span>
<span id="cb80-1495"><a href="#cb80-1495" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1496"><a href="#cb80-1496" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data</span></span>
<span id="cb80-1497"><a href="#cb80-1497" aria-hidden="true" tabindex="-1"></a>data_subset_gender <span class="ot">&lt;-</span> data[data<span class="sc">$</span>author_gender <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"m"</span>),]</span>
<span id="cb80-1498"><a href="#cb80-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1499"><a href="#cb80-1499" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouped by binary gender:</span></span>
<span id="cb80-1500"><a href="#cb80-1500" aria-hidden="true" tabindex="-1"></a>data_aggregated_authors <span class="ot">&lt;-</span> data_subset_gender <span class="sc">%&gt;%</span></span>
<span id="cb80-1501"><a href="#cb80-1501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(freq_authors, author_gender) <span class="sc">%&gt;%</span></span>
<span id="cb80-1502"><a href="#cb80-1502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"keep"</span>)</span>
<span id="cb80-1503"><a href="#cb80-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1504"><a href="#cb80-1504" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot:</span></span>
<span id="cb80-1505"><a href="#cb80-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1506"><a href="#cb80-1506" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_authors, <span class="fu">aes</span>(<span class="at">fill =</span> author_gender,</span>
<span id="cb80-1507"><a href="#cb80-1507" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y =</span> count,</span>
<span id="cb80-1508"><a href="#cb80-1508" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">x =</span> freq_authors)) <span class="sc">+</span></span>
<span id="cb80-1509"><a href="#cb80-1509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-1510"><a href="#cb80-1510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb80-1511"><a href="#cb80-1511" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Frequency of author by gender"</span>,</span>
<span id="cb80-1512"><a href="#cb80-1512" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(</span>
<span id="cb80-1513"><a href="#cb80-1513" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Out of"</span>,</span>
<span id="cb80-1514"><a href="#cb80-1514" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dim</span>(data)[<span class="dv">1</span>],</span>
<span id="cb80-1515"><a href="#cb80-1515" aria-hidden="true" tabindex="-1"></a>      <span class="st">"posts,"</span>,</span>
<span id="cb80-1516"><a href="#cb80-1516" aria-hidden="true" tabindex="-1"></a>      <span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]),</span>
<span id="cb80-1517"><a href="#cb80-1517" aria-hidden="true" tabindex="-1"></a>      <span class="st">"had a gender indication"</span>,</span>
<span id="cb80-1518"><a href="#cb80-1518" aria-hidden="true" tabindex="-1"></a>      <span class="st">"("</span>,</span>
<span id="cb80-1519"><a href="#cb80-1519" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(</span>
<span id="cb80-1520"><a href="#cb80-1520" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]) <span class="sc">/</span> <span class="fu">dim</span>(data)[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1521"><a href="#cb80-1521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Frequency of author"</span>, <span class="at">y =</span> <span class="st">"Number of posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1522"><a href="#cb80-1522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb80-1523"><a href="#cb80-1523" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1524"><a href="#cb80-1524" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>), <span class="co"># updated order of labels</span></span>
<span id="cb80-1525"><a href="#cb80-1525" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>, <span class="st">"#5DC2E2"</span>)</span>
<span id="cb80-1526"><a href="#cb80-1526" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb80-1527"><a href="#cb80-1527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1528"><a href="#cb80-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1529"><a href="#cb80-1529" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1530"><a href="#cb80-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1531"><a href="#cb80-1531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures14, include = FALSE}</span></span>
<span id="cb80-1532"><a href="#cb80-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1533"><a href="#cb80-1533" aria-hidden="true" tabindex="-1"></a><span class="co"># For binary gender with "Other" category</span></span>
<span id="cb80-1534"><a href="#cb80-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1535"><a href="#cb80-1535" aria-hidden="true" tabindex="-1"></a>data_aggregated_gender <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb80-1536"><a href="#cb80-1536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(freq_authors, author_gender_binary) <span class="sc">%&gt;%</span></span>
<span id="cb80-1537"><a href="#cb80-1537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb80-1538"><a href="#cb80-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1539"><a href="#cb80-1539" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the levels of 'author_gender_binary'</span></span>
<span id="cb80-1540"><a href="#cb80-1540" aria-hidden="true" tabindex="-1"></a>data_aggregated_gender<span class="sc">$</span>author_gender_binary <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_aggregated_gender<span class="sc">$</span>author_gender_binary, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"m"</span>, <span class="st">"other"</span>, <span class="st">"Missing"</span>))</span>
<span id="cb80-1541"><a href="#cb80-1541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1542"><a href="#cb80-1542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1543"><a href="#cb80-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1544"><a href="#cb80-1544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures15, echo = FALSE}</span></span>
<span id="cb80-1545"><a href="#cb80-1545" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb80-1546"><a href="#cb80-1546" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb80-1547"><a href="#cb80-1547" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-1548"><a href="#cb80-1548" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_aggregated_gender, <span class="fu">aes</span>(<span class="at">fill =</span> author_gender_binary,</span>
<span id="cb80-1549"><a href="#cb80-1549" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y =</span> count,</span>
<span id="cb80-1550"><a href="#cb80-1550" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">x =</span> freq_authors)) <span class="sc">+</span></span>
<span id="cb80-1551"><a href="#cb80-1551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb80-1552"><a href="#cb80-1552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb80-1553"><a href="#cb80-1553" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Frequency of author by gender"</span>,</span>
<span id="cb80-1554"><a href="#cb80-1554" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(</span>
<span id="cb80-1555"><a href="#cb80-1555" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Out of"</span>,</span>
<span id="cb80-1556"><a href="#cb80-1556" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dim</span>(data)[<span class="dv">1</span>],</span>
<span id="cb80-1557"><a href="#cb80-1557" aria-hidden="true" tabindex="-1"></a>      <span class="st">"posts,"</span>,</span>
<span id="cb80-1558"><a href="#cb80-1558" aria-hidden="true" tabindex="-1"></a>      <span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]),</span>
<span id="cb80-1559"><a href="#cb80-1559" aria-hidden="true" tabindex="-1"></a>      <span class="st">"had a gender indication"</span>,</span>
<span id="cb80-1560"><a href="#cb80-1560" aria-hidden="true" tabindex="-1"></a>      <span class="st">"("</span>,</span>
<span id="cb80-1561"><a href="#cb80-1561" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(</span>
<span id="cb80-1562"><a href="#cb80-1562" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">length</span>(data<span class="sc">$</span>author_gender[data<span class="sc">$</span>author_gender <span class="sc">!=</span> <span class="st">"Missing"</span>]) <span class="sc">/</span> <span class="fu">dim</span>(data)[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb80-1563"><a href="#cb80-1563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Frequency of author"</span>, <span class="at">y =</span> <span class="st">"Number of posts"</span>) <span class="sc">+</span></span>
<span id="cb80-1564"><a href="#cb80-1564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Gender"</span>,</span>
<span id="cb80-1565"><a href="#cb80-1565" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>, <span class="st">"Other"</span>, <span class="st">"Missing"</span>),</span>
<span id="cb80-1566"><a href="#cb80-1566" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E25D5D"</span>, <span class="st">"#5DC2E2"</span>, <span class="st">"#5DE2D6"</span>, <span class="st">"#7E8581"</span>)) <span class="sc">+</span></span>
<span id="cb80-1567"><a href="#cb80-1567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb80-1568"><a href="#cb80-1568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1569"><a href="#cb80-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1570"><a href="#cb80-1570" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gender-figures16, include=FALSE}</span></span>
<span id="cb80-1571"><a href="#cb80-1571" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data_aggregated_authors, data_aggregated_gender, data_subset_gender,</span>
<span id="cb80-1572"><a href="#cb80-1572" aria-hidden="true" tabindex="-1"></a>   freq_authors)</span>
<span id="cb80-1573"><a href="#cb80-1573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1574"><a href="#cb80-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1575"><a href="#cb80-1575" aria-hidden="true" tabindex="-1"></a><span class="fu">## Structural Topic Modelling</span></span>
<span id="cb80-1576"><a href="#cb80-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1577"><a href="#cb80-1577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb80-1578"><a href="#cb80-1578" aria-hidden="true" tabindex="-1"></a><span class="do">### STM</span></span>
<span id="cb80-1579"><a href="#cb80-1579" aria-hidden="true" tabindex="-1"></a>reddit_stm <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">convert</span>(reddit_dfm, <span class="at">to =</span> <span class="st">'stm'</span>)</span>
<span id="cb80-1580"><a href="#cb80-1580" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(reddit_stm, <span class="st">"reddit_stm.rds"</span>)</span>
<span id="cb80-1581"><a href="#cb80-1581" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_wordcloud</span>(reddit_dfm,</span>
<span id="cb80-1582"><a href="#cb80-1582" aria-hidden="true" tabindex="-1"></a>                   <span class="at">max_words =</span> <span class="dv">100</span>,</span>
<span id="cb80-1583"><a href="#cb80-1583" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">'black'</span>,</span>
<span id="cb80-1584"><a href="#cb80-1584" aria-hidden="true" tabindex="-1"></a>                   <span class="at">min_size =</span> <span class="dv">2</span>,</span>
<span id="cb80-1585"><a href="#cb80-1585" aria-hidden="true" tabindex="-1"></a>                   <span class="at">max_size =</span> <span class="dv">5</span>)</span>
<span id="cb80-1586"><a href="#cb80-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1587"><a href="#cb80-1587" aria-hidden="true" tabindex="-1"></a><span class="fu">textstat_frequency</span>(reddit_dfm) <span class="sc">%&gt;%</span>  <span class="fu">head</span>(<span class="dv">400</span>)</span>
<span id="cb80-1588"><a href="#cb80-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1589"><a href="#cb80-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1590"><a href="#cb80-1590" aria-hidden="true" tabindex="-1"></a><span class="do">### STM 15</span></span>
<span id="cb80-1591"><a href="#cb80-1591" aria-hidden="true" tabindex="-1"></a>stm_15 <span class="ot">&lt;-</span> <span class="fu">stm</span>(<span class="at">documents =</span> reddit_stm<span class="sc">$</span>documents,</span>
<span id="cb80-1592"><a href="#cb80-1592" aria-hidden="true" tabindex="-1"></a>              <span class="at">vocab =</span> reddit_stm<span class="sc">$</span>vocab,</span>
<span id="cb80-1593"><a href="#cb80-1593" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> reddit_stm<span class="sc">$</span>meta,</span>
<span id="cb80-1594"><a href="#cb80-1594" aria-hidden="true" tabindex="-1"></a>              <span class="at">K =</span> <span class="dv">15</span>,</span>
<span id="cb80-1595"><a href="#cb80-1595" aria-hidden="true" tabindex="-1"></a>              <span class="at">prevalence =</span> <span class="sc">~</span> author_age_group <span class="sc">+</span> author_gender_binary,</span>
<span id="cb80-1596"><a href="#cb80-1596" aria-hidden="true" tabindex="-1"></a>              <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb80-1597"><a href="#cb80-1597" aria-hidden="true" tabindex="-1"></a>              <span class="at">seed =</span> <span class="dv">1328</span>)</span>
<span id="cb80-1598"><a href="#cb80-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1599"><a href="#cb80-1599" aria-hidden="true" tabindex="-1"></a>stm_effects15 <span class="ot">&lt;-</span> <span class="fu">estimateEffect</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">~</span> author_age_group <span class="sc">+</span> </span>
<span id="cb80-1600"><a href="#cb80-1600" aria-hidden="true" tabindex="-1"></a>                                  author_gender_binary,</span>
<span id="cb80-1601"><a href="#cb80-1601" aria-hidden="true" tabindex="-1"></a>                                <span class="at">stmobj =</span> stm_15, <span class="at">metadata =</span> reddit_stm<span class="sc">$</span>meta)</span>
<span id="cb80-1602"><a href="#cb80-1602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1603"><a href="#cb80-1603" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(reddit_stm, stm_15, stm_effects15, </span>
<span id="cb80-1604"><a href="#cb80-1604" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="st">"data/stm15_relationship.RData"</span>)</span>
<span id="cb80-1605"><a href="#cb80-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1606"><a href="#cb80-1606" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb80-1607"><a href="#cb80-1607" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stm_15)</span>
<span id="cb80-1608"><a href="#cb80-1608" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1609"><a href="#cb80-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1610"><a href="#cb80-1610" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assigning Meaning to Topics</span></span>
<span id="cb80-1611"><a href="#cb80-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1612"><a href="#cb80-1612" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Estimating Models with different K (between 10 and 50)</span>
<span id="cb80-1613"><a href="#cb80-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1614"><a href="#cb80-1614" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Inspecting the resulting topics qualitatively</span>
<span id="cb80-1615"><a href="#cb80-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1616"><a href="#cb80-1616" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Rock-paper-scissors to decide between K = 12 and K = 15</span>
<span id="cb80-1617"><a href="#cb80-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1618"><a href="#cb80-1618" aria-hidden="true" tabindex="-1"></a><span class="fu">## Topics</span></span>
<span id="cb80-1619"><a href="#cb80-1619" aria-hidden="true" tabindex="-1"></a><span class="al">![Demographic Information on r/relationships](./img/topics.jpeg)</span></span>
<span id="cb80-1620"><a href="#cb80-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1621"><a href="#cb80-1621" aria-hidden="true" tabindex="-1"></a><span class="fu">## Resulting Topics (sorted by frequency)</span></span>
<span id="cb80-1622"><a href="#cb80-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1623"><a href="#cb80-1623" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Communication issues**</span>
<span id="cb80-1624"><a href="#cb80-1624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1625"><a href="#cb80-1625" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"When "I say "hey what's wrong" he says nothing","We have issues communicating our feelings help"</span>
<span id="cb80-1626"><a href="#cb80-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1627"><a href="#cb80-1627" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Dating &amp; Flirting**</span>
<span id="cb80-1628"><a href="#cb80-1628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1629"><a href="#cb80-1629" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"How do I SUBTLETY flirt with a guy", "How soon is"too soon" to kiss someone?"</span>
<span id="cb80-1630"><a href="#cb80-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1631"><a href="#cb80-1631" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Emotions &amp; Attachment issues**</span>
<span id="cb80-1632"><a href="#cb80-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1633"><a href="#cb80-1633" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"How to overcome anxious attachment style?", "How to deal with falling out of love?"</span>
<span id="cb80-1634"><a href="#cb80-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1635"><a href="#cb80-1635" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Breakup**</span>
<span id="cb80-1636"><a href="#cb80-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1637"><a href="#cb80-1637" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"My BF broke up with me twice in one year." "How to get over an ex?"</span>
<span id="cb80-1638"><a href="#cb80-1638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1639"><a href="#cb80-1639" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Time together**</span>
<span id="cb80-1640"><a href="#cb80-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1641"><a href="#cb80-1641" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"My girlfriend is so busy, we barely spend any time together" or "My girlfriend sees nothing wrong in never being apart from me"</span>
<span id="cb80-1642"><a href="#cb80-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1643"><a href="#cb80-1643" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Trust &amp; Cheating**</span>
<span id="cb80-1644"><a href="#cb80-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1645"><a href="#cb80-1645" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Is she cheating on me?" "When is it ok to lie or hide something from your partner?"</span>
<span id="cb80-1646"><a href="#cb80-1646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1647"><a href="#cb80-1647" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>**Social media &amp; Communication**</span>
<span id="cb80-1648"><a href="#cb80-1648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1649"><a href="#cb80-1649" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Girlfriend commented on post for single people" ,"I don't know if boyfriend is lying about secret snapchat account"</span>
<span id="cb80-1650"><a href="#cb80-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1651"><a href="#cb80-1651" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>**General helplessness**</span>
<span id="cb80-1652"><a href="#cb80-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1653"><a href="#cb80-1653" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"What should I do in this situation?", "Was it a nasty thing to do?"</span>
<span id="cb80-1654"><a href="#cb80-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1655"><a href="#cb80-1655" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>**Money**</span>
<span id="cb80-1656"><a href="#cb80-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1657"><a href="#cb80-1657" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Any Advice on Splitting Expenses?"</span>
<span id="cb80-1658"><a href="#cb80-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1659"><a href="#cb80-1659" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>**Domestic abuse**</span>
<span id="cb80-1660"><a href="#cb80-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1661"><a href="#cb80-1661" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"My boyfriend tried to murder me because I left him"</span>
<span id="cb80-1662"><a href="#cb80-1662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1663"><a href="#cb80-1663" aria-hidden="true" tabindex="-1"></a><span class="ss">11. </span>**Sex**</span>
<span id="cb80-1664"><a href="#cb80-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1665"><a href="#cb80-1665" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Want to know how to spice our sex life up?","My boyfriend said he"loves my flat ass""</span>
<span id="cb80-1666"><a href="#cb80-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1667"><a href="#cb80-1667" aria-hidden="true" tabindex="-1"></a><span class="ss">12. </span>**Marriage &amp; Family**</span>
<span id="cb80-1668"><a href="#cb80-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1669"><a href="#cb80-1669" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"He wants to adopt I want a biological child", "How to handle my fiancee's overbearing mother before we get married"</span>
<span id="cb80-1670"><a href="#cb80-1670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1671"><a href="#cb80-1671" aria-hidden="true" tabindex="-1"></a><span class="ss">13. </span>**Weekend plans**</span>
<span id="cb80-1672"><a href="#cb80-1672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1673"><a href="#cb80-1673" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Boyfriend left to go to bar", "Boyfriend rather go on a trip with friends than with me"</span>
<span id="cb80-1674"><a href="#cb80-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1675"><a href="#cb80-1675" aria-hidden="true" tabindex="-1"></a><span class="ss">14. </span>**Gifts &amp; Invitations**</span>
<span id="cb80-1676"><a href="#cb80-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1677"><a href="#cb80-1677" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Mildly furious because my girlfriend wants me to return the gifts I bought her", "Is He Cheap or Am I Entitled?"</span>
<span id="cb80-1678"><a href="#cb80-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1679"><a href="#cb80-1679" aria-hidden="true" tabindex="-1"></a><span class="ss">15. </span>Data artifact</span>
<span id="cb80-1680"><a href="#cb80-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1681"><a href="#cb80-1681" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Many posts contain almost identical texts -<span class="sc">\&gt;</span> statistical artifact</span>
<span id="cb80-1682"><a href="#cb80-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1683"><a href="#cb80-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1684"><a href="#cb80-1684" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb80-1685"><a href="#cb80-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1686"><a href="#cb80-1686" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effects by Age</span></span>
<span id="cb80-1687"><a href="#cb80-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1688"><a href="#cb80-1688" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb80-1689"><a href="#cb80-1689" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/home/juko/Desktop/SICSS_github/topic_models/stm15_relationship.RData"</span>)</span>
<span id="cb80-1690"><a href="#cb80-1690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1691"><a href="#cb80-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1694"><a href="#cb80-1694" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-1695"><a href="#cb80-1695" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(stm))</span>
<span id="cb80-1696"><a href="#cb80-1696" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(stminsights))</span>
<span id="cb80-1697"><a href="#cb80-1697" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 2: Money</span></span>
<span id="cb80-1698"><a href="#cb80-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1699"><a href="#cb80-1699" aria-hidden="true" tabindex="-1"></a>custom_label_age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Missing"</span>, <span class="st">"&lt;21"</span>, <span class="st">"21-30"</span>, <span class="st">"31-40"</span>, <span class="st">"41-50"</span>, <span class="st">"&gt;50"</span>)</span>
<span id="cb80-1700"><a href="#cb80-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1701"><a href="#cb80-1701" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">2</span>, </span>
<span id="cb80-1702"><a href="#cb80-1702" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb80-1703"><a href="#cb80-1703" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic money across age"</span>,</span>
<span id="cb80-1704"><a href="#cb80-1704" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb80-1705"><a href="#cb80-1705" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span>
<span id="cb80-1706"><a href="#cb80-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1707"><a href="#cb80-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1708"><a href="#cb80-1708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1709"><a href="#cb80-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1712"><a href="#cb80-1712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-1713"><a href="#cb80-1713" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 9: Sex</span></span>
<span id="cb80-1714"><a href="#cb80-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1715"><a href="#cb80-1715" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">9</span>, </span>
<span id="cb80-1716"><a href="#cb80-1716" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb80-1717"><a href="#cb80-1717" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic sex across age"</span>,</span>
<span id="cb80-1718"><a href="#cb80-1718" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb80-1719"><a href="#cb80-1719" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span>
<span id="cb80-1720"><a href="#cb80-1720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1721"><a href="#cb80-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1724"><a href="#cb80-1724" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-1725"><a href="#cb80-1725" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 6 breakup:</span></span>
<span id="cb80-1726"><a href="#cb80-1726" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">6</span>, </span>
<span id="cb80-1727"><a href="#cb80-1727" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb80-1728"><a href="#cb80-1728" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic breakup across age"</span>,</span>
<span id="cb80-1729"><a href="#cb80-1729" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb80-1730"><a href="#cb80-1730" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span>
<span id="cb80-1731"><a href="#cb80-1731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1732"><a href="#cb80-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1735"><a href="#cb80-1735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-1736"><a href="#cb80-1736" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 7: Dating</span></span>
<span id="cb80-1737"><a href="#cb80-1737" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">7</span>, </span>
<span id="cb80-1738"><a href="#cb80-1738" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb80-1739"><a href="#cb80-1739" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic dating across age"</span>,</span>
<span id="cb80-1740"><a href="#cb80-1740" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb80-1741"><a href="#cb80-1741" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span>
<span id="cb80-1742"><a href="#cb80-1742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1743"><a href="#cb80-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1746"><a href="#cb80-1746" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-1747"><a href="#cb80-1747" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 3: Time together</span></span>
<span id="cb80-1748"><a href="#cb80-1748" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">3</span>, </span>
<span id="cb80-1749"><a href="#cb80-1749" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb80-1750"><a href="#cb80-1750" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic time together across age"</span>,</span>
<span id="cb80-1751"><a href="#cb80-1751" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb80-1752"><a href="#cb80-1752" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span>
<span id="cb80-1753"><a href="#cb80-1753" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1754"><a href="#cb80-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1757"><a href="#cb80-1757" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-1758"><a href="#cb80-1758" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 13: Cheating</span></span>
<span id="cb80-1759"><a href="#cb80-1759" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">13</span>, </span>
<span id="cb80-1760"><a href="#cb80-1760" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_age_group'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb80-1761"><a href="#cb80-1761" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic cheating across age"</span>,</span>
<span id="cb80-1762"><a href="#cb80-1762" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb80-1763"><a href="#cb80-1763" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_age)</span>
<span id="cb80-1764"><a href="#cb80-1764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1765"><a href="#cb80-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1766"><a href="#cb80-1766" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effects by Gender</span></span>
<span id="cb80-1767"><a href="#cb80-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1770"><a href="#cb80-1770" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-1771"><a href="#cb80-1771" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 6: Breakup:</span></span>
<span id="cb80-1772"><a href="#cb80-1772" aria-hidden="true" tabindex="-1"></a>custom_label_gender <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Missing"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Other"</span>)</span>
<span id="cb80-1773"><a href="#cb80-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1774"><a href="#cb80-1774" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">6</span>, </span>
<span id="cb80-1775"><a href="#cb80-1775" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_gender_binary'</span>,</span>
<span id="cb80-1776"><a href="#cb80-1776" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb80-1777"><a href="#cb80-1777" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic breakup across gender"</span>,</span>
<span id="cb80-1778"><a href="#cb80-1778" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb80-1779"><a href="#cb80-1779" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_gender)</span>
<span id="cb80-1780"><a href="#cb80-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1781"><a href="#cb80-1781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1782"><a href="#cb80-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1785"><a href="#cb80-1785" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-1786"><a href="#cb80-1786" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 13 cheating:</span></span>
<span id="cb80-1787"><a href="#cb80-1787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1788"><a href="#cb80-1788" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stm_effects15, <span class="at">topic =</span> <span class="dv">13</span>, </span>
<span id="cb80-1789"><a href="#cb80-1789" aria-hidden="true" tabindex="-1"></a>                    <span class="at">covariate =</span> <span class="st">'author_gender_binary'</span>, <span class="at">method =</span> <span class="st">'pointestimate'</span>,</span>
<span id="cb80-1790"><a href="#cb80-1790" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Comparison of prevalence of topic cheating across gender"</span>,</span>
<span id="cb80-1791"><a href="#cb80-1791" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeltype =</span> <span class="st">"custom"</span>,</span>
<span id="cb80-1792"><a href="#cb80-1792" aria-hidden="true" tabindex="-1"></a>                    <span class="at">custom.labels =</span> custom_label_gender)</span>
<span id="cb80-1793"><a href="#cb80-1793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1794"><a href="#cb80-1794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1795"><a href="#cb80-1795" aria-hidden="true" tabindex="-1"></a><span class="fu">## Relationships between topics</span></span>
<span id="cb80-1796"><a href="#cb80-1796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1797"><a href="#cb80-1797" aria-hidden="true" tabindex="-1"></a><span class="al">![](./img/Correlation_Plot-1.png)</span></span>
<span id="cb80-1798"><a href="#cb80-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1799"><a href="#cb80-1799" aria-hidden="true" tabindex="-1"></a><span class="fu">## If we had unlimited time, we would continue by...</span></span>
<span id="cb80-1800"><a href="#cb80-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1801"><a href="#cb80-1801" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>...looking at the reactions of other users to specific topics.</span>
<span id="cb80-1802"><a href="#cb80-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1803"><a href="#cb80-1803" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>...running all our models with the huge data dump (<span class="sc">\&gt;</span>1 Million posts).</span>
<span id="cb80-1804"><a href="#cb80-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1805"><a href="#cb80-1805" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>...trying some even fancier methods (e.g., word embeddings to look for stereotypes surrounding males &amp; females in relationships).</span>
<span id="cb80-1806"><a href="#cb80-1806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1807"><a href="#cb80-1807" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>... getting way better with age and gender  detection</span>
<span id="cb80-1808"><a href="#cb80-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1809"><a href="#cb80-1809" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>... better remove artifacts, bots, double posts</span>
<span id="cb80-1810"><a href="#cb80-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1811"><a href="#cb80-1811" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>... Obvious insanity</span>
<span id="cb80-1812"><a href="#cb80-1812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1813"><a href="#cb80-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1814"><a href="#cb80-1814" aria-hidden="true" tabindex="-1"></a><span class="fu"># Takeaways</span></span>
<span id="cb80-1815"><a href="#cb80-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1816"><a href="#cb80-1816" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Often, the bottleneck is not the method but the technical implementaton</span>
<span id="cb80-1817"><a href="#cb80-1817" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Time pressure leads to **bad** science</span>
<span id="cb80-1818"><a href="#cb80-1818" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Deciding on number of topics is rather arbitrary</span>
<span id="cb80-1819"><a href="#cb80-1819" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Running the same stm twice can give vastly different topics</span>
<span id="cb80-1820"><a href="#cb80-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1821"><a href="#cb80-1821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1822"><a href="#cb80-1822" aria-hidden="true" tabindex="-1"></a><span class="fu"># Thank You!</span></span>
<span id="cb80-1823"><a href="#cb80-1823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1824"><a href="#cb80-1824" aria-hidden="true" tabindex="-1"></a>**Thanks to all who made this aweseom summer school possible:**</span>
<span id="cb80-1825"><a href="#cb80-1825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1826"><a href="#cb80-1826" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Carsten, Alex, Mario, Renata, Sammie...</span>
<span id="cb80-1827"><a href="#cb80-1827" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>SICSS</span>
<span id="cb80-1828"><a href="#cb80-1828" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>LMU &amp; Maggus</span>
<span id="cb80-1829"><a href="#cb80-1829" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ALL OF YOU!</span>
<span id="cb80-1830"><a href="#cb80-1830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1831"><a href="#cb80-1831" aria-hidden="true" tabindex="-1"></a>...and... </span>
<span id="cb80-1832"><a href="#cb80-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1833"><a href="#cb80-1833" aria-hidden="true" tabindex="-1"></a>Fuck u/spez for closing the Reddit API!</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>